(()=>{"use strict";class e{constructor(e,t){this.x=e,this.y=t}add(e){this.x+=e.x,this.y+=e.y}multiplyScalar(e){return this.x*=e,this.y*=e,this}get(){return{x:this.x,y:this.y}}clone(){return new e(this.x,this.y)}static add(t,i){return new e(t.x+i.x,t.y+i.y)}static distance(e,t){const i=e.x-t.x,s=e.y-t.y;return Math.sqrt(i*i+s*s)}static isEqual(e,t){return e.x===t.x&&e.y===t.y}static multiplyScalar(e,t){let i=e.clone();return i.x*=t,i.y*=t,i}}const t=e,i={NONE:"NONE",UP:"UP",RIGHT:"RIGHT",DOWN:"DOWN",LEFT:"LEFT",LEFTDOWN:"LEFTDOWN",LEFTUP:"LEFTUP",RIGHTDOWN:"RIGHTDOWN",RIGHTUP:"RIGHTUP"};Object.freeze(i);const s=e=>{switch(e){case i.UP:return i.DOWN;case i.RIGHT:return i.LEFT;case i.DOWN:return i.UP;case i.LEFT:return i.RIGHT}},n=(e,t,s)=>{let n=i.NONE;return e.y<t.y&&t.y<s.y?n=i.UP:e.x>t.x&&t.x>s.x?n=i.RIGHT:e.x>t.x&&t.y<s.y||e.y>t.y&&t.x<s.x?n=i.RIGHTDOWN:e.x>t.x&&t.y>s.y||e.y<t.y&&t.x<s.x?n=i.RIGHTUP:e.x<t.x&&t.x<s.x?n=i.LEFT:e.x<t.x&&t.y>s.y||e.y<t.y&&t.x>s.x?n=i.LEFTUP:e.x<t.x&&t.y<s.y||e.y>t.y&&t.x>s.x?n=i.LEFTDOWN:e.y>t.y&&t.y>s.y&&(n=i.DOWN),n},r=e=>{switch(e){case i.UP:return new t(0,-1);case i.RIGHT:return new t(1,0);case i.DOWN:return new t(0,1);case i.LEFT:return new t(-1,0)}},h=i,a=class{constructor(){this._events=[]}addEvent(e){void 0===this._events[e]&&(this._events[e]=[])}clearEvent(e){this._events[e]=[]}reset(){this._events=[]}registerHandler(e,t){this.addEvent(e),this._events[e].push(t)}deregisterHandler(e,t){if(!Object.keys(this._events).includes(e))return;let i=this._events[e].indexOf(t);-1!==i&&this._events[e].splice(i,1)}dispatch(e,t){if(void 0!==this._events[e])for(let i=0;i<this._events[e].length;i++)this._events[e][i](t)}};class o{#next;#value;constructor(e){this.#next=null,this.#value=e}value(){return this.#value}next(){return this.#next}setNext(e){this.#next=e}setValue(e){this.#value=e}}class c{constructor(e){this.position=e}}class d{initialNode;currentNode;constructor(){this.index=0,this.size=0,this.isAvailable=!0}start(e){this.index=0,this.isAvailable=!1,this.currentNode=e}step(e,t){this.size=(t-this.index)/t/2+.5;let i=e;for(let e=0;e<this.index;e++)i.next()&&(i=i.next());this.currentNode=i,this.index++,this.index>=t&&this.reset()}reset(){this.isAvailable=!0,this.size=0,this.index=0}getPosition(){return this.currentNode.value().position}}const l=class{#eventDispatcher;#events;constructor(){this.#eventDispatcher=new a,this.#events={UP:"UP",RIGHT:"RIGHT",DOWN:"DOWN",LEFT:"LEFT",E:"E",ANY:"ANY"},document.body.addEventListener("keydown",(e=>{37==e.keyCode&&this.#eventDispatcher.dispatch(this.#events.LEFT),38==e.keyCode&&this.#eventDispatcher.dispatch(this.#events.UP),39==e.keyCode&&this.#eventDispatcher.dispatch(this.#events.RIGHT),40==e.keyCode&&this.#eventDispatcher.dispatch(this.#events.DOWN),69==e.keyCode&&this.#eventDispatcher.dispatch(this.#events.E),this.#eventDispatcher.dispatch(this.#events.ANY)}))}onUp(e){this.#eventDispatcher.registerHandler(this.#events.UP,e)}removeOnUp(e){this.#eventDispatcher.deregisterHandler(this.#events.UP,e)}onRight(e){this.#eventDispatcher.registerHandler(this.#events.RIGHT,e)}removeOnRight(e){this.#eventDispatcher.deregisterHandler(this.#events.RIGHT,e)}onDown(e){this.#eventDispatcher.registerHandler(this.#events.DOWN,e)}removeOnDown(e){this.#eventDispatcher.deregisterHandler(this.#events.DOWN,e)}onLeft(e){this.#eventDispatcher.registerHandler(this.#events.LEFT,e)}removeOnLeft(e){this.#eventDispatcher.deregisterHandler(this.#events.LEFT,e)}onE(e){this.#eventDispatcher.registerHandler(this.#events.E,e)}removeOnE(e){this.#eventDispatcher.deregisterHandler(this.#events.E,e)}onAnyKey(e){this.#eventDispatcher.registerHandler(this.#events.ANY,e)}removeOnAnyKey(e){this.#eventDispatcher.deregisterHandler(this.#events.ANY,e)}},p=class{#tracks;constructor(){this.#tracks=[]}load(e,t,i=.5,s=!1){this.#tracks[e]=new Audio(t),this.#tracks[e].volume=i,this.#tracks[e].loop=s}play(e){this.#tracks[e].currentTime=0,this.#tracks[e].play()}stop(e){this.#tracks[e].currentTime=0,this.#tracks[e].pause()}},g=new class{#canvas;#context;#width;#height;#cellSize;#borderWidth;#spriteSheet;constructor(e,t=30){this.#canvas=e,this.#context=e.getContext("2d"),this.#height=e.height,this.#width=e.width,this.#cellSize=t,this.#borderWidth=2,this.#spriteSheet=new class{#spriteSheet;#sprites;constructor(e){this.#spriteSheet=document.createElement("img"),this.#spriteSheet.src=e,this.#sprites={}}addSprite(e,t,i,s,n){this.#sprites[e]={spriteSheet:this.#spriteSheet,x:t,y:i,width:s,height:n}}getSprite(e){return this.#sprites[e]}}("./images/snake-spritesheet.png"),this.#loadSprites()}clear(){this.#context.clearRect(0,0,this.#canvas.width,this.#canvas.height)}drawGrid(e){this.#context.beginPath(),e.getGridCoordinates().forEach((e=>{this.#context.beginPath(),this.#context.fillStyle=e.y%2==e.x%2?"#ffffff":"#ced7dd ",this.#context.rect(e.x*this.#cellSize,e.y*this.#cellSize,this.#cellSize,this.#cellSize),this.#context.fill(),this.#context.closePath()})),this.#context.closePath()}drawSnake(e,t){let s,r,h;this.#context.beginPath();for(var a=1;a<e.length-1;a++)s=n(e[a-1],e[a],e[a+1]),r=`body-${s.toString().toLowerCase()}`,h=this.#spriteSheet.getSprite(r),h&&this.#drawSnakePart(e[a],h);const o=`tail-${((e,t)=>{let s=i.UP;return e.x===t.x&&e.y<t.y?s=i.UP:e.x>t.x&&e.y===t.y?s=i.RIGHT:e.x<t.x&&e.y===t.y?s=i.LEFT:e.x===t.x&&e.y>t.y&&(s=i.DOWN),s})(e[e.length-1],e[e.length-2]).toString().toLowerCase()}`,c=this.#spriteSheet.getSprite(o);this.#drawSnakePart(e[e.length-1],c);const d=`head-${t.toString().toLowerCase()}`,l=this.#spriteSheet.getSprite(d);this.#drawSnakePart(e[0],l)}takeScreenshot(){return this.#canvas.toDataURL("png")}drawApple(e){let{spriteSheet:t,x:i,y:s,width:n,height:r}=this.#spriteSheet.getSprite("apple");this.#context.rect(e.x*this.#cellSize+this.#borderWidth,e.y*this.#cellSize+this.#borderWidth,this.#cellSize-this.#borderWidth,this.#cellSize-this.#borderWidth),this.#context.drawImage(t,i,s,n,r,e.x*this.#cellSize,e.y*this.#cellSize,this.#cellSize,this.#cellSize)}#drawSnakePart(e,{spriteSheet:t,x:i,y:s,width:n,height:r}){this.#context.drawImage(t,i,s,n,r,e.x*this.#cellSize,e.y*this.#cellSize,this.#cellSize,this.#cellSize)}drawSnakeMouth(e,i){let s=r(i);const n=this.#cellSize/2,h=t.multiplyScalar(s,n/1.5);this.#context.beginPath(),this.#context.arc(e.x*this.#cellSize+n+h.x,e.y*this.#cellSize+n+h.y,this.#cellSize/3.5,0,2*Math.PI,!1),this.#context.fillStyle="black",this.#context.fill(),this.#context.closePath()}drawBulges(e){if(Array.isArray(e)){const t=this.#cellSize/2;e.forEach((({position:e,size:i})=>{this.#context.beginPath(),this.#context.arc(e.x*this.#cellSize+t,e.y*this.#cellSize+t,this.#cellSize/1.5*i,0,2*Math.PI,!1),this.#context.fillStyle="#5b7bf9",this.#context.fill(),this.#context.closePath()}))}}#loadSprites(){this.#spriteSheet.addSprite("apple",0,0,40,40),this.#spriteSheet.addSprite("head-up",120,40,40,40),this.#spriteSheet.addSprite("head-right",120,0,40,40),this.#spriteSheet.addSprite("head-down",40,80,40,40),this.#spriteSheet.addSprite("head-left",80,80,40,40),this.#spriteSheet.addSprite("body-up",0,80,40,40),this.#spriteSheet.addSprite("body-right",0,40,40,40),this.#spriteSheet.addSprite("body-leftdown",40,0,40,40),this.#spriteSheet.addSprite("body-leftup",40,40,40,40),this.#spriteSheet.addSprite("body-down",0,80,40,40),this.#spriteSheet.addSprite("body-left",0,40,40,40),this.#spriteSheet.addSprite("body-rightdown",80,0,40,40),this.#spriteSheet.addSprite("body-rightup",80,40,40,40),this.#spriteSheet.addSprite("tail-down",120,80,40,40),this.#spriteSheet.addSprite("tail-left",0,120,40,40),this.#spriteSheet.addSprite("tail-up",80,120,40,40),this.#spriteSheet.addSprite("tail-right",40,120,40,40)}}(document.getElementById("canvas")),S=document.getElementById("intro-screen"),v=document.getElementById("game-screen"),u=document.getElementById("high-score-screen"),m=document.getElementById("review-screen"),y=new class{#score;#snake;#initialSnakeLength;#grid;#applePosition;#eventDispatcher;#events;#timer;#gameInProgess;#moveDelay;#currentSnakePositions;#audioManager;constructor(){this.#initialSnakeLength=6,this.#grid=new class{#grid;#numberOfColumns;#numberOfRows;constructor(e=0,t=0){this.#numberOfColumns=e,this.#numberOfRows=t,this.#grid=new Array(this.#numberOfColumns*this.#numberOfRows)}getCenter(){return new t(this.#numberOfColumns/2-1,this.#numberOfRows/2-1)}getColumnCount(){return this.#numberOfColumns}getRowCount(){return this.#numberOfRows}getGrid(){return this.#grid}getGridCoordinate(e){return new t(e%this.#numberOfColumns,Math.floor(e/this.#numberOfRows))}getIndex(e,t){return t*this.#numberOfColumns+e}getGridCoordinates(){return[...this.getGrid().keys()].map(((e,t)=>this.getGridCoordinate(t)))}getRandomIndex(e=[]){const t=[...this.getGrid().keys()].map(((e,t)=>t)).filter((t=>!e.includes(t)));return t[Math.floor(Math.random()*t.length)]}getRandomCoordinate(e=[]){const t=e.map((e=>this.getIndex(e.x,e.y))),i=this.getRandomIndex(t);return this.getGridCoordinate(i)}}(20,20),this.#snake=new class{#body;#direction;#nextDirection;#eventDispatcher;#events;#initialPosition;#initialDirection;#initialLength;#bulges;constructor(e,t=5,i=h.UP){this.#direction=i,this.#nextDirection=i,this.#initialPosition=e,this.#initialDirection=i,this.#initialLength=t,this.#eventDispatcher=new a,this.#events={EAT:"EAT",CHANGEDIRECTION:"CHANGEDIRECTION"},this.init()}init(){const e=s(this.#initialDirection),i=r(e);let n;this.#body=new class{constructor(){this.#clear()}push(e){const t=new o(e);return this.head?(this.tail.setNext(t),this.tail=t):(this.head=t,this.tail=this.head),this.length+=1,this}pop(){if(0===this.length)return;let e=this.head,t=e;for(;e.next();)t=e,e=e.next();return this.tail=t,this.tail.setNext(null),this.length-=1,e}unshift(e){const t=new o(e);return this.head?(t.setNext(this.head),this.head=t):(this.head=t,this.tail=this.head),this.length+=1,this}#clear(){this.head=null,this.tail=null,this.length=0}},this.#body.push(new c(this.#initialPosition));for(let e=1;e<this.#initialLength;e++)n=t.multiplyScalar(i,e),this.#body.push(new c(t.add(this.#initialPosition,n)));this.#direction=this.#initialDirection,this.#bulges=[]}changeDirection(e){const t=s(this.#direction);(e=>Object.keys(i).includes(e))(e)&&e!==t&&(this.#nextDirection=e),this.#direction!=e&&this.#eventDispatcher.dispatch(this.#events.CHANGEDIRECTION,e)}move(){let e=this.#body.head;const i=r(this.#nextDirection);let s=e.value().position,n=t.add(s,i);this.#body.unshift({position:n}),this.#direction=this.#nextDirection,this.#bulges.filter((e=>!e.isAvailable)).forEach((e=>{e.step(this.#body.head,this.#body.length),e.step(this.#body.head,this.#body.length)}))}eat(){this.#eventDispatcher.dispatch(this.#events.EAT,this.#body.length);const e=this.#bulges.filter((e=>e.isAvailable));if(e.length>0)e[0].start(this.#body.head);else{const e=new d;e.start(this.#body.head),this.#bulges.push(e)}}pop(){this.#body.pop()}resetHandlers(){this.#eventDispatcher.reset()}getBody(){return this.#body}getLength(){return this.#body.length}getDirection(){return this.#direction}getNextDirection(){return this.#nextDirection}getPositions(){const e=[];let t=this.#body.head,i=0;for(;i<this.#body.length;)e.push(t.value().position.get()),t=t.next(),i++;return e}getBodyPositions(){const e=this.getPositions();return e.shift(),e}getBulges(){return this.#bulges.filter((e=>!e.isAvailable)).map((e=>({position:e.getPosition(),size:e.size})))}getHeadPosition(){return this.#body.head.value().position}setHeadPosition(e){this.#body.head.setValue(new c(e))}hasOverlapped(){const e=this.getPositions();return e.shift(),e.filter((e=>t.isEqual(e,this.#body.head.value().position))).length>0}onEat(e){this.#eventDispatcher.registerHandler(this.#events.EAT,e)}removeOnEat(e){this.#eventDispatcher.deregisterHandler(this.#events.EAT,e)}onChangeDirection(e){this.#eventDispatcher.registerHandler(this.#events.CHANGEDIRECTION,e)}removeOnChangeDirection(e){this.#eventDispatcher.deregisterHandler(this.#events.CHANGEDIRECTION,e)}}(this.#grid.getCenter(),this.#initialSnakeLength,h.UP),this.#timer=new class{#elaspsed;#startTime;#current;#target;#isActive;#eventDispatcher;#events;constructor(){this.#eventDispatcher=new a,this.#events={TICK:"TICK",ELAPSED:"ELAPSED"}}start(e){this.#current=0,this.#startTime=new Date,this.#target=e,this.#isActive=!0,window.requestAnimationFrame(this.#timerLoop.bind(this))}reset(){this.#current=0,this.#startTime=new Date}stop(){this.#isActive=!1}hasElapsed(){return this.#elaspsed}tick(){this.#isActive&&(this.#eventDispatcher.dispatch(this.#events.TICK,this.#current/this.#target),this.#current=new Date-this.#startTime,this.#elaspsed=this.#current>this.#target,this.hasElapsed()&&(this.#eventDispatcher.dispatch(this.#events.ELAPSED),this.reset()))}#timerLoop(){this.tick(),this.#isActive&&setTimeout(this.#timerLoop.bind(this),0)}clearHandlers(){this.#eventDispatcher.reset()}onTick(e){this.#eventDispatcher.registerHandler(this.#events.TICK,e)}removeOnTick(e){this.#eventDispatcher.deregisterHandler(this.#events.TICK,e)}onElapsed(e){this.#eventDispatcher.registerHandler(this.#events.ELAPSED,e)}removeOnElapsed(e){this.#eventDispatcher.deregisterHandler(this.#events.ELAPSED,e)}},this.#eventDispatcher=new a,this.#gameInProgess=!1,this.#moveDelay=160,this.#currentSnakePositions=[],this.#audioManager=new p,this.#events={INIT:"INIT",START:"START",END:"END",PAUSE:"PAUSE",RESET:"RESET",UPDATE:"UPDATE",TICK:"TICK"},Object.freeze(this.#events);const e=new l;e.onUp((()=>this.#snake.changeDirection(h.UP))),e.onRight((()=>this.#snake.changeDirection(h.RIGHT))),e.onDown((()=>this.#snake.changeDirection(h.DOWN))),e.onLeft((()=>this.#snake.changeDirection(h.LEFT))),this.#audioManager.load("eat","../audio/eat.wav",.8),this.#audioManager.load("up","../audio/wo.wav"),this.#audioManager.load("right","../audio/we.wav"),this.#audioManager.load("down","../audio/wa.wav"),this.#audioManager.load("left","../audio/wu.wav"),this.#audioManager.load("bg","../audio/Monkeys-Spinning-Monkeys.mp3",.3,!0),this.#audioManager.load("cheering","../audio/cheering.wav",.3,!1)}init(){this.#gameInProgess=!1,this.#timer.stop(),this.#timer.clearHandlers(),this.#timer.onElapsed(this.#update.bind(this)),this.#score=0,this.#applePosition=this.#grid.getRandomCoordinate(this.#snake.getPositions()),this.#snake.init(),this.#audioManager.play("bg");const e=e=>{this.#score=e-this.#initialSnakeLength,this.#audioManager.play("eat")},t=e=>{this.#audioManager.play(e.toString().toLowerCase())};this.#snake.removeOnEat(e),this.#snake.onEat(e),this.#snake.removeOnChangeDirection(t),this.#snake.onChangeDirection(t),this.#eventDispatcher.dispatch(this.#events.UPDATE,{currentSnakeDirection:this.#snake.getDirection(),currentSnakePositions:this.#snake.getPositions(),snakeLength:this.#snake.getLength(),bulges:this.#snake.getBulges(),applePosition:this.#applePosition,score:this.#score})}start(){this.#gameInProgess=!0,this.#timer.start(this.#moveDelay)}end(e,t){this.#timer.stop(),this.#timer.removeOnElapsed(this.#update),this.#snake.resetHandlers(),this.#audioManager.stop("bg"),this.#audioManager.play("cheering"),this.#eventDispatcher.dispatch(this.#events.END,{currentSnakeDirection:t,currentSnakePositions:e,snakeLength:this.#snake.getLength(),bulges:this.#snake.getBulges(),applePosition:this.#applePosition,score:this.#score,grid:this.#grid})}#update(){if(this.#gameInProgess){const e=this.#currentSnakePositions,i=this.#snake.getDirection();this.#snake.move();let s=this.#snake.getHeadPosition();this.#snake.hasOverlapped()||!this.#isWithinGrid(this.#snake,this.#grid)?(this.#gameInProgess=!1,this.end(e,i)):(t.isEqual(s,this.#applePosition)?(this.#snake.eat(),this.#applePosition=this.#grid.getRandomCoordinate(this.#snake.getPositions())):this.#snake.pop(),this.#currentSnakePositions=this.#snake.getPositions(),this.#score=this.#snake.getLength()-this.#initialSnakeLength,this.#eventDispatcher.dispatch(this.#events.UPDATE,{currentSnakeDirection:this.#snake.getDirection(),currentSnakePositions:this.#snake.getPositions(),snakeLength:this.#snake.getLength(),bulges:this.#snake.getBulges(),applePosition:this.#applePosition,score:this.#score}))}}#isWithinGrid(e,t){let i=e.getHeadPosition();return i.y>=0&&i.y<t.getRowCount()&&i.x>=0&&i.x<t.getColumnCount()}onUpdate(e){this.#eventDispatcher.registerHandler(this.#events.UPDATE,e)}removeOnUpdate(e){this.#eventDispatcher.deregisterHandler(this.#events.UPDATE,e)}onInit(e){this.#eventDispatcher.registerHandler(this.#events.INIT,e)}removeOnInit(e){this.#eventDispatcher.deregisterHandler(this.#events.INIT,e)}onEnd(e){this.#eventDispatcher.registerHandler(this.#events.END,e)}removeOnEnd(e){this.#eventDispatcher.deregisterHandler(this.#events.END,e)}},D=new p;D.load("menu-bg","./audio/Komiku_-_12_-_Bicycle.mp3",.5,!0);const E=new class{#inputManager;#highScoreManager;#eventDispatcher;#events;#startScreen;#gameScreen;#highScoreScreen;#reviewScreen;#promptElement;#promptElementText;#scoreElement;constructor(e,t,i,s){this.#inputManager=new l,this.#eventDispatcher=new a,this.#highScoreManager=new class{#key;#highScores;constructor(e){this.#key=e,this.#highScores=[];let t=window.localStorage.getItem(e);if("string"==typeof t){let e=JSON.parse(t);Array.isArray(e)&&(this.#highScores=[...e])}}getHighScores(){return this.#highScores}addHighScore(e,t){this.#highScores.push({name:e,value:t,date:(new Date).toISOString()}),this.#save()}getTopTen(){return this.#highScores.sort(this.#compare).filter(((e,t)=>t<10))}#save(){window.localStorage.setItem(this.#key,JSON.stringify(this.#highScores))}#compare(e,t){return e.value>t.value?-1:t.value>e.value||Date.parse(e.date)>Date.parse(t.date)?1:Date.parse(t.date)>Date.parse(e.date)?-1:0}}("jm-snake"),this.#events={INIT:"INIT",MAINMENU:"MAINMENU",STARTGAME:"STARTGAME",SUBMITSCORE:"SUBMITSCORE",SHOWHIGHSCORES:"SHOWHIGHSCORES"},Object.freeze(this.#events),this.#startScreen=e,this.#gameScreen=t,this.#highScoreScreen=i,this.#reviewScreen=s,this.#scoreElement=document.body.querySelectorAll(".score"),this.#promptElement=document.getElementById("prompt"),this.#promptElementText=document.getElementById("prompt-text"),this.#clearPrompt(),this.#showStartScreen()}updateScore(e){for(var t=0;t<this.#scoreElement.length;t++)this.#scoreElement[t].innerHTML=e}goToReview(e,t){this.#showReviewScreen(t),this.#reviewScreen.querySelector("img").src=e,this.updateScore(t)}renderHighScores(e){const t=this.#highScoreScreen.querySelector("#high-scores"),i=this.#highScoreScreen.querySelector("#high-scores-message");this.#show(t),this.#hide(i),0===e.length&&this.#show(i);let s=['<li><h3>name</h3><h3>#<span class="apple-icon"></span></h3></li>'];for(let t=0;t<10;t++)t<e.length?s.push(`<li><div>${e[t].name}</div><div>${e[t].value}</div></li>`):s.push("<li><div></div><div></div></li>");t.innerHTML=s.join("")}onInitGame(e){this.#eventDispatcher.registerHandler(this.#events.INIT,e)}removeonInitGame(e){this.#eventDispatcher.deregisterHandler(this.#events.INIT,e)}onStartGame(e){this.#eventDispatcher.registerHandler(this.#events.STARTGAME,e)}removeOnStartGame(e){this.#eventDispatcher.deregisterHandler(this.#events.STARTGAME,e)}onSubmitHighScores(e){this.#eventDispatcher.registerHandler(this.#events.SUBMITSCORE,e)}removeOnSubmitHighScores(e){this.#eventDispatcher.deregisterHandler(this.#events.SUBMITSCORE,e)}onShowHighScores(e){this.#eventDispatcher.registerHandler(this.#events.SHOWHIGHSCORES,e)}removeOnShowHighScores(e){this.#eventDispatcher.deregisterHandler(this.#events.SHOWHIGHSCORES,e)}onMainMenu(e){this.#eventDispatcher.registerHandler(this.#events.MAINMENU,e)}removeOnMainMenu(e){this.#eventDispatcher.deregisterHandler(this.#events.MAINMENU,e)}#showStartScreen(){this.#show(this.#startScreen),this.#hide(this.#gameScreen),this.#hide(this.#highScoreScreen),this.#hide(this.#reviewScreen);const e=this.#startScreen.querySelector("#high-scores-button"),t=this.#startScreen.querySelector("#start-button"),i=()=>{t.removeEventListener("click",i),this.#startGame()},s=()=>{e.removeEventListener("click",s),this.#showHighScoreScreen(),this.#eventDispatcher.dispatch(this.#events.SHOWHIGHSCORES)};t.addEventListener("click",i),e.addEventListener("click",s),this.#eventDispatcher.dispatch(this.#events.MAINMENU)}#startGame(){this.#showGameScreen(),this.#eventDispatcher.dispatch(this.#events.INIT),this.#prompt("Press any key to begin");const e=()=>{this.#inputManager.removeOnAnyKey(e),this.#clearPrompt(),this.#eventDispatcher.dispatch(this.#events.STARTGAME)};this.#inputManager.onAnyKey(e)}#showGameScreen(){this.#hide(this.#startScreen),this.#show(this.#gameScreen),this.#hide(this.#highScoreScreen),this.#hide(this.#reviewScreen)}#showHighScoreScreen(){this.#hide(this.#startScreen),this.#hide(this.#gameScreen),this.#show(this.#highScoreScreen),this.#hide(this.#reviewScreen),this.renderHighScores(this.#highScoreManager.getTopTen());const e=this.#highScoreScreen.querySelector("#back-button"),t=()=>{e.removeEventListener("click",t),this.#showStartScreen()};e.addEventListener("click",t)}#showReviewScreen(e){this.#hide(this.#startScreen),this.#hide(this.#gameScreen),this.#hide(this.#highScoreScreen),this.#show(this.#reviewScreen);const t=this.#reviewScreen.querySelector("#play-again-button"),i=this.#reviewScreen.querySelector("#menu-button"),s=this.#reviewScreen.querySelector("#submit-button"),n=this.#reviewScreen.querySelector("#name"),r=t=>{t.preventDefault(),"string"==typeof n.value&&n.value.length>0?(s.removeEventListener("click",r),this.#highScoreManager.addHighScore(n.value,e),this.#showHighScoreScreen(),this.#eventDispatcher.dispatch(this.#events.SHOWHIGHSCORES)):alert("Please enter a name")},h=()=>{t.removeEventListener("click",h),this.#startGame()},a=()=>{i.removeEventListener("click",a),this.#showStartScreen()};t.addEventListener("click",h),i.addEventListener("click",a),s.addEventListener("click",r)}#show(e){e.classList.remove("hidden")}#hide(e){e.classList.add("hidden")}#prompt(e){this.#show(this.#promptElement),this.#promptElementText.innerHTML=e}#clearPrompt(){this.#promptElementText.innerHTML="",this.#hide(this.#promptElement)}}(S,v,u,m);E.onMainMenu((()=>{D.play("menu-bg")})),E.onInitGame((()=>{D.stop("menu-bg"),y.init()})),E.onStartGame((()=>{y.start()}));const w=({currentSnakePositions:e,currentSnakeDirection:i,snakeLength:s,bulges:n,applePosition:r,score:h})=>{const a=t.distance(e[0],r);g.clear(),g.drawBulges(n),g.drawSnake(e,i,s),a<2&&g.drawSnakeMouth(e[0],i),g.drawApple(r),E.updateScore(h)};y.onInit(w),y.onUpdate(w),y.onEnd((({currentSnakePositions:e,currentSnakeDirection:t,snakeLength:i,applePosition:s,score:n,grid:r})=>{g.clear(),g.drawGrid(r),g.drawSnake(e,t,i),g.drawApple(s);const h=g.takeScreenshot();E.goToReview(h,n)}))})();
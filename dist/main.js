/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e={99:(e,t,n)=>{n.d(t,{Z:()=>b});var r,i,o=n(655),s=n(589),a=n(909),u=n(594),h=((r={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",r["bad-app-name"]="Illegal App name: '{$appName}",r["duplicate-app"]="Firebase App named '{$appName}' already exists",r["app-deleted"]="Firebase App named '{$appName}' already deleted",r["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",r["invalid-log-argument"]="First argument to `onLog` must be null or a function.",r),l=new s.LL("app","Firebase",h),c="@firebase/app",d="[DEFAULT]",p=((i={})[c]="fire-core",i["@firebase/analytics"]="fire-analytics",i["@firebase/app-check"]="fire-app-check",i["@firebase/auth"]="fire-auth",i["@firebase/database"]="fire-rtdb",i["@firebase/functions"]="fire-fn",i["@firebase/installations"]="fire-iid",i["@firebase/messaging"]="fire-fcm",i["@firebase/performance"]="fire-perf",i["@firebase/remote-config"]="fire-rc",i["@firebase/storage"]="fire-gcs",i["@firebase/firestore"]="fire-fst",i["fire-js"]="fire-js",i["firebase-wrapper"]="fire-js-all",i),f=new u.Yd("@firebase/app"),v=function(){function e(e,t,n){var r=this;this.firebase_=n,this.isDeleted_=!1,this.name_=t.name,this.automaticDataCollectionEnabled_=t.automaticDataCollectionEnabled||!1,this.options_=(0,s.p$)(e),this.container=new a.H0(t.name),this._addComponent(new a.wA("app",(function(){return r}),"PUBLIC")),this.firebase_.INTERNAL.components.forEach((function(e){return r._addComponent(e)}))}return Object.defineProperty(e.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(e){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),e.prototype.delete=function(){var e=this;return new Promise((function(t){e.checkDestroyed_(),t()})).then((function(){return e.firebase_.INTERNAL.removeApp(e.name_),Promise.all(e.container.getProviders().map((function(e){return e.delete()})))})).then((function(){e.isDeleted_=!0}))},e.prototype._getService=function(e,t){var n;void 0===t&&(t=d),this.checkDestroyed_();var r=this.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:t})},e.prototype._removeServiceInstance=function(e,t){void 0===t&&(t=d),this.container.getProvider(e).clearInstance(t)},e.prototype._addComponent=function(e){try{this.container.addComponent(e)}catch(t){f.debug("Component "+e.name+" failed to register with FirebaseApp "+this.name,t)}},e.prototype._addOrOverwriteComponent=function(e){this.container.addOrOverwriteComponent(e)},e.prototype.toJSON=function(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}},e.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw l.create("app-deleted",{appName:this.name_})},e}();v.prototype.name&&v.prototype.options||v.prototype.delete||console.log("dc");var _=function e(){var t=function(e){var t={},n=new Map,r={__esModule:!0,initializeApp:function(n,i){void 0===i&&(i={}),"object"==typeof i&&null!==i||(i={name:i});var o=i;void 0===o.name&&(o.name=d);var a=o.name;if("string"!=typeof a||!a)throw l.create("bad-app-name",{appName:String(a)});if((0,s.r3)(t,a))throw l.create("duplicate-app",{appName:a});var u=new e(n,o,r);return t[a]=u,u},app:i,registerVersion:function(e,t,n){var r,i=null!==(r=p[e])&&void 0!==r?r:e;n&&(i+="-"+n);var s=i.match(/\s|\//),u=t.match(/\s|\//);if(s||u){var h=['Unable to register library "'+i+'" with version "'+t+'":'];return s&&h.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),s&&u&&h.push("and"),u&&h.push('version name "'+t+'" contains illegal characters (whitespace or "/")'),void f.warn(h.join(" "))}o(new a.wA(i+"-version",(function(){return{library:i,version:t}}),"VERSION"))},setLogLevel:u.Ub,onLog:function(e,t){if(null!==e&&"function"!=typeof e)throw l.create("invalid-log-argument");(0,u.Am)(e,t)},apps:null,SDK_VERSION:"8.6.1",INTERNAL:{registerComponent:o,removeApp:function(e){delete t[e]},components:n,useAsService:function(e,t){return"serverAuth"===t?null:t}}};function i(e){if(e=e||d,!(0,s.r3)(t,e))throw l.create("no-app",{appName:e});return t[e]}function o(o){var a=o.name;if(n.has(a))return f.debug("There were multiple attempts to register component "+a+"."),"PUBLIC"===o.type?r[a]:null;if(n.set(a,o),"PUBLIC"===o.type){var u=function(e){if(void 0===e&&(e=i()),"function"!=typeof e[a])throw l.create("invalid-app-argument",{appName:a});return e[a]()};void 0!==o.serviceProps&&(0,s.ZB)(u,o.serviceProps),r[a]=u,e.prototype[a]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._getService.bind(this,a).apply(this,o.multipleInstances?e:[])}}for(var h=0,c=Object.keys(t);h<c.length;h++){var d=c[h];t[d]._addComponent(o)}return"PUBLIC"===o.type?r[a]:null}return r.default=r,Object.defineProperty(r,"apps",{get:function(){return Object.keys(t).map((function(e){return t[e]}))}}),i.App=e,r}(v);return t.INTERNAL=(0,o.pi)((0,o.pi)({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){(0,s.ZB)(t,e)},createSubscribe:s.ne,ErrorFactory:s.LL,deepExtend:s.ZB}),t}(),y=function(){function e(e){this.container=e}return e.prototype.getPlatformInfoString=function(){return this.container.getProviders().map((function(e){if(function(e){var t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){var t=e.getImmediate();return t.library+"/"+t.version}return null})).filter((function(e){return e})).join(" ")},e}();if((0,s.jU)()&&void 0!==self.firebase){f.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var g=self.firebase.SDK_VERSION;g&&g.indexOf("LITE")>=0&&f.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var m=_.initializeApp;_.initializeApp=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0,s.UG)()&&f.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the @rollup/plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/@rollup/plugin-node-resolve\n      '),m.apply(void 0,e)};var w=_;!function(e,t){e.INTERNAL.registerComponent(new a.wA("platform-logger",(function(e){return new y(e)}),"PRIVATE")),e.registerVersion(c,"0.6.22",void 0),e.registerVersion("fire-js","")}(w);const b=w},909:(e,t,n)=>{n.d(t,{wA:()=>o,H0:()=>u,zt:()=>a});var r=n(655),i=n(589),o=function(){function e(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return e.prototype.setInstantiationMode=function(e){return this.instantiationMode=e,this},e.prototype.setMultipleInstances=function(e){return this.multipleInstances=e,this},e.prototype.setServiceProps=function(e){return this.serviceProps=e,this},e.prototype.setInstanceCreatedCallback=function(e){return this.onInstanceCreated=e,this},e}(),s="[DEFAULT]",a=function(){function e(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.onInitCallbacks=new Set}return e.prototype.get=function(e){void 0===e&&(e=s);var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){var n=new i.BH;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{var r=this.getOrInitializeService({instanceIdentifier:t});r&&n.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise},e.prototype.getImmediate=function(e){var t=(0,r.pi)({identifier:s,optional:!1},e),n=t.identifier,i=t.optional,o=this.normalizeInstanceIdentifier(n);if(!this.isInitialized(o)&&!this.shouldAutoInitialize()){if(i)return null;throw Error("Service "+this.name+" is not available")}try{return this.getOrInitializeService({instanceIdentifier:o})}catch(e){if(i)return null;throw e}},e.prototype.getComponent=function(){return this.component},e.prototype.setComponent=function(e){var t,n;if(e.name!==this.name)throw Error("Mismatching Component "+e.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:s})}catch(e){}try{for(var i=(0,r.XA)(this.instancesDeferred.entries()),o=i.next();!o.done;o=i.next()){var a=(0,r.CR)(o.value,2),u=a[0],h=a[1],l=this.normalizeInstanceIdentifier(u);try{var c=this.getOrInitializeService({instanceIdentifier:l});h.resolve(c)}catch(e){}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}},e.prototype.clearInstance=function(e){void 0===e&&(e=s),this.instancesDeferred.delete(e),this.instances.delete(e)},e.prototype.delete=function(){return(0,r.mG)(this,void 0,void 0,(function(){var e;return(0,r.Jh)(this,(function(t){switch(t.label){case 0:return e=Array.from(this.instances.values()),[4,Promise.all((0,r.ev)((0,r.ev)([],(0,r.CR)(e.filter((function(e){return"INTERNAL"in e})).map((function(e){return e.INTERNAL.delete()})))),(0,r.CR)(e.filter((function(e){return"_delete"in e})).map((function(e){return e._delete()})))))];case 1:return t.sent(),[2]}}))}))},e.prototype.isComponentSet=function(){return null!=this.component},e.prototype.isInitialized=function(e){return void 0===e&&(e=s),this.instances.has(e)},e.prototype.initialize=function(e){var t,n;void 0===e&&(e={});var i=e.instanceIdentifier,o=void 0===i?s:i,a=e.options,u=void 0===a?{}:a,h=this.normalizeInstanceIdentifier(o);if(this.isInitialized(h))throw Error(this.name+"("+h+") has already been initialized");if(!this.isComponentSet())throw Error("Component "+this.name+" has not been registered yet");var l=this.getOrInitializeService({instanceIdentifier:h,options:u});try{for(var c=(0,r.XA)(this.instancesDeferred.entries()),d=c.next();!d.done;d=c.next()){var p=(0,r.CR)(d.value,2),f=p[0],v=p[1];h===this.normalizeInstanceIdentifier(f)&&v.resolve(l)}}catch(e){t={error:e}}finally{try{d&&!d.done&&(n=c.return)&&n.call(c)}finally{if(t)throw t.error}}return this.invokeOnInitCallbacks(l,h),l},e.prototype.onInit=function(e){var t=this;return this.onInitCallbacks.add(e),function(){t.onInitCallbacks.delete(e)}},e.prototype.invokeOnInitCallbacks=function(e,t){var n,i;try{for(var o=(0,r.XA)(this.onInitCallbacks),s=o.next();!s.done;s=o.next()){var a=s.value;try{a(e,t)}catch(e){}}}catch(e){n={error:e}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}},e.prototype.getOrInitializeService=function(e){var t,n=e.instanceIdentifier,r=e.options,i=void 0===r?{}:r,o=this.instances.get(n);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:(t=n,t===s?void 0:t),options:i}),this.instances.set(n,o),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,o)}catch(e){}return o||null},e.prototype.normalizeInstanceIdentifier=function(e){return this.component?this.component.multipleInstances?e:s:e},e.prototype.shouldAutoInitialize=function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode},e}(),u=function(){function e(e){this.name=e,this.providers=new Map}return e.prototype.addComponent=function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component "+e.name+" has already been registered with "+this.name);t.setComponent(e)},e.prototype.addOrOverwriteComponent=function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)},e.prototype.getProvider=function(e){if(this.providers.has(e))return this.providers.get(e);var t=new a(e,this);return this.providers.set(e,t),t},e.prototype.getProviders=function(){return Array.from(this.providers.values())},e}()},446:(e,t,n)=>{var r=n(99),i=n(909),o=n(589),s=n(655),a=n(594);e=n.hmd(e);var u="";function h(e){u=e}var l,c=function(){function e(e){this.domStorage_=e,this.prefix_="firebase:"}return e.prototype.set=function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),(0,o.Pz)(t))},e.prototype.get=function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:(0,o.cI)(t)},e.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))},e.prototype.prefixedName_=function(e){return this.prefix_+e},e.prototype.toString=function(){return this.domStorage_.toString()},e}(),d=function(){function e(){this.cache_={},this.isInMemoryStorage=!0}return e.prototype.set=function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t},e.prototype.get=function(e){return(0,o.r3)(this.cache_,e)?this.cache_[e]:null},e.prototype.remove=function(e){delete this.cache_[e]},e}(),p=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){var t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new c(t)}}catch(e){}return new d},f=p("localStorage"),v=p("sessionStorage"),_=new a.Yd("@firebase/database"),y=(l=1,function(){return l++}),g=function(e){var t=(0,o.dS)(e),n=new o.gQ;n.update(t);var r=n.digest();return o.US.encodeByteArray(r)},m=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n="",r=0;r<e.length;r++){var i=e[r];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?n+=m.apply(null,i):n+="object"==typeof i?(0,o.Pz)(i):i,n+=" "}return n},w=null,b=!0,C=function(e,t){(0,o.hu)(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(_.logLevel=a.in.VERBOSE,w=_.log.bind(_),t&&v.set("logging_enabled",!0)):"function"==typeof e?w=e:(w=null,v.remove("logging_enabled"))},E=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!0===b&&(b=!1,null===w&&!0===v.get("logging_enabled")&&C(!0)),w){var n=m.apply(null,e);w(n)}},T=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];E.apply(void 0,(0,s.ev)([e],(0,s.CR)(t)))}},S=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE INTERNAL ERROR: "+m.apply(void 0,(0,s.ev)([],(0,s.CR)(e)));_.error(n)},k=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE FATAL ERROR: "+m.apply(void 0,(0,s.ev)([],(0,s.CR)(e)));throw _.error(n),new Error(n)},I=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE WARNING: "+m.apply(void 0,(0,s.ev)([],(0,s.CR)(e)));_.warn(n)},P=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},N="[MIN_NAME]",x="[MAX_NAME]",R=function(e,t){if(e===t)return 0;if(e===N||t===x)return-1;if(t===N||e===x)return 1;var n=q(e),r=q(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1},D=function(e,t){return e===t?0:e<t?-1:1},O=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+(0,o.Pz)(t))},A=function(e){if("object"!=typeof e||null===e)return(0,o.Pz)(e);var t=[];for(var n in e)t.push(n);t.sort();for(var r="{",i=0;i<t.length;i++)0!==i&&(r+=","),r+=(0,o.Pz)(t[i]),r+=":",r+=A(e[t[i]]);return r+"}"},M=function(e,t){var n=e.length;if(n<=t)return[e];for(var r=[],i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function L(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}var F=function(e){(0,o.hu)(!P(e),"Invalid JSON number");var t,n,r,i,s;0===e?(n=0,r=0,t=1/e==-1/0?1:0):(t=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,r=Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,r=Math.round(e/Math.pow(2,-1074))));var a=[];for(s=52;s;s-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;s-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(t?1:0),a.reverse();var u=a.join(""),h="";for(s=0;s<64;s+=8){var l=parseInt(u.substr(s,8),2).toString(16);1===l.length&&(l="0"+l),h+=l}return h.toLowerCase()},W=new RegExp("^-?(0*)\\d{1,10}$"),q=function(e){if(W.test(e)){var t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},H=function(e){try{e()}catch(e){setTimeout((function(){var t=e.stack||"";throw I("Exception was thrown by user callback.",t),e}),Math.floor(0))}},U=function(e,t){var n=setTimeout(e,t);return"object"==typeof n&&n.unref&&n.unref(),n},j=function(){function e(e,t){var n=this;this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then((function(e){return n.appCheck=e}))}return e.prototype.getToken=function(e){var t=this;return this.appCheck?this.appCheck.getToken(e):new Promise((function(n,r){setTimeout((function(){t.appCheck?t.getToken(e).then(n,r):n(null)}),0)}))},e.prototype.addTokenChangeListener=function(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((function(t){return t.addTokenListener(e)}))},e.prototype.notifyForInvalidToken=function(){I('Provided AppCheck credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly.')},e}(),B=function(){function e(e,t,n){var r=this;this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((function(e){return r.auth_=e}))}return e.prototype.getToken=function(e){var t=this;return this.auth_?this.auth_.getToken(e).catch((function(e){return e&&"auth/token-not-initialized"===e.code?(E("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)})):new Promise((function(n,r){setTimeout((function(){t.auth_?t.getToken(e).then(n,r):n(null)}),0)}))},e.prototype.addTokenChangeListener=function(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((function(t){return t.addAuthTokenListener(e)}))},e.prototype.removeTokenChangeListener=function(e){this.authProvider_.get().then((function(t){return t.removeAuthTokenListener(e)}))},e.prototype.notifyForInvalidToken=function(){var e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',I(e)},e}(),z=function(){function e(e){this.accessToken=e}return e.prototype.getToken=function(e){return Promise.resolve({accessToken:this.accessToken})},e.prototype.addTokenChangeListener=function(e){e(this.accessToken)},e.prototype.removeTokenChangeListener=function(e){},e.prototype.notifyForInvalidToken=function(){},e.OWNER="owner",e}(),V=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,G="websocket",Y="long_polling",K=function(){function e(e,t,n,r,i,o,s){void 0===i&&(i=!1),void 0===o&&(o=""),void 0===s&&(s=!1),this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=s,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=f.get("host:"+e)||this._host}return e.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},e.prototype.isCustomHost=function(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain},Object.defineProperty(e.prototype,"host",{get:function(){return this._host},set:function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&f.set("host:"+this._host,this.internalHost))},enumerable:!1,configurable:!0}),e.prototype.toString=function(){var e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e},e.prototype.toURLString=function(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?"?ns="+this.namespace:"";return""+e+this.host+"/"+t},e}();function Q(e,t,n){var r;if((0,o.hu)("string"==typeof t,"typeof type must == string"),(0,o.hu)("object"==typeof n,"typeof params must == object"),t===G)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Y)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);var i=[];return L(n,(function(e,t){i.push(e+"="+t)})),r+i.join("&")}var $=function(){function e(){this.counters_={}}return e.prototype.incrementCounter=function(e,t){void 0===t&&(t=1),(0,o.r3)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t},e.prototype.get=function(){return(0,o.p$)(this.counters_)},e}(),J={},Z={};function X(e){var t=e.toString();return J[t]||(J[t]=new $),J[t]}var ee=function(){function e(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return e.prototype.closeAfter=function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},e.prototype.handleResponse=function(e,t){var n=this;this.pendingResponses[e]=t;for(var r=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var t=function(t){e[t]&&H((function(){n.onMessage_(e[t])}))},r=0;r<e.length;++r)t(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum]&&"break"!==r(););},e}(),te="start",ne="close",re=function(){function e(e,t,n,r,i,o,s){var a=this;this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=o,this.lastSessionId=s,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=T(e),this.stats_=X(t),this.urlFn=function(e){return a.appCheckToken&&(e.ac=a.appCheckToken),Q(t,Y,e)}}return e.prototype.open=function(e,t){var n=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new ee(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if((0,o.Yr)()||"complete"===document.readyState)e();else{var t=!1,n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((function(){if(!n.isClosed_){n.scriptTagHolder=new ie((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(0,s.CR)(e,5),i=r[0],o=r[1],a=r[2];if(r[3],r[4],n.incrementIncomingBytes_(e),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,i===te)n.id=o,n.password=a;else{if(i!==ne)throw new Error("Unrecognized command received: "+i);o?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(o,(function(){n.onClosed_()}))):n.onClosed_()}}),(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(0,s.CR)(e,2),i=r[0],o=r[1];n.incrementIncomingBytes_(e),n.myPacketOrderer.handleResponse(i,o)}),(function(){n.onClosed_()}),n.urlFn);var e={start:"t"};e.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=n.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",n.transportSessionId&&(e.s=n.transportSessionId),n.lastSessionId&&(e.ls=n.lastSessionId),n.applicationId&&(e.p=n.applicationId),n.appCheckToken&&(e.ac=n.appCheckToken),"undefined"!=typeof location&&location.hostname&&V.test(location.hostname)&&(e.r="f");var t=n.urlFn(e);n.log_("Connecting via long-poll to "+t),n.scriptTagHolder.addTag(t,(function(){}))}}))},e.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},e.forceAllow=function(){e.forceAllow_=!0},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){return!((0,o.Yr)()||!e.forceAllow_&&(e.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))},e.prototype.markConnectionHealthy=function(){},e.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},e.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},e.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},e.prototype.send=function(e){var t=(0,o.Pz)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);for(var n=(0,o.h$)(t),r=M(n,1840),i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++},e.prototype.addDisconnectPingFrame=function(e,t){if(!(0,o.Yr)()){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},e.prototype.incrementIncomingBytes_=function(e){var t=(0,o.Pz)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)},e}(),ie=function(){function e(t,n,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,(0,o.Yr)())this.commandCB=t,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=y(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=e.createIFrame_();var s="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(s='<script>document.domain="'+document.domain+'";<\/script>');var a="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(e){E("frame writing exception"),e.stack&&E(e.stack),E(e)}}}return e.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||E("No IE domain setting required")}catch(n){var t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},e.prototype.close=function(){var e=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout((function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)}),Math.floor(0)));var t=this.onDisconnect;t&&(this.onDisconnect=null,t())},e.prototype.startLongPoll=function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););},e.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;for(var t=this.urlFn(e),n="",r=0;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+n.length<=1870;){var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1},e.prototype.enqueueSegment=function(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()},e.prototype.addLongPollTag_=function(e,t){var n=this;this.outstandingRequests.add(t);var r=function(){n.outstandingRequests.delete(t),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(e,(function(){clearTimeout(i),r()}))},e.prototype.addTag=function(e,t){var n=this;(0,o.Yr)()?this.doNodeLongPoll(e,t):setTimeout((function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){var e=r.readyState;e&&"loaded"!==e&&"complete"!==e||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=function(){E("Long-poll script failed to load: "+e),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(e){}}),Math.floor(1))},e}(),oe=null;"undefined"!=typeof MozWebSocket?oe=MozWebSocket:"undefined"!=typeof WebSocket&&(oe=WebSocket);var se=function(){function e(t,n,r,i,o,s,a){this.connId=t,this.applicationId=r,this.appCheckToken=i,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=T(this.connId),this.stats_=X(n),this.connURL=e.connectionURL_(n,s,a,i),this.nodeAdmin=n.nodeAdmin}return e.connectionURL_=function(e,t,n,r){var i={v:"5"};return!(0,o.Yr)()&&"undefined"!=typeof location&&location.hostname&&V.test(location.hostname)&&(i.r="f"),t&&(i.s=t),n&&(i.ls=n),r&&(i.ac=r),Q(e,G,i)},e.prototype.open=function(e,t){var n=this;this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,f.set("previous_websocket_failure",!0);try{if((0,o.Yr)()){var r=this.nodeAdmin?"AdminNode":"Node",i={headers:{"User-Agent":"Firebase/5/"+u+"/"+process.platform+"/"+r,"X-Firebase-GMPID":this.applicationId||""}};this.nodeAdmin?i.headers.Authorization=this.authToken||"":i.headers["X-Firebase-AppCheck"]=this.appCheckToken||"";var s=process.env,a=0===this.connURL.indexOf("wss://")?s.HTTPS_PROXY||s.https_proxy:s.HTTP_PROXY||s.http_proxy;a&&(i.proxy={origin:a}),this.mySock=new oe(this.connURL,[],i)}else i={headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}},this.mySock=new oe(this.connURL,[],i)}catch(e){this.log_("Error instantiating WebSocket.");var h=e.message||e.data;return h&&this.log_(h),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(e){n.handleIncomingFrame(e)},this.mySock.onerror=function(e){n.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&n.log_(t),n.onClosed_()}},e.prototype.start=function(){},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){var t=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(t=!0)}return!t&&null!==oe&&!e.forceDisallow_},e.previouslyFailed=function(){return f.isInMemoryStorage||!0===f.get("previous_websocket_failure")},e.prototype.markConnectionHealthy=function(){f.remove("previous_websocket_failure")},e.prototype.appendFrame_=function(e){if(this.frames.push(e),this.frames.length===this.totalFrames){var t=this.frames.join("");this.frames=null;var n=(0,o.cI)(t);this.onMessage(n)}},e.prototype.handleNewFrameCount_=function(e){this.totalFrames=e,this.frames=[]},e.prototype.extractFrameCount_=function(e){if((0,o.hu)(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e},e.prototype.handleIncomingFrame=function(e){if(null!==this.mySock){var t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{var n=this.extractFrameCount_(t);null!==n&&this.appendFrame_(n)}}},e.prototype.send=function(e){this.resetKeepAlive();var t=(0,o.Pz)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var n=M(t,16384);n.length>1&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},e.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},e.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},e.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},e.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()}),Math.floor(45e3))},e.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},e.responsesRequiredToBeHealthy=2,e.healthyTimeout=3e4,e}(),ae=function(){function e(e){this.initTransports_(e)}return Object.defineProperty(e,"ALL_TRANSPORTS",{get:function(){return[re,se]},enumerable:!1,configurable:!0}),e.prototype.initTransports_=function(t){var n,r,i=se&&se.isAvailable(),o=i&&!se.previouslyFailed();if(t.webSocketOnly&&(i||I("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),o=!0),o)this.transports_=[se];else{var a=this.transports_=[];try{for(var u=(0,s.XA)(e.ALL_TRANSPORTS),h=u.next();!h.done;h=u.next()){var l=h.value;l&&l.isAvailable()&&a.push(l)}}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}},e.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},e.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},e}(),ue=function(){function e(e,t,n,r,i,o,s,a,u,h){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=o,this.onReady_=s,this.onDisconnect_=a,this.onKill_=u,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=T("c:"+this.id+":"),this.transportManager_=new ae(t),this.log_("Connection created"),this.start_()}return e.prototype.start_=function(){var e=this,t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((function(){e.conn_&&e.conn_.open(n,r)}),Math.floor(0));var i=t.healthyTimeout||0;i>0&&(this.healthyTimeout_=U((function(){e.healthyTimeout_=null,e.isHealthy_||(e.conn_&&e.conn_.bytesReceived>102400?(e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy."),e.isHealthy_=!0,e.conn_.markConnectionHealthy()):e.conn_&&e.conn_.bytesSent>10240?e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive."):(e.log_("Closing unhealthy connection after timeout."),e.close()))}),Math.floor(i)))},e.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},e.prototype.disconnReceiver_=function(e){var t=this;return function(n){e===t.conn_?t.onConnectionLost_(n):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}},e.prototype.connReceiver_=function(e){var t=this;return function(n){2!==t.state_&&(e===t.rx_?t.onPrimaryMessageReceived_(n):e===t.secondaryConn_?t.onSecondaryMessageReceived_(n):t.log_("message on old connection"))}},e.prototype.sendRequest=function(e){var t={t:"d",d:e};this.sendData_(t)},e.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},e.prototype.onSecondaryControl_=function(e){if("t"in e){var t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},e.prototype.onSecondaryMessageReceived_=function(e){var t=O("t",e),n=O("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}},e.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},e.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},e.prototype.onPrimaryMessageReceived_=function(e){var t=O("t",e),n=O("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)},e.prototype.onDataMessage_=function(e){this.onPrimaryResponse_(),this.onMessage_(e)},e.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},e.prototype.onControl_=function(e){var t=O("t",e);if("d"in e){var n=e.d;if("h"===t)this.onHandshake_(n);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?S("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):S("Unknown control packet command: "+t)}},e.prototype.onHandshake_=function(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&I("Protocol version mismatch detected"),this.tryStartUpgrade_())},e.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)},e.prototype.startUpgrade_=function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),U((function(){t.secondaryConn_&&(t.log_("Timed out trying to upgrade."),t.secondaryConn_.close())}),Math.floor(6e4))},e.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())},e.prototype.onConnectionEstablished_=function(e,t){var n=this;this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):U((function(){n.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))},e.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},e.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()},e.prototype.onConnectionLost_=function(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(f.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},e.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()},e.prototype.sendData_=function(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)},e.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},e.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},e}(),he=function(){function e(){}return e.prototype.put=function(e,t,n,r){},e.prototype.merge=function(e,t,n,r){},e.prototype.refreshAuthToken=function(e){},e.prototype.refreshAppCheckToken=function(e){},e.prototype.onDisconnectPut=function(e,t,n){},e.prototype.onDisconnectMerge=function(e,t,n){},e.prototype.onDisconnectCancel=function(e,t){},e.prototype.reportStats=function(e){},e}(),le=function(){function e(e){this.allowedEvents_=e,this.listeners_={},(0,o.hu)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}return e.prototype.trigger=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Array.isArray(this.listeners_[e]))for(var r=(0,s.ev)([],(0,s.CR)(this.listeners_[e])),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,t)},e.prototype.on=function(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)},e.prototype.off=function(e,t,n){this.validateEventType_(e);for(var r=this.listeners_[e]||[],i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)},e.prototype.validateEventType_=function(e){(0,o.hu)(this.allowedEvents_.find((function(t){return t===e})),"Unknown event: "+e)},e}(),ce=function(e){function t(){var t=e.call(this,["online"])||this;return t.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||(0,o.uI)()||(window.addEventListener("online",(function(){t.online_||(t.online_=!0,t.trigger("online",!0))}),!1),window.addEventListener("offline",(function(){t.online_&&(t.online_=!1,t.trigger("online",!1))}),!1)),t}return(0,s.ZT)(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return(0,o.hu)("online"===e,"Unknown event type: "+e),[this.online_]},t.prototype.currentlyOnline=function(){return this.online_},t}(le),de=function(){function e(e,t){if(void 0===t){this.pieces_=e.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}return e.prototype.toString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"},e}();function pe(){return new de("")}function fe(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function ve(e){return e.pieces_.length-e.pieceNum_}function _e(e){var t=e.pieceNum_;return t<e.pieces_.length&&t++,new de(e.pieces_,t)}function ye(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function ge(e,t){return void 0===t&&(t=0),e.pieces_.slice(e.pieceNum_+t)}function me(e){if(e.pieceNum_>=e.pieces_.length)return null;for(var t=[],n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new de(t,0)}function we(e,t){for(var n=[],r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);if(t instanceof de)for(r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else{var i=t.split("/");for(r=0;r<i.length;r++)i[r].length>0&&n.push(i[r])}return new de(n,0)}function be(e){return e.pieceNum_>=e.pieces_.length}function Ce(e,t){var n=fe(e),r=fe(t);if(null===n)return t;if(n===r)return Ce(_e(e),_e(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Ee(e,t){for(var n=ge(e,0),r=ge(t,0),i=0;i<n.length&&i<r.length;i++){var o=R(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1}function Te(e,t){if(ve(e)!==ve(t))return!1;for(var n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function Se(e,t){var n=e.pieceNum_,r=t.pieceNum_;if(ve(e)>ve(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}var ke=function(e,t){this.errorPrefix_=t,this.parts_=ge(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=(0,o.ug)(this.parts_[n]);Ie(this)};function Ie(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+Pe(e))}function Pe(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}var Ne,xe,Re=function(e){function t(){var t,n,r=e.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(n="visibilitychange",t="hidden"):void 0!==document.mozHidden?(n="mozvisibilitychange",t="mozHidden"):void 0!==document.msHidden?(n="msvisibilitychange",t="msHidden"):void 0!==document.webkitHidden&&(n="webkitvisibilitychange",t="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,(function(){var e=!document[t];e!==r.visible_&&(r.visible_=e,r.trigger("visible",e))}),!1),r}return(0,s.ZT)(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return(0,o.hu)("visible"===e,"Unknown event type: "+e),[this.visible_]},t}(le),De=1e3,Oe=function(e){function t(n,r,i,s,a,u,h,l){var c=e.call(this)||this;if(c.repoInfo_=n,c.applicationId_=r,c.onDataUpdate_=i,c.onConnectStatus_=s,c.onServerInfoUpdate_=a,c.authTokenProvider_=u,c.appCheckTokenProvider_=h,c.authOverride_=l,c.id=t.nextPersistentConnectionId_++,c.log_=T("p:"+c.id+":"),c.interruptReasons_={},c.listens=new Map,c.outstandingPuts_=[],c.outstandingGets_=[],c.outstandingPutCount_=0,c.outstandingGetCount_=0,c.onDisconnectRequestQueue_=[],c.connected_=!1,c.reconnectDelay_=De,c.maxReconnectDelay_=3e5,c.securityDebugCallback_=null,c.lastSessionId=null,c.establishConnectionTimer_=null,c.visible_=!1,c.requestCBHash_={},c.requestNumber_=0,c.realtime_=null,c.authToken_=null,c.appCheckToken_=null,c.forceTokenRefresh_=!1,c.invalidAuthTokenCount_=0,c.invalidAppCheckTokenCount_=0,c.firstConnection_=!0,c.lastConnectionAttemptTime_=null,c.lastConnectionEstablishedTime_=null,l&&!(0,o.Yr)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return Re.getInstance().on("visible",c.onVisible_,c),-1===n.host.indexOf("fblocal")&&ce.getInstance().on("online",c.onOnline_,c),c}return(0,s.ZT)(t,e),t.prototype.sendRequest=function(e,t,n){var r=++this.requestNumber_,i={r,a:e,b:t};this.log_((0,o.Pz)(i)),(0,o.hu)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},t.prototype.get=function(e){var t=this;this.initConnection_();var n=new o.BH,r={p:e._path.toString(),q:e._queryObject},i={action:"g",request:r,onComplete:function(e){var i=e.d;"ok"===e.s?(t.onDataUpdate_(r.p,i,!1,null),n.resolve(i)):n.reject(i)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;var s=this.outstandingGets_.length-1;return this.connected_||setTimeout((function(){var e=t.outstandingGets_[s];void 0!==e&&i===e&&(delete t.outstandingGets_[s],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),t.log_("get "+s+" timed out on connection"),n.reject(new Error("Client is offline.")))}),3e3),this.connected_&&this.sendGet_(s),n.promise},t.prototype.listen=function(e,t,n,r){this.initConnection_();var i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),(0,o.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),(0,o.hu)(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,a),this.connected_&&this.sendListen_(a)},t.prototype.sendGet_=function(e){var t=this,n=this.outstandingGets_[e];this.sendRequest("g",n.request,(function(r){delete t.outstandingGets_[e],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),n.onComplete&&n.onComplete(r)}))},t.prototype.sendListen_=function(e){var n=this,r=e.query,i=r._path.toString(),o=r._queryIdentifier;this.log_("Listen on "+i+" for "+o);var s={p:i};e.tag&&(s.q=r._queryObject,s.t=e.tag),s.h=e.hashFn(),this.sendRequest("q",s,(function(s){var a=s.d,u=s.s;t.warnOnListenWarnings_(a,r),(n.listens.get(i)&&n.listens.get(i).get(o))===e&&(n.log_("listen response",s),"ok"!==u&&n.removeListen_(i,o),e.onComplete&&e.onComplete(u,a))}))},t.warnOnListenWarnings_=function(e,t){if(e&&"object"==typeof e&&(0,o.r3)(e,"w")){var n=(0,o.DV)(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+t._queryParams.getIndex().toString()+'"',i=t._path.toString();I("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},t.prototype.refreshAuthToken=function(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(function(){})),this.reduceReconnectDelayIfAdminCredential_(e)},t.prototype.reduceReconnectDelayIfAdminCredential_=function(e){(e&&40===e.length||(0,o.GJ)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},t.prototype.refreshAppCheckToken=function(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(function(){}))},t.prototype.tryAuth=function(){var e=this;if(this.connected_&&this.authToken_){var t=this.authToken_,n=(0,o.w9)(t)?"auth":"gauth",r={cred:t};null===this.authOverride_?r.noauth=!0:"object"==typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(n,r,(function(n){var r=n.s,i=n.d||"error";e.authToken_===t&&("ok"===r?e.invalidAuthTokenCount_=0:e.onAuthRevoked_(r,i))}))}},t.prototype.tryAppCheck=function(){var e=this;this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(function(t){var n=t.s,r=t.d||"error";"ok"===n?e.invalidAppCheckTokenCount_=0:e.onAppCheckRevoked_(n,r)}))},t.prototype.unlisten=function(e,t){var n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),(0,o.hu)(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)},t.prototype.sendUnlisten_=function(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);var i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},t.prototype.onDisconnectPut=function(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})},t.prototype.onDisconnectMerge=function(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})},t.prototype.onDisconnectCancel=function(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})},t.prototype.sendOnDisconnect_=function(e,t,n,r){var i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,(function(e){r&&setTimeout((function(){r(e.s,e.d)}),Math.floor(0))}))},t.prototype.put=function(e,t,n,r){this.putInternal("p",e,t,n,r)},t.prototype.merge=function(e,t,n,r){this.putInternal("m",e,t,n,r)},t.prototype.putInternal=function(e,t,n,r,i){this.initConnection_();var o={p:t,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:e,request:o,onComplete:r}),this.outstandingPutCount_++;var s=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(s):this.log_("Buffering put: "+t)},t.prototype.sendPut_=function(e){var t=this,n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,(function(r){t.log_(n+" response",r),delete t.outstandingPuts_[e],t.outstandingPutCount_--,0===t.outstandingPutCount_&&(t.outstandingPuts_=[]),i&&i(r.s,r.d)}))},t.prototype.reportStats=function(e){var t=this;if(this.connected_){var n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,(function(e){if("ok"!==e.s){var n=e.d;t.log_("reportStats","Error sending stats: "+n)}}))}},t.prototype.onDataMessage_=function(e){if("r"in e){this.log_("from server: "+(0,o.Pz)(e));var t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}},t.prototype.onDataPush_=function(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):S("Unrecognized action received from server: "+(0,o.Pz)(e)+"\nAre you using the latest client?")},t.prototype.onReady_=function(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},t.prototype.scheduleConnect_=function(e){var t=this;(0,o.hu)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((function(){t.establishConnectionTimer_=null,t.establishConnection_()}),Math.floor(e))},t.prototype.initConnection_=function(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)},t.prototype.onVisible_=function(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=De,this.realtime_||this.scheduleConnect_(0)),this.visible_=e},t.prototype.onOnline_=function(e){e?(this.log_("Browser went online."),this.reconnectDelay_=De,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},t.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=De),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());var e=(new Date).getTime()-this.lastConnectionAttemptTime_,t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},t.prototype.establishConnection_=function(){return(0,s.mG)(this,void 0,void 0,(function(){var e,n,r,i,a,u,h,l,c,d,p,f,v,_,y=this;return(0,s.Jh)(this,(function(g){switch(g.label){case 0:if(!this.shouldReconnect_())return[3,4];this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null,e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+t.nextConnectionId_++,a=this.lastSessionId,u=!1,h=null,l=function(){h?h.close():(u=!0,r())},c=function(e){(0,o.hu)(h,"sendRequest call when we're not connected not allowed."),h.sendRequest(e)},this.realtime_={close:l,sendRequest:c},d=this.forceTokenRefresh_,this.forceTokenRefresh_=!1,g.label=1;case 1:return g.trys.push([1,3,,4]),[4,Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)])];case 2:return p=s.CR.apply(void 0,[g.sent(),2]),f=p[0],v=p[1],u?E("getToken() completed but was canceled"):(E("getToken() completed. Creating connection."),this.authToken_=f&&f.accessToken,this.appCheckToken_=v&&v.token,h=new ue(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,r,(function(e){I(e+" ("+y.repoInfo_.toString()+")"),y.interrupt("server_kill")}),a)),[3,4];case 3:return _=g.sent(),this.log_("Failed to get token: "+_),u||(this.repoInfo_.nodeAdmin&&I(_),l()),[3,4];case 4:return[2]}}))}))},t.prototype.interrupt=function(e){E("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},t.prototype.resume=function(e){E("Resuming connection for reason: "+e),delete this.interruptReasons_[e],(0,o.xb)(this.interruptReasons_)&&(this.reconnectDelay_=De,this.realtime_||this.scheduleConnect_(0))},t.prototype.handleTimestamp_=function(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})},t.prototype.cancelSentTransactions_=function(){for(var e=0;e<this.outstandingPuts_.length;e++){var t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},t.prototype.onListenRevoked_=function(e,t){var n;n=t?t.map((function(e){return A(e)})).join("$"):"default";var r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")},t.prototype.removeListen_=function(e,t){var n,r=new de(e).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(t),i.delete(t),0===i.size&&this.listens.delete(r)}else n=void 0;return n},t.prototype.onAuthRevoked_=function(e,t){E("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},t.prototype.onAppCheckRevoked_=function(e,t){E("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())},t.prototype.onSecurityDebugPacket_=function(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))},t.prototype.restoreState_=function(){var e,t,n,r;this.tryAuth(),this.tryAppCheck();try{for(var i=(0,s.XA)(this.listens.values()),o=i.next();!o.done;o=i.next()){var a=o.value;try{for(var u=(n=void 0,(0,s.XA)(a.values())),h=u.next();!h.done;h=u.next()){var l=h.value;this.sendListen_(l)}}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}for(var c=0;c<this.outstandingPuts_.length;c++)this.outstandingPuts_[c]&&this.sendPut_(c);for(;this.onDisconnectRequestQueue_.length;){var d=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(d.action,d.pathString,d.data,d.onComplete)}for(c=0;c<this.outstandingGets_.length;c++)this.outstandingGets_[c]&&this.sendGet_(c)},t.prototype.sendConnectStats_=function(){var e={},t="js";(0,o.Yr)()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+u.replace(/\./g,"-")]=1,(0,o.uI)()?e["framework.cordova"]=1:(0,o.b$)()&&(e["framework.reactnative"]=1),this.reportStats(e)},t.prototype.shouldReconnect_=function(){var e=ce.getInstance().currentlyOnline();return(0,o.xb)(this.interruptReasons_)&&e},t.nextPersistentConnectionId_=0,t.nextConnectionId_=0,t}(he),Ae=function(){function e(e,t){this.name=e,this.node=t}return e.Wrap=function(t,n){return new e(t,n)},e}(),Me=function(){function e(){}return e.prototype.getCompare=function(){return this.compare.bind(this)},e.prototype.indexedValueChanged=function(e,t){var n=new Ae(N,e),r=new Ae(N,t);return 0!==this.compare(n,r)},e.prototype.minPost=function(){return Ae.MIN},e}(),Le=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,s.ZT)(t,e),Object.defineProperty(t,"__EMPTY_NODE",{get:function(){return Ne},set:function(e){Ne=e},enumerable:!1,configurable:!0}),t.prototype.compare=function(e,t){return R(e.name,t.name)},t.prototype.isDefinedOn=function(e){throw(0,o.g5)("KeyIndex.isDefinedOn not expected to be called.")},t.prototype.indexedValueChanged=function(e,t){return!1},t.prototype.minPost=function(){return Ae.MIN},t.prototype.maxPost=function(){return new Ae(x,Ne)},t.prototype.makePost=function(e,t){return(0,o.hu)("string"==typeof e,"KeyIndex indexValue must always be a string."),new Ae(e,Ne)},t.prototype.toString=function(){return".key"},t}(Me),Fe=new Le,We=function(){function e(e,t,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!e.isEmpty();)if(e=e,o=t?n(e.key,t):1,r&&(o*=-1),o<0)e=this.isReverse_?e.left:e.right;else{if(0===o){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}return e.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e},e.prototype.hasNext=function(){return this.nodeStack_.length>0},e.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}},e}(),qe=function(){function e(t,n,r,i,o){this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:Ue.EMPTY_NODE,this.right=null!=o?o:Ue.EMPTY_NODE}return e.prototype.copy=function(t,n,r,i,o){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},e.prototype.count=function(){return this.left.count()+1+this.right.count()},e.prototype.isEmpty=function(){return!1},e.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},e.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},e.prototype.minKey=function(){return this.min_().key},e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},e.prototype.insert=function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()},e.prototype.removeMin_=function(){if(this.left.isEmpty())return Ue.EMPTY_NODE;var e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()},e.prototype.remove=function(e,t){var n,r;if(t(e,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Ue.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()},e.prototype.isRed_=function(){return this.color},e.prototype.fixUp_=function(){var e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e},e.prototype.moveRedLeft_=function(){var e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e},e.prototype.moveRedRight_=function(){var e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e},e.prototype.rotateLeft_=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},e.prototype.rotateRight_=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},e.prototype.colorFlip_=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},e.prototype.checkMaxDepth_=function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1},e.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)},e.RED=!0,e.BLACK=!1,e}(),He=function(){function e(){}return e.prototype.copy=function(e,t,n,r,i){return this},e.prototype.insert=function(e,t,n){return new qe(e,t,null)},e.prototype.remove=function(e,t){return this},e.prototype.count=function(){return 0},e.prototype.isEmpty=function(){return!0},e.prototype.inorderTraversal=function(e){return!1},e.prototype.reverseTraversal=function(e){return!1},e.prototype.minKey=function(){return null},e.prototype.maxKey=function(){return null},e.prototype.check_=function(){return 0},e.prototype.isRed_=function(){return!1},e}(),Ue=function(){function e(t,n){void 0===n&&(n=e.EMPTY_NODE),this.comparator_=t,this.root_=n}return e.prototype.insert=function(t,n){return new e(this.comparator_,this.root_.insert(t,n,this.comparator_).copy(null,null,qe.BLACK,null,null))},e.prototype.remove=function(t){return new e(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,qe.BLACK,null,null))},e.prototype.get=function(e){for(var t,n=this.root_;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null},e.prototype.getPredecessorKey=function(e){for(var t,n=this.root_,r=null;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},e.prototype.isEmpty=function(){return this.root_.isEmpty()},e.prototype.count=function(){return this.root_.count()},e.prototype.minKey=function(){return this.root_.minKey()},e.prototype.maxKey=function(){return this.root_.maxKey()},e.prototype.inorderTraversal=function(e){return this.root_.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.root_.reverseTraversal(e)},e.prototype.getIterator=function(e){return new We(this.root_,null,this.comparator_,!1,e)},e.prototype.getIteratorFrom=function(e,t){return new We(this.root_,e,this.comparator_,!1,t)},e.prototype.getReverseIteratorFrom=function(e,t){return new We(this.root_,e,this.comparator_,!0,t)},e.prototype.getReverseIterator=function(e){return new We(this.root_,null,this.comparator_,!0,e)},e.EMPTY_NODE=new He,e}();function je(e,t){return R(e.name,t.name)}function Be(e,t){return R(e,t)}var ze,Ve,Ge,Ye,Ke,Qe=function(e){return"number"==typeof e?"number:"+F(e):"string:"+e},$e=function(e){if(e.isLeafNode()){var t=e.val();(0,o.hu)("string"==typeof t||"number"==typeof t||"object"==typeof t&&(0,o.r3)(t,".sv"),"Priority must be a string or number.")}else(0,o.hu)(e===xe||e.isEmpty(),"priority of unexpected type.");(0,o.hu)(e===xe||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},Je=function(){function e(t,n){void 0===n&&(n=e.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=n,this.lazyHash_=null,(0,o.hu)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),$e(this.priorityNode_)}return Object.defineProperty(e,"__childrenNodeConstructor",{get:function(){return ze},set:function(e){ze=e},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!0},e.prototype.getPriority=function(){return this.priorityNode_},e.prototype.updatePriority=function(t){return new e(this.value_,t)},e.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.getChild=function(t){return be(t)?this:".priority"===fe(t)?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.hasChild=function(){return!1},e.prototype.getPredecessorChildName=function(e,t){return null},e.prototype.updateImmediateChild=function(t,n){return".priority"===t?this.updatePriority(n):n.isEmpty()&&".priority"!==t?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)},e.prototype.updateChild=function(t,n){var r=fe(t);return null===r?n:n.isEmpty()&&".priority"!==r?this:((0,o.hu)(".priority"!==r||1===ve(t),".priority must be the last token in a path"),this.updateImmediateChild(r,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(_e(t),n)))},e.prototype.isEmpty=function(){return!1},e.prototype.numChildren=function(){return 0},e.prototype.forEachChild=function(e,t){return!1},e.prototype.val=function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+Qe(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"===t?F(this.value_):this.value_,this.lazyHash_=g(e)}return this.lazyHash_},e.prototype.getValue=function(){return this.value_},e.prototype.compareTo=function(t){return t===e.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof e.__childrenNodeConstructor?-1:((0,o.hu)(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},e.prototype.compareToLeafNode_=function(t){var n=typeof t.value_,r=typeof this.value_,i=e.VALUE_TYPE_ORDER.indexOf(n),s=e.VALUE_TYPE_ORDER.indexOf(r);return(0,o.hu)(i>=0,"Unknown leaf type: "+n),(0,o.hu)(s>=0,"Unknown leaf type: "+r),i===s?"object"===r?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:s-i},e.prototype.withIndex=function(){return this},e.prototype.isIndexed=function(){return!0},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode()){var t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1},e.VALUE_TYPE_ORDER=["object","boolean","number","string"],e}(),Ze=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,s.ZT)(t,e),t.prototype.compare=function(e,t){var n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?R(e.name,t.name):i},t.prototype.isDefinedOn=function(e){return!e.getPriority().isEmpty()},t.prototype.indexedValueChanged=function(e,t){return!e.getPriority().equals(t.getPriority())},t.prototype.minPost=function(){return Ae.MIN},t.prototype.maxPost=function(){return new Ae(x,new Je("[PRIORITY-POST]",Ge))},t.prototype.makePost=function(e,t){var n=Ve(e);return new Ae(t,new Je("[PRIORITY-POST]",n))},t.prototype.toString=function(){return".priority"},t}(Me)),Xe=Math.log(2),et=function(){function e(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Xe,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&r}return e.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e},e}(),tt=function(e,t,n,r){e.sort(t);var i=function(t,r){var o,s,a=r-t;if(0===a)return null;if(1===a)return o=e[t],s=n?n(o):o,new qe(s,o.node,qe.BLACK,null,null);var u=parseInt(a/2,10)+t,h=i(t,u),l=i(u+1,r);return o=e[u],s=n?n(o):o,new qe(s,o.node,qe.BLACK,h,l)},o=function(t){for(var r=null,o=null,s=e.length,a=function(t,r){var o=s-t,a=s;s-=t;var h=i(o+1,a),l=e[o],c=n?n(l):l;u(new qe(c,l.node,r,null,h))},u=function(e){r?(r.left=e,r=e):(o=e,r=e)},h=0;h<t.count;++h){var l=t.nextBitIsOne(),c=Math.pow(2,t.count-(h+1));l?a(c,qe.BLACK):(a(c,qe.BLACK),a(c,qe.RED))}return o}(new et(e.length));return new Ue(r||t,o)},nt={},rt=function(){function e(e,t){this.indexes_=e,this.indexSet_=t}return Object.defineProperty(e,"Default",{get:function(){return(0,o.hu)(nt&&Ze,"ChildrenNode.ts has not been loaded"),Ye=Ye||new e({".priority":nt},{".priority":Ze})},enumerable:!1,configurable:!0}),e.prototype.get=function(e){var t=(0,o.DV)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Ue?t:null},e.prototype.hasIndex=function(e){return(0,o.r3)(this.indexSet_,e.toString())},e.prototype.addIndex=function(t,n){(0,o.hu)(t!==Fe,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var r,i=[],a=!1,u=n.getIterator(Ae.Wrap),h=u.getNext();h;)a=a||t.isDefinedOn(h.node),i.push(h),h=u.getNext();r=a?tt(i,t.getCompare()):nt;var l=t.toString(),c=(0,s.pi)({},this.indexSet_);c[l]=t;var d=(0,s.pi)({},this.indexes_);return d[l]=r,new e(d,c)},e.prototype.addToIndexes=function(t,n){var r=this;return new e((0,o.UI)(this.indexes_,(function(e,i){var s=(0,o.DV)(r.indexSet_,i);if((0,o.hu)(s,"Missing index implementation for "+i),e===nt){if(s.isDefinedOn(t.node)){for(var a=[],u=n.getIterator(Ae.Wrap),h=u.getNext();h;)h.name!==t.name&&a.push(h),h=u.getNext();return a.push(t),tt(a,s.getCompare())}return nt}var l=n.get(t.name),c=e;return l&&(c=c.remove(new Ae(t.name,l))),c.insert(t,t.node)})),this.indexSet_)},e.prototype.removeFromIndexes=function(t,n){return new e((0,o.UI)(this.indexes_,(function(e){if(e===nt)return e;var r=n.get(t.name);return r?e.remove(new Ae(t.name,r)):e})),this.indexSet_)},e}(),it=function(){function e(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&$e(this.priorityNode_),this.children_.isEmpty()&&(0,o.hu)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(e,"EMPTY_NODE",{get:function(){return Ke||(Ke=new e(new Ue(Be),null,rt.Default))},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!1},e.prototype.getPriority=function(){return this.priorityNode_||Ke},e.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)},e.prototype.getImmediateChild=function(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?Ke:t},e.prototype.getChild=function(e){var t=fe(e);return null===t?this:this.getImmediateChild(t).getChild(_e(e))},e.prototype.hasChild=function(e){return null!==this.children_.get(e)},e.prototype.updateImmediateChild=function(t,n){if((0,o.hu)(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);var r=new Ae(t,n),i=void 0,s=void 0;n.isEmpty()?(i=this.children_.remove(t),s=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(t,n),s=this.indexMap_.addToIndexes(r,this.children_));var a=i.isEmpty()?Ke:this.priorityNode_;return new e(i,a,s)},e.prototype.updateChild=function(e,t){var n=fe(e);if(null===n)return t;(0,o.hu)(".priority"!==fe(e)||1===ve(e),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(_e(e),t);return this.updateImmediateChild(n,r)},e.prototype.isEmpty=function(){return this.children_.isEmpty()},e.prototype.numChildren=function(){return this.children_.count()},e.prototype.val=function(t){if(this.isEmpty())return null;var n={},r=0,i=0,o=!0;if(this.forEachChild(Ze,(function(s,a){n[s]=a.val(t),r++,o&&e.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):o=!1})),!t&&o&&i<2*r){var s=[];for(var a in n)s[a]=n[a];return s}return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.getPriority().isEmpty()||(e+="priority:"+Qe(this.getPriority().val())+":"),this.forEachChild(Ze,(function(t,n){var r=n.hash();""!==r&&(e+=":"+t+":"+r)})),this.lazyHash_=""===e?"":g(e)}return this.lazyHash_},e.prototype.getPredecessorChildName=function(e,t,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new Ae(e,t));return i?i.name:null}return this.children_.getPredecessorKey(e)},e.prototype.getFirstChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.minKey();return n&&n.name}return this.children_.minKey()},e.prototype.getFirstChild=function(e){var t=this.getFirstChildName(e);return t?new Ae(t,this.children_.get(t)):null},e.prototype.getLastChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.maxKey();return n&&n.name}return this.children_.maxKey()},e.prototype.getLastChild=function(e){var t=this.getLastChildName(e);return t?new Ae(t,this.children_.get(t)):null},e.prototype.forEachChild=function(e,t){var n=this.resolveIndex_(e);return n?n.inorderTraversal((function(e){return t(e.name,e.node)})):this.children_.inorderTraversal(t)},e.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)},e.prototype.getIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getIteratorFrom(e.name,Ae.Wrap),i=r.peek();null!=i&&t.compare(i,e)<0;)r.getNext(),i=r.peek();return r},e.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)},e.prototype.getReverseIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getReverseIteratorFrom(e.name,Ae.Wrap),i=r.peek();null!=i&&t.compare(i,e)>0;)r.getNext(),i=r.peek();return r},e.prototype.compareTo=function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ot?-1:0},e.prototype.withIndex=function(t){if(t===Fe||this.indexMap_.hasIndex(t))return this;var n=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,n)},e.prototype.isIndexed=function(e){return e===Fe||this.indexMap_.hasIndex(e)},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode())return!1;var t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){for(var n=this.getIterator(Ze),r=t.getIterator(Ze),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1}return!1},e.prototype.resolveIndex_=function(e){return e===Fe?null:this.indexMap_.get(e.toString())},e.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,e}(),ot=new(function(e){function t(){return e.call(this,new Ue(Be),it.EMPTY_NODE,rt.Default)||this}return(0,s.ZT)(t,e),t.prototype.compareTo=function(e){return e===this?0:1},t.prototype.equals=function(e){return e===this},t.prototype.getPriority=function(){return this},t.prototype.getImmediateChild=function(e){return it.EMPTY_NODE},t.prototype.isEmpty=function(){return!1},t}(it));function st(e,t){if(void 0===t&&(t=null),null===e)return it.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),(0,o.hu)(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new Je(e,st(t));if(e instanceof Array){var n=it.EMPTY_NODE;return L(e,(function(t,r){if((0,o.r3)(e,t)&&"."!==t.substring(0,1)){var i=st(r);!i.isLeafNode()&&i.isEmpty()||(n=n.updateImmediateChild(t,i))}})),n.updatePriority(st(t))}var r=[],i=!1;if(L(e,(function(e,t){if("."!==e.substring(0,1)){var n=st(t);n.isEmpty()||(i=i||!n.getPriority().isEmpty(),r.push(new Ae(e,n)))}})),0===r.length)return it.EMPTY_NODE;var s=tt(r,je,(function(e){return e.name}),Be);if(i){var a=tt(r,Ze.getCompare());return new it(s,st(t),new rt({".priority":a},{".priority":Ze}))}return new it(s,st(t),rt.Default)}Object.defineProperties(Ae,{MIN:{value:new Ae(N,it.EMPTY_NODE)},MAX:{value:new Ae(x,ot)}}),Le.__EMPTY_NODE=it.EMPTY_NODE,Je.__childrenNodeConstructor=it,xe=ot,Ge=ot,function(e){Ve=e}(st);var at,ut,ht=function(e){function t(t){var n=e.call(this)||this;return n.indexPath_=t,(0,o.hu)(!be(t)&&".priority"!==fe(t),"Can't create PathIndex with empty path or .priority key"),n}return(0,s.ZT)(t,e),t.prototype.extractChild=function(e){return e.getChild(this.indexPath_)},t.prototype.isDefinedOn=function(e){return!e.getChild(this.indexPath_).isEmpty()},t.prototype.compare=function(e,t){var n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?R(e.name,t.name):i},t.prototype.makePost=function(e,t){var n=st(e),r=it.EMPTY_NODE.updateChild(this.indexPath_,n);return new Ae(t,r)},t.prototype.maxPost=function(){var e=it.EMPTY_NODE.updateChild(this.indexPath_,ot);return new Ae(x,e)},t.prototype.toString=function(){return ge(this.indexPath_,0).join("/")},t}(Me),lt=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,s.ZT)(t,e),t.prototype.compare=function(e,t){var n=e.node.compareTo(t.node);return 0===n?R(e.name,t.name):n},t.prototype.isDefinedOn=function(e){return!0},t.prototype.indexedValueChanged=function(e,t){return!e.equals(t)},t.prototype.minPost=function(){return Ae.MIN},t.prototype.maxPost=function(){return Ae.MAX},t.prototype.makePost=function(e,t){var n=st(e);return new Ae(t,n)},t.prototype.toString=function(){return".value"},t}(Me)),ct="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",dt=(at=0,ut=[],function(e){var t,n=e===at;at=e;var r=new Array(8);for(t=7;t>=0;t--)r[t]=ct.charAt(e%64),e=Math.floor(e/64);(0,o.hu)(0===e,"Cannot push at time == 0");var i=r.join("");if(n){for(t=11;t>=0&&63===ut[t];t--)ut[t]=0;ut[t]++}else for(t=0;t<12;t++)ut[t]=Math.floor(64*Math.random());for(t=0;t<12;t++)i+=ct.charAt(ut[t]);return(0,o.hu)(20===i.length,"nextPushId: Length should be 20."),i}),pt=function(e){if("2147483647"===e)return"-";var t=q(e);if(null!=t)return""+(t+1);for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e.charAt(r);if(n.length<786)return n.push("-"),n.join("");for(var i=n.length-1;i>=0&&"z"===n[i];)i--;if(-1===i)return x;var o=n[i],s=ct.charAt(ct.indexOf(o)+1);return n[i]=s,n.slice(0,i+1).join("")},ft=function(e){if("-2147483648"===e)return N;var t=q(e);if(null!=t)return""+(t-1);for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e.charAt(r);return"-"===n[n.length-1]?1===n.length?"2147483647":(delete n[n.length-1],n.join("")):(n[n.length-1]=ct.charAt(ct.indexOf(n[n.length-1])-1),n.join("")+"z".repeat(786-n.length))};function vt(e){return{type:"value",snapshotNode:e}}function _t(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function yt(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function gt(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}var mt=function(){function e(e){this.index_=e}return e.prototype.updateChild=function(e,t,n,r,i,s){(0,o.hu)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=e.getImmediateChild(t);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(yt(t,a)):(0,o.hu)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?s.trackChildChange(_t(t,n)):s.trackChildChange(gt(t,n,a))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))},e.prototype.updateFullNode=function(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(Ze,(function(e,r){t.hasChild(e)||n.trackChildChange(yt(e,r))})),t.isLeafNode()||t.forEachChild(Ze,(function(t,r){if(e.hasChild(t)){var i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(gt(t,r,i))}else n.trackChildChange(_t(t,r))}))),t.withIndex(this.index_)},e.prototype.updatePriority=function(e,t){return e.isEmpty()?it.EMPTY_NODE:e.updatePriority(t)},e.prototype.filtersNodes=function(){return!1},e.prototype.getIndexedFilter=function(){return this},e.prototype.getIndex=function(){return this.index_},e}(),wt=function(){function e(t){this.indexedFilter_=new mt(t.getIndex()),this.index_=t.getIndex(),this.startPost_=e.getStartPost_(t),this.endPost_=e.getEndPost_(t)}return e.prototype.getStartPost=function(){return this.startPost_},e.prototype.getEndPost=function(){return this.endPost_},e.prototype.matches=function(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0},e.prototype.updateChild=function(e,t,n,r,i,o){return this.matches(new Ae(t,n))||(n=it.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,o)},e.prototype.updateFullNode=function(e,t,n){t.isLeafNode()&&(t=it.EMPTY_NODE);var r=t.withIndex(this.index_);r=r.updatePriority(it.EMPTY_NODE);var i=this;return t.forEachChild(Ze,(function(e,t){i.matches(new Ae(e,t))||(r=r.updateImmediateChild(e,it.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.indexedFilter_},e.prototype.getIndex=function(){return this.index_},e.getStartPost_=function(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()},e.getEndPost_=function(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()},e}(),bt=function(){function e(e){this.rangedFilter_=new wt(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}return e.prototype.updateChild=function(e,t,n,r,i,o){return this.rangedFilter_.matches(new Ae(t,n))||(n=it.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,o):this.fullLimitUpdateChild_(e,t,n,i,o)},e.prototype.updateFullNode=function(e,t,n){var r;if(t.isLeafNode()||t.isEmpty())r=it.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){r=it.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var s=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),s)<=0:this.index_.compare(s,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(s.name,s.node),o++}}else{r=(r=t.withIndex(this.index_)).updatePriority(it.EMPTY_NODE);var a=void 0,u=void 0,h=void 0;if(i=void 0,this.reverse_){i=r.getReverseIterator(this.index_),a=this.rangedFilter_.getEndPost(),u=this.rangedFilter_.getStartPost();var l=this.index_.getCompare();h=function(e,t){return l(t,e)}}else i=r.getIterator(this.index_),a=this.rangedFilter_.getStartPost(),u=this.rangedFilter_.getEndPost(),h=this.index_.getCompare();o=0;for(var c=!1;i.hasNext();)s=i.getNext(),!c&&h(a,s)<=0&&(c=!0),c&&o<this.limit_&&h(s,u)<=0?o++:r=r.updateImmediateChild(s.name,it.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},e.prototype.getIndex=function(){return this.index_},e.prototype.fullLimitUpdateChild_=function(e,t,n,r,i){var s;if(this.reverse_){var a=this.index_.getCompare();s=function(e,t){return a(t,e)}}else s=this.index_.getCompare();var u=e;(0,o.hu)(u.numChildren()===this.limit_,"");var h=new Ae(t,n),l=this.reverse_?u.getFirstChild(this.index_):u.getLastChild(this.index_),c=this.rangedFilter_.matches(h);if(u.hasChild(t)){for(var d=u.getImmediateChild(t),p=r.getChildAfterChild(this.index_,l,this.reverse_);null!=p&&(p.name===t||u.hasChild(p.name));)p=r.getChildAfterChild(this.index_,p,this.reverse_);var f=null==p?1:s(p,h);if(c&&!n.isEmpty()&&f>=0)return null!=i&&i.trackChildChange(gt(t,n,d)),u.updateImmediateChild(t,n);null!=i&&i.trackChildChange(yt(t,d));var v=u.updateImmediateChild(t,it.EMPTY_NODE);return null!=p&&this.rangedFilter_.matches(p)?(null!=i&&i.trackChildChange(_t(p.name,p.node)),v.updateImmediateChild(p.name,p.node)):v}return n.isEmpty()?e:c&&s(l,h)>=0?(null!=i&&(i.trackChildChange(yt(l.name,l.node)),i.trackChildChange(_t(t,n))),u.updateImmediateChild(t,n).updateImmediateChild(l.name,it.EMPTY_NODE)):e},e}(),Ct=function(){function e(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Ze}return e.prototype.hasStart=function(){return this.startSet_},e.prototype.hasStartAfter=function(){return this.startAfterSet_},e.prototype.hasEndBefore=function(){return this.endBeforeSet_},e.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_},e.prototype.getIndexStartValue=function(){return(0,o.hu)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},e.prototype.getIndexStartName=function(){return(0,o.hu)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:N},e.prototype.hasEnd=function(){return this.endSet_},e.prototype.getIndexEndValue=function(){return(0,o.hu)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},e.prototype.getIndexEndName=function(){return(0,o.hu)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:x},e.prototype.hasLimit=function(){return this.limitSet_},e.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},e.prototype.getLimit=function(){return(0,o.hu)(this.limitSet_,"Only valid if limit has been set"),this.limit_},e.prototype.getIndex=function(){return this.index_},e.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},e.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===Ze},e.prototype.copy=function(){var t=new e;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},e}();function Et(e,t,n){var r=e.copy();return r.startSet_=!0,void 0===t&&(t=null),r.indexStartValue_=t,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function Tt(e,t,n){var r=e.copy();return r.endSet_=!0,void 0===t&&(t=null),r.indexEndValue_=t,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function St(e,t){var n=e.copy();return n.index_=t,n}function kt(e){var t,n={};return e.isDefault()||(e.index_===Ze?t="$priority":e.index_===lt?t="$value":e.index_===Fe?t="$key":((0,o.hu)(e.index_ instanceof ht,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=(0,o.Pz)(t),e.startSet_&&(n.startAt=(0,o.Pz)(e.indexStartValue_),e.startNameSet_&&(n.startAt+=","+(0,o.Pz)(e.indexStartName_))),e.endSet_&&(n.endAt=(0,o.Pz)(e.indexEndValue_),e.endNameSet_&&(n.endAt+=","+(0,o.Pz)(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_)),n}function It(e){var t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_)),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_)),e.limitSet_){t.l=e.limit_;var n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==Ze&&(t.i=e.index_.toString()),t}var Pt=function(e){function t(t,n,r,i){var o=e.call(this)||this;return o.repoInfo_=t,o.onDataUpdate_=n,o.authTokenProvider_=r,o.appCheckTokenProvider_=i,o.log_=T("p:rest:"),o.listens_={},o}return(0,s.ZT)(t,e),t.prototype.reportStats=function(e){throw new Error("Method not implemented.")},t.getListenId_=function(e,t){return void 0!==t?"tag$"+t:((0,o.hu)(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())},t.prototype.listen=function(e,n,r,i){var s=this,a=e._path.toString();this.log_("Listen called for "+a+" "+e._queryIdentifier);var u=t.getListenId_(e,r),h={};this.listens_[u]=h;var l=kt(e._queryParams);this.restRequest_(a+".json",l,(function(e,t){var n=t;404===e&&(n=null,e=null),null===e&&s.onDataUpdate_(a,n,!1,r),(0,o.DV)(s.listens_,u)===h&&i(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)}))},t.prototype.unlisten=function(e,n){var r=t.getListenId_(e,n);delete this.listens_[r]},t.prototype.get=function(e){var t=this,n=kt(e._queryParams),r=e._path.toString(),i=new o.BH;return this.restRequest_(r+".json",n,(function(e,n){var o=n;404===e&&(o=null,e=null),null===e?(t.onDataUpdate_(r,o,!1,null),i.resolve(o)):i.reject(new Error(o))})),i.promise},t.prototype.refreshAuthToken=function(e){},t.prototype.restRequest_=function(e,t,n){var r=this;return void 0===t&&(t={}),t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((function(i){var a=(0,s.CR)(i,2),u=a[0],h=a[1];u&&u.accessToken&&(t.auth=u.accessToken),h&&h.token&&(t.ac=h.token);var l=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+e+"?ns="+r.repoInfo_.namespace+(0,o.xO)(t);r.log_("Sending REST request for "+l);var c=new XMLHttpRequest;c.onreadystatechange=function(){if(n&&4===c.readyState){r.log_("REST Response for "+l+" received. status:",c.status,"response:",c.responseText);var e=null;if(c.status>=200&&c.status<300){try{e=(0,o.cI)(c.responseText)}catch(e){I("Failed to parse JSON response for "+l+": "+c.responseText)}n(null,e)}else 401!==c.status&&404!==c.status&&I("Got unsuccessful REST response for "+l+" Status: "+c.status),n(c.status);n=null}},c.open("GET",l,!0),c.send()}))},t}(he),Nt=function(){function e(){this.rootNode_=it.EMPTY_NODE}return e.prototype.getNode=function(e){return this.rootNode_.getChild(e)},e.prototype.updateSnapshot=function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)},e}();function xt(){return{value:null,children:new Map}}function Rt(e,t,n){if(be(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{var r=fe(t);e.children.has(r)||e.children.set(r,xt()),Rt(e.children.get(r),t=_e(t),n)}}function Dt(e,t){if(be(t))return e.value=null,e.children.clear(),!0;if(null!==e.value){if(e.value.isLeafNode())return!1;var n=e.value;return e.value=null,n.forEachChild(Ze,(function(t,n){Rt(e,new de(t),n)})),Dt(e,t)}if(e.children.size>0){var r=fe(t);return t=_e(t),e.children.has(r)&&Dt(e.children.get(r),t)&&e.children.delete(r),0===e.children.size}return!0}function Ot(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach((function(e,n){t(n,e)}))}(e,(function(e,r){Ot(r,new de(t.toString()+"/"+e),n)}))}var At,Mt=function(){function e(e){this.collection_=e,this.last_=null}return e.prototype.get=function(){var e=this.collection_.get(),t=(0,s.pi)({},e);return this.last_&&L(this.last_,(function(e,n){t[e]=t[e]-n})),this.last_=e,t},e}(),Lt=function(){function e(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Mt(e);var n=1e4+2e4*Math.random();U(this.reportStats_.bind(this),Math.floor(n))}return e.prototype.reportStats_=function(){var e=this,t=this.statsListener_.get(),n={},r=!1;L(t,(function(t,i){i>0&&(0,o.r3)(e.statsToReport_,t)&&(n[t]=i,r=!0)})),r&&this.server_.reportStats(n),U(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},e}();function Ft(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(At||(At={}));var Wt,qt=function(){function e(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=At.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}return e.prototype.operationForChild=function(t){if(be(this.path)){if(null!=this.affectedTree.value)return(0,o.hu)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new de(t));return new e(pe(),n,this.revert)}return(0,o.hu)(fe(this.path)===t,"operationForChild called for unrelated child."),new e(_e(this.path),this.affectedTree,this.revert)},e}(),Ht=function(){function e(e,t){this.source=e,this.path=t,this.type=At.LISTEN_COMPLETE}return e.prototype.operationForChild=function(t){return be(this.path)?new e(this.source,pe()):new e(this.source,_e(this.path))},e}(),Ut=function(){function e(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=At.OVERWRITE}return e.prototype.operationForChild=function(t){return be(this.path)?new e(this.source,pe(),this.snap.getImmediateChild(t)):new e(this.source,_e(this.path),this.snap)},e}(),jt=function(){function e(e,t,n){this.source=e,this.path=t,this.children=n,this.type=At.MERGE}return e.prototype.operationForChild=function(t){if(be(this.path)){var n=this.children.subtree(new de(t));return n.isEmpty()?null:n.value?new Ut(this.source,pe(),n.value):new e(this.source,pe(),n)}return(0,o.hu)(fe(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new e(this.source,_e(this.path),this.children)},e.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},e}(),Bt=function(){function e(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}return e.prototype.isFullyInitialized=function(){return this.fullyInitialized_},e.prototype.isFiltered=function(){return this.filtered_},e.prototype.isCompleteForPath=function(e){if(be(e))return this.isFullyInitialized()&&!this.filtered_;var t=fe(e);return this.isCompleteForChild(t)},e.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)},e.prototype.getNode=function(){return this.node_},e}(),zt=function(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()};function Vt(e,t,n,r,i,s){var a=r.filter((function(e){return e.type===n}));a.sort((function(t,n){return function(e,t,n){if(null==t.childName||null==n.childName)throw(0,o.g5)("Should only compare child_ events.");var r=new Ae(t.childName,t.snapshotNode),i=new Ae(n.childName,n.snapshotNode);return e.index_.compare(r,i)}(e,t,n)})),a.forEach((function(n){var r=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,s);i.forEach((function(i){i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))}))}))}function Gt(e,t){return{eventCache:e,serverCache:t}}function Yt(e,t,n,r){return Gt(new Bt(t,n,r),e.serverCache)}function Kt(e,t,n,r){return Gt(e.eventCache,new Bt(t,n,r))}function Qt(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function $t(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}var Jt=function(){function e(e,t){void 0===t&&(Wt||(Wt=new Ue(D)),t=Wt),this.value=e,this.children=t}return e.fromObject=function(t){var n=new e(null);return L(t,(function(e,t){n=n.set(new de(e),t)})),n},e.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},e.prototype.findRootMostMatchingPathAndValue=function(e,t){if(null!=this.value&&t(this.value))return{path:pe(),value:this.value};if(be(e))return null;var n=fe(e),r=this.children.get(n);if(null!==r){var i=r.findRootMostMatchingPathAndValue(_e(e),t);return null!=i?{path:we(new de(n),i.path),value:i.value}:null}return null},e.prototype.findRootMostValueAndPath=function(e){return this.findRootMostMatchingPathAndValue(e,(function(){return!0}))},e.prototype.subtree=function(t){if(be(t))return this;var n=fe(t),r=this.children.get(n);return null!==r?r.subtree(_e(t)):new e(null)},e.prototype.set=function(t,n){if(be(t))return new e(n,this.children);var r=fe(t),i=(this.children.get(r)||new e(null)).set(_e(t),n),o=this.children.insert(r,i);return new e(this.value,o)},e.prototype.remove=function(t){if(be(t))return this.children.isEmpty()?new e(null):new e(null,this.children);var n=fe(t),r=this.children.get(n);if(r){var i=r.remove(_e(t)),o=void 0;return o=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&o.isEmpty()?new e(null):new e(this.value,o)}return this},e.prototype.get=function(e){if(be(e))return this.value;var t=fe(e),n=this.children.get(t);return n?n.get(_e(e)):null},e.prototype.setTree=function(t,n){if(be(t))return n;var r,i=fe(t),o=(this.children.get(i)||new e(null)).setTree(_e(t),n);return r=o.isEmpty()?this.children.remove(i):this.children.insert(i,o),new e(this.value,r)},e.prototype.fold=function(e){return this.fold_(pe(),e)},e.prototype.fold_=function(e,t){var n={};return this.children.inorderTraversal((function(r,i){n[r]=i.fold_(we(e,r),t)})),t(e,this.value,n)},e.prototype.findOnPath=function(e,t){return this.findOnPath_(e,pe(),t)},e.prototype.findOnPath_=function(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(be(e))return null;var i=fe(e),o=this.children.get(i);return o?o.findOnPath_(_e(e),we(t,i),n):null},e.prototype.foreachOnPath=function(e,t){return this.foreachOnPath_(e,pe(),t)},e.prototype.foreachOnPath_=function(t,n,r){if(be(t))return this;this.value&&r(n,this.value);var i=fe(t),o=this.children.get(i);return o?o.foreachOnPath_(_e(t),we(n,i),r):new e(null)},e.prototype.foreach=function(e){this.foreach_(pe(),e)},e.prototype.foreach_=function(e,t){this.children.inorderTraversal((function(n,r){r.foreach_(we(e,n),t)})),this.value&&t(e,this.value)},e.prototype.foreachChild=function(e){this.children.inorderTraversal((function(t,n){n.value&&e(t,n.value)}))},e}(),Zt=function(){function e(e){this.writeTree_=e}return e.empty=function(){return new e(new Jt(null))},e}();function Xt(e,t,n){if(be(t))return new Zt(new Jt(n));var r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){var i=r.path,o=r.value,s=Ce(i,t);return o=o.updateChild(s,n),new Zt(e.writeTree_.set(i,o))}var a=new Jt(n),u=e.writeTree_.setTree(t,a);return new Zt(u)}function en(e,t,n){var r=e;return L(n,(function(e,n){r=Xt(r,we(t,e),n)})),r}function tn(e,t){if(be(t))return Zt.empty();var n=e.writeTree_.setTree(t,new Jt(null));return new Zt(n)}function nn(e,t){return null!=rn(e,t)}function rn(e,t){var n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(Ce(n.path,t)):null}function on(e){var t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(Ze,(function(e,n){t.push(new Ae(e,n))})):e.writeTree_.children.inorderTraversal((function(e,n){null!=n.value&&t.push(new Ae(e,n.value))})),t}function sn(e,t){if(be(t))return e;var n=rn(e,t);return new Zt(null!=n?new Jt(n):e.writeTree_.subtree(t))}function an(e){return e.writeTree_.isEmpty()}function un(e,t){return hn(pe(),e.writeTree_,t)}function hn(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);var r=null;return t.children.inorderTraversal((function(t,i){".priority"===t?((0,o.hu)(null!==i.value,"Priority writes must always be leaf nodes"),r=i.value):n=hn(we(e,t),i,n)})),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(we(e,".priority"),r)),n}function ln(e,t){return bn(t,e)}function cn(e,t){if(e.snap)return Se(e.path,t);for(var n in e.children)if(e.children.hasOwnProperty(n)&&Se(we(e.path,n),t))return!0;return!1}function dn(e){return e.visible}function pn(e,t,n){for(var r=Zt.empty(),i=0;i<e.length;++i){var s=e[i];if(t(s)){var a=s.path,u=void 0;if(s.snap)Se(n,a)?r=Xt(r,u=Ce(n,a),s.snap):Se(a,n)&&(u=Ce(a,n),r=Xt(r,pe(),s.snap.getChild(u)));else{if(!s.children)throw(0,o.g5)("WriteRecord should have .snap or .children");if(Se(n,a))r=en(r,u=Ce(n,a),s.children);else if(Se(a,n))if(be(u=Ce(a,n)))r=en(r,pe(),s.children);else{var h=(0,o.DV)(s.children,fe(u));if(h){var l=h.getChild(_e(u));r=Xt(r,pe(),l)}}}}}return r}function fn(e,t,n,r,i){if(r||i){var o=sn(e.visibleWrites,t);return!i&&an(o)?n:i||null!=n||nn(o,pe())?un(pn(e.allWrites,(function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(Se(e.path,t)||Se(t,e.path))}),t),n||it.EMPTY_NODE):null}var s=rn(e.visibleWrites,t);if(null!=s)return s;var a=sn(e.visibleWrites,t);return an(a)?n:null!=n||nn(a,pe())?un(a,n||it.EMPTY_NODE):null}function vn(e,t,n,r){return fn(e.writeTree,e.treePath,t,n,r)}function _n(e,t){return function(e,t,n){var r=it.EMPTY_NODE,i=rn(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(Ze,(function(e,t){r=r.updateImmediateChild(e,t)})),r;if(n){var o=sn(e.visibleWrites,t);return n.forEachChild(Ze,(function(e,t){var n=un(sn(o,new de(e)),t);r=r.updateImmediateChild(e,n)})),on(o).forEach((function(e){r=r.updateImmediateChild(e.name,e.node)})),r}return on(sn(e.visibleWrites,t)).forEach((function(e){r=r.updateImmediateChild(e.name,e.node)})),r}(e.writeTree,e.treePath,t)}function yn(e,t,n,r){return function(e,t,n,r,i){(0,o.hu)(r||i,"Either existingEventSnap or existingServerSnap must exist");var s=we(t,n);if(nn(e.visibleWrites,s))return null;var a=sn(e.visibleWrites,s);return an(a)?i.getChild(n):un(a,i.getChild(n))}(e.writeTree,e.treePath,t,n,r)}function gn(e,t){return function(e,t){return rn(e.visibleWrites,t)}(e.writeTree,we(e.treePath,t))}function mn(e,t,n){return function(e,t,n,r){var i=we(t,n),o=rn(e.visibleWrites,i);return null!=o?o:r.isCompleteForChild(n)?un(sn(e.visibleWrites,i),r.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function wn(e,t){return bn(we(e.treePath,t),e.writeTree)}function bn(e,t){return{treePath:e,writeTree:t}}var Cn=function(){function e(){this.changeMap=new Map}return e.prototype.trackChildChange=function(e){var t=e.type,n=e.childName;(0,o.hu)("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),(0,o.hu)(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,gt(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,yt(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,_t(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw(0,o.g5)("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,gt(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)},e.prototype.getChanges=function(){return Array.from(this.changeMap.values())},e}(),En=new(function(){function e(){}return e.prototype.getCompleteChild=function(e){return null},e.prototype.getChildAfterChild=function(e,t,n){return null},e}()),Tn=function(){function e(e,t,n){void 0===n&&(n=null),this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}return e.prototype.getCompleteChild=function(e){var t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new Bt(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return mn(this.writes_,e,n)},e.prototype.getChildAfterChild=function(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:$t(this.viewCache_),i=function(e,t,n,r,i,o){return function(e,t,n,r,i,o,s){var a,u=sn(e.visibleWrites,t),h=rn(u,pe());if(null!=h)a=h;else{if(null==n)return[];a=un(u,n)}if((a=a.withIndex(s)).isEmpty()||a.isLeafNode())return[];for(var l=[],c=s.getCompare(),d=o?a.getReverseIteratorFrom(r,s):a.getIteratorFrom(r,s),p=d.getNext();p&&l.length<i;)0!==c(p,r)&&l.push(p),p=d.getNext();return l}(e.writeTree,e.treePath,t,n,r,i,o)}(this.writes_,r,t,1,n,e);return 0===i.length?null:i[0]},e}();function Sn(e,t,n,r,i,s){var a=t.eventCache;if(null!=gn(r,n))return t;var u=void 0,h=void 0;if(be(n))if((0,o.hu)(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){var l=$t(t),c=_n(r,l instanceof it?l:it.EMPTY_NODE);u=e.filter.updateFullNode(t.eventCache.getNode(),c,s)}else{var d=vn(r,$t(t));u=e.filter.updateFullNode(t.eventCache.getNode(),d,s)}else{var p=fe(n);if(".priority"===p){(0,o.hu)(1===ve(n),"Can't have a priority with additional path components");var f=a.getNode(),v=yn(r,n,f,h=t.serverCache.getNode());u=null!=v?e.filter.updatePriority(f,v):a.getNode()}else{var _=_e(n),y=void 0;if(a.isCompleteForChild(p)){h=t.serverCache.getNode();var g=yn(r,n,a.getNode(),h);y=null!=g?a.getNode().getImmediateChild(p).updateChild(_,g):a.getNode().getImmediateChild(p)}else y=mn(r,p,t.serverCache);u=null!=y?e.filter.updateChild(a.getNode(),p,y,_,i,s):a.getNode()}}return Yt(t,u,a.isFullyInitialized()||be(n),e.filter.filtersNodes())}function kn(e,t,n,r,i,o,s,a){var u,h=t.serverCache,l=s?e.filter:e.filter.getIndexedFilter();if(be(n))u=l.updateFullNode(h.getNode(),r,null);else if(l.filtersNodes()&&!h.isFiltered()){var c=h.getNode().updateChild(n,r);u=l.updateFullNode(h.getNode(),c,null)}else{var d=fe(n);if(!h.isCompleteForPath(n)&&ve(n)>1)return t;var p=_e(n),f=h.getNode().getImmediateChild(d).updateChild(p,r);u=".priority"===d?l.updatePriority(h.getNode(),f):l.updateChild(h.getNode(),d,f,p,En,null)}var v=Kt(t,u,h.isFullyInitialized()||be(n),l.filtersNodes());return Sn(e,v,n,i,new Tn(i,v,o),a)}function In(e,t,n,r,i,o,s){var a,u,h=t.eventCache,l=new Tn(i,t,o);if(be(n))u=e.filter.updateFullNode(t.eventCache.getNode(),r,s),a=Yt(t,u,!0,e.filter.filtersNodes());else{var c=fe(n);if(".priority"===c)u=e.filter.updatePriority(t.eventCache.getNode(),r),a=Yt(t,u,h.isFullyInitialized(),h.isFiltered());else{var d=_e(n),p=h.getNode().getImmediateChild(c),f=void 0;if(be(d))f=r;else{var v=l.getCompleteChild(c);f=null!=v?".priority"===ye(d)&&v.getChild(me(d)).isEmpty()?v:v.updateChild(d,r):it.EMPTY_NODE}a=p.equals(f)?t:Yt(t,e.filter.updateChild(h.getNode(),c,f,d,l,s),h.isFullyInitialized(),e.filter.filtersNodes())}}return a}function Pn(e,t){return e.eventCache.isCompleteForChild(t)}function Nn(e,t,n){return n.foreach((function(e,n){t=t.updateChild(e,n)})),t}function xn(e,t,n,r,i,o,s,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;var u,h=t;u=be(n)?r:new Jt(null).setTree(n,r);var l=t.serverCache.getNode();return u.children.inorderTraversal((function(n,r){if(l.hasChild(n)){var u=Nn(0,t.serverCache.getNode().getImmediateChild(n),r);h=kn(e,h,new de(n),u,i,o,s,a)}})),u.children.inorderTraversal((function(n,r){var u=!t.serverCache.isCompleteForChild(n)&&void 0===r.value;if(!l.hasChild(n)&&!u){var c=Nn(0,t.serverCache.getNode().getImmediateChild(n),r);h=kn(e,h,new de(n),c,i,o,s,a)}})),h}var Rn,Dn=function(){function e(e,t){this.query_=e,this.eventRegistrations_=[];var n,r=this.query_._queryParams,i=new mt(r.getIndex()),o=(n=r).loadsAllData()?new mt(n.getIndex()):n.hasLimit()?new bt(n):new wt(n);this.processor_=function(e){return{filter:e}}(o);var s=t.serverCache,a=t.eventCache,u=i.updateFullNode(it.EMPTY_NODE,s.getNode(),null),h=o.updateFullNode(it.EMPTY_NODE,a.getNode(),null),l=new Bt(u,s.isFullyInitialized(),i.filtersNodes()),c=new Bt(h,a.isFullyInitialized(),o.filtersNodes());this.viewCache_=Gt(c,l),this.eventGenerator_=new zt(this.query_)}return Object.defineProperty(e.prototype,"query",{get:function(){return this.query_},enumerable:!1,configurable:!0}),e}();function On(e,t){var n=$t(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!be(t)&&!n.getImmediateChild(fe(t)).isEmpty())?n.getChild(t):null}function An(e){return 0===e.eventRegistrations_.length}function Mn(e,t,n){var r=[];if(n){(0,o.hu)(null==t,"A cancel should cancel all event registrations.");var i=e.query._path;e.eventRegistrations_.forEach((function(e){var t=e.createCancelEvent(n,i);t&&r.push(t)}))}if(t){for(var s=[],a=0;a<e.eventRegistrations_.length;++a){var u=e.eventRegistrations_[a];if(u.matches(t)){if(t.hasAnyCallback()){s=s.concat(e.eventRegistrations_.slice(a+1));break}}else s.push(u)}e.eventRegistrations_=s}else e.eventRegistrations_=[];return r}function Ln(e,t,n,r){t.type===At.MERGE&&null!==t.source.queryId&&((0,o.hu)($t(e.viewCache_),"We should always have a full cache before handling merges"),(0,o.hu)(Qt(e.viewCache_),"Missing event cache, even though we have a server cache"));var i,s,a=e.viewCache_,u=function(e,t,n,r,i){var s,a,u=new Cn;if(n.type===At.OVERWRITE){var h=n;h.source.fromUser?s=In(e,t,h.path,h.snap,r,i,u):((0,o.hu)(h.source.fromServer,"Unknown source."),a=h.source.tagged||t.serverCache.isFiltered()&&!be(h.path),s=kn(e,t,h.path,h.snap,r,i,a,u))}else if(n.type===At.MERGE){var l=n;l.source.fromUser?s=function(e,t,n,r,i,o,s){var a=t;return r.foreach((function(r,u){var h=we(n,r);Pn(t,fe(h))&&(a=In(e,a,h,u,i,o,s))})),r.foreach((function(r,u){var h=we(n,r);Pn(t,fe(h))||(a=In(e,a,h,u,i,o,s))})),a}(e,t,l.path,l.children,r,i,u):((0,o.hu)(l.source.fromServer,"Unknown source."),a=l.source.tagged||t.serverCache.isFiltered(),s=xn(e,t,l.path,l.children,r,i,a,u))}else if(n.type===At.ACK_USER_WRITE){var c=n;s=c.revert?function(e,t,n,r,i,s){var a;if(null!=gn(r,n))return t;var u=new Tn(r,t,i),h=t.eventCache.getNode(),l=void 0;if(be(n)||".priority"===fe(n)){var c=void 0;if(t.serverCache.isFullyInitialized())c=vn(r,$t(t));else{var d=t.serverCache.getNode();(0,o.hu)(d instanceof it,"serverChildren would be complete if leaf node"),c=_n(r,d)}c=c,l=e.filter.updateFullNode(h,c,s)}else{var p=fe(n),f=mn(r,p,t.serverCache);null==f&&t.serverCache.isCompleteForChild(p)&&(f=h.getImmediateChild(p)),(l=null!=f?e.filter.updateChild(h,p,f,_e(n),u,s):t.eventCache.getNode().hasChild(p)?e.filter.updateChild(h,p,it.EMPTY_NODE,_e(n),u,s):h).isEmpty()&&t.serverCache.isFullyInitialized()&&(a=vn(r,$t(t))).isLeafNode()&&(l=e.filter.updateFullNode(l,a,s))}return a=t.serverCache.isFullyInitialized()||null!=gn(r,pe()),Yt(t,l,a,e.filter.filtersNodes())}(e,t,c.path,r,i,u):function(e,t,n,r,i,o,s){if(null!=gn(i,n))return t;var a=t.serverCache.isFiltered(),u=t.serverCache;if(null!=r.value){if(be(n)&&u.isFullyInitialized()||u.isCompleteForPath(n))return kn(e,t,n,u.getNode().getChild(n),i,o,a,s);if(be(n)){var h=new Jt(null);return u.getNode().forEachChild(Fe,(function(e,t){h=h.set(new de(e),t)})),xn(e,t,n,h,i,o,a,s)}return t}var l=new Jt(null);return r.foreach((function(e,t){var r=we(n,e);u.isCompleteForPath(r)&&(l=l.set(e,u.getNode().getChild(r)))})),xn(e,t,n,l,i,o,a,s)}(e,t,c.path,c.affectedTree,r,i,u)}else{if(n.type!==At.LISTEN_COMPLETE)throw(0,o.g5)("Unknown operation type: "+n.type);s=function(e,t,n,r,i){var o=t.serverCache;return Sn(e,Kt(t,o.getNode(),o.isFullyInitialized()||be(n),o.isFiltered()),n,r,En,i)}(e,t,n.path,r,u)}var d=u.getChanges();return function(e,t,n){var r=t.eventCache;if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=Qt(e);(n.length>0||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(vt(Qt(t)))}}(t,s,d),{viewCache:s,changes:d}}(e.processor_,a,t,n,r);return i=e.processor_,s=u.viewCache,(0,o.hu)(s.eventCache.getNode().isIndexed(i.filter.getIndex()),"Event snap not indexed"),(0,o.hu)(s.serverCache.getNode().isIndexed(i.filter.getIndex()),"Server snap not indexed"),(0,o.hu)(u.viewCache.serverCache.isFullyInitialized()||!a.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=u.viewCache,Fn(e,u.changes,u.viewCache.eventCache.getNode(),null)}function Fn(e,t,n,r){var i=r?[r]:e.eventRegistrations_;return function(e,t,n,r){var i=[],o=[];return t.forEach((function(t){var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&o.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),Vt(e,i,"child_removed",t,r,n),Vt(e,i,"child_added",t,r,n),Vt(e,i,"child_moved",o,r,n),Vt(e,i,"child_changed",t,r,n),Vt(e,i,"value",t,r,n),i}(e.eventGenerator_,t,n,i)}var Wn,qn=function(){this.views=new Map};function Hn(e,t,n,r){var i,a,u=t.source.queryId;if(null!==u){var h=e.views.get(u);return(0,o.hu)(null!=h,"SyncTree gave us an op for an invalid query."),Ln(h,t,n,r)}var l=[];try{for(var c=(0,s.XA)(e.views.values()),d=c.next();!d.done;d=c.next())h=d.value,l=l.concat(Ln(h,t,n,r))}catch(e){i={error:e}}finally{try{d&&!d.done&&(a=c.return)&&a.call(c)}finally{if(i)throw i.error}}return l}function Un(e,t,n,r,i){var o=t._queryIdentifier,s=e.views.get(o);if(!s){var a=vn(n,i?r:null),u=!1;a?u=!0:r instanceof it?(a=_n(n,r),u=!1):(a=it.EMPTY_NODE,u=!1);var h=Gt(new Bt(a,u,!1),new Bt(r,i,!1));return new Dn(t,h)}return s}function jn(e){var t,n,r=[];try{for(var i=(0,s.XA)(e.views.values()),o=i.next();!o.done;o=i.next()){var a=o.value;a.query._queryParams.loadsAllData()||r.push(a)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}function Bn(e,t){var n,r,i=null;try{for(var o=(0,s.XA)(e.views.values()),a=o.next();!a.done;a=o.next()){var u=a.value;i=i||On(u,t)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return i}function zn(e,t){if(t._queryParams.loadsAllData())return Yn(e);var n=t._queryIdentifier;return e.views.get(n)}function Vn(e,t){return null!=zn(e,t)}function Gn(e){return null!=Yn(e)}function Yn(e){var t,n;try{for(var r=(0,s.XA)(e.views.values()),i=r.next();!i.done;i=r.next()){var o=i.value;if(o.query._queryParams.loadsAllData())return o}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return null}var Kn=1,Qn=function(e){this.listenProvider_=e,this.syncPointTree_=new Jt(null),this.pendingWriteTree_={visibleWrites:Zt.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map};function $n(e,t,n,r,i){return function(e,t,n,r,i){(0,o.hu)(r>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),e.allWrites.push({path:t,snap:n,writeId:r,visible:i}),i&&(e.visibleWrites=Xt(e.visibleWrites,t,n)),e.lastWriteId=r}(e.pendingWriteTree_,t,n,r,i),i?nr(e,new Ut({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function Jn(e,t,n){void 0===n&&(n=!1);var r=function(e,t){for(var n=0;n<e.allWrites.length;n++){var r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(function(e,t){var n=e.allWrites.findIndex((function(e){return e.writeId===t}));(0,o.hu)(n>=0,"removeWrite called with nonexistent writeId.");var r=e.allWrites[n];e.allWrites.splice(n,1);for(var i=r.visible,s=!1,a=e.allWrites.length-1;i&&a>=0;){var u=e.allWrites[a];u.visible&&(a>=n&&cn(u,r.path)?i=!1:Se(r.path,u.path)&&(s=!0)),a--}return!!i&&(s?(function(e){e.visibleWrites=pn(e.allWrites,dn,pe()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0):(r.snap?e.visibleWrites=tn(e.visibleWrites,r.path):L(r.children,(function(t){e.visibleWrites=tn(e.visibleWrites,we(r.path,t))})),!0))}(e.pendingWriteTree_,t)){var i=new Jt(null);return null!=r.snap?i=i.set(pe(),!0):L(r.children,(function(e){i=i.set(new de(e),!0)})),nr(e,new qt(r.path,i,n))}return[]}function Zn(e,t,n){return nr(e,new Ut({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function Xn(e,t,n,r){var i=t._path,a=e.syncPointTree_.get(i),u=[];if(a&&("default"===t._queryIdentifier||Vn(a,t))){var h=function(e,t,n,r){var i,a,u=t._queryIdentifier,h=[],l=[],c=Gn(e);if("default"===u)try{for(var d=(0,s.XA)(e.views.entries()),p=d.next();!p.done;p=d.next()){var f=(0,s.CR)(p.value,2),v=f[0],_=f[1];l=l.concat(Mn(_,n,r)),An(_)&&(e.views.delete(v),_.query._queryParams.loadsAllData()||h.push(_.query))}}catch(e){i={error:e}}finally{try{p&&!p.done&&(a=d.return)&&a.call(d)}finally{if(i)throw i.error}}else(_=e.views.get(u))&&(l=l.concat(Mn(_,n,r)),An(_)&&(e.views.delete(u),_.query._queryParams.loadsAllData()||h.push(_.query)));return c&&!Gn(e)&&h.push(new((0,o.hu)(Rn,"Reference.ts has not been loaded"),Rn)(t._repo,t._path)),{removed:h,events:l}}(a,t,n,r);0===a.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(i));var l=h.removed;u=h.events;var c=-1!==l.findIndex((function(e){return e._queryParams.loadsAllData()})),d=e.syncPointTree_.findOnPath(i,(function(e,t){return Gn(t)}));if(c&&!d){var p=e.syncPointTree_.subtree(i);if(!p.isEmpty())for(var f=function(e){return e.fold((function(e,t,n){if(t&&Gn(t))return[Yn(t)];var r=[];return t&&(r=jn(t)),L(n,(function(e,t){r=r.concat(t)})),r}))}(p),v=0;v<f.length;++v){var _=f[v],y=_.query,g=or(e,_);e.listenProvider_.startListening(cr(y),sr(e,y),g.hashFn,g.onComplete)}}!d&&l.length>0&&!r&&(c?e.listenProvider_.stopListening(cr(t),null):l.forEach((function(t){var n=e.queryToTagMap.get(ar(t));e.listenProvider_.stopListening(cr(t),n)}))),function(e,t){for(var n=0;n<t.length;++n){var r=t[n];if(!r._queryParams.loadsAllData()){var i=ar(r),o=e.queryToTagMap.get(i);e.queryToTagMap.delete(i),e.tagToQueryMap.delete(o)}}}(e,l)}return u}function er(e,t,n){var r=t._path,i=null,s=!1;e.syncPointTree_.foreachOnPath(r,(function(e,t){var n=Ce(e,r);i=i||Bn(t,n),s=s||Gn(t)}));var a,u=e.syncPointTree_.get(r);u?(s=s||Gn(u),i=i||Bn(u,pe())):(u=new qn,e.syncPointTree_=e.syncPointTree_.set(r,u)),null!=i?a=!0:(a=!1,i=it.EMPTY_NODE,e.syncPointTree_.subtree(r).foreachChild((function(e,t){var n=Bn(t,pe());n&&(i=i.updateImmediateChild(e,n))})));var h=Vn(u,t);if(!h&&!t._queryParams.loadsAllData()){var l=ar(t);(0,o.hu)(!e.queryToTagMap.has(l),"View does not exist, but we have a tag");var c=Kn++;e.queryToTagMap.set(l,c),e.tagToQueryMap.set(c,l)}var d=function(e,t,n,r,i,o){var s=Un(e,t,r,i,o);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,s),function(e,t){e.eventRegistrations_.push(t)}(s,n),function(e,t){var n=e.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(Ze,(function(e,t){r.push(_t(e,t))})),n.isFullyInitialized()&&r.push(vt(n.getNode())),Fn(e,r,n.getNode(),t)}(s,n)}(u,t,n,ln(e.pendingWriteTree_,r),i,a);if(!h&&!s){var p=zn(u,t);d=d.concat(function(e,t,n){var r=t._path,i=sr(e,t),s=or(e,n),a=e.listenProvider_.startListening(cr(t),i,s.hashFn,s.onComplete),u=e.syncPointTree_.subtree(r);if(i)(0,o.hu)(!Gn(u.value),"If we're adding a query, it shouldn't be shadowed");else for(var h=u.fold((function(e,t,n){if(!be(e)&&t&&Gn(t))return[Yn(t).query];var r=[];return t&&(r=r.concat(jn(t).map((function(e){return e.query})))),L(n,(function(e,t){r=r.concat(t)})),r})),l=0;l<h.length;++l){var c=h[l];e.listenProvider_.stopListening(cr(c),sr(e,c))}return a}(e,t,p))}return d}function tr(e,t,n){var r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,(function(e,n){var r=Bn(n,Ce(e,t));if(r)return r}));return fn(r,t,i,n,!0)}function nr(e,t){return rr(t,e.syncPointTree_,null,ln(e.pendingWriteTree_,pe()))}function rr(e,t,n,r){if(be(e.path))return ir(e,t,n,r);var i=t.get(pe());null==n&&null!=i&&(n=Bn(i,pe()));var o=[],s=fe(e.path),a=e.operationForChild(s),u=t.children.get(s);if(u&&a){var h=n?n.getImmediateChild(s):null,l=wn(r,s);o=o.concat(rr(a,u,h,l))}return i&&(o=o.concat(Hn(i,e,r,n))),o}function ir(e,t,n,r){var i=t.get(pe());null==n&&null!=i&&(n=Bn(i,pe()));var o=[];return t.children.inorderTraversal((function(t,i){var s=n?n.getImmediateChild(t):null,a=wn(r,t),u=e.operationForChild(t);u&&(o=o.concat(ir(u,i,s,a)))})),i&&(o=o.concat(Hn(i,e,r,n))),o}function or(e,t){var n=t.query,r=sr(e,n);return{hashFn:function(){return(function(e){return e.viewCache_.serverCache.getNode()}(t)||it.EMPTY_NODE).hash()},onComplete:function(t){if("ok"===t)return r?function(e,t,n){var r=ur(e,n);if(r){var i=hr(r),o=i.path,s=i.queryId,a=Ce(o,t);return lr(e,o,new Ht(Ft(s),a))}return[]}(e,n._path,r):function(e,t){return nr(e,new Ht({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,n._path);var i=function(e,t){var n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");var r=new Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}(t,n);return Xn(e,n,null,i)}}}function sr(e,t){var n=ar(t);return e.queryToTagMap.get(n)}function ar(e){return e._path.toString()+"$"+e._queryIdentifier}function ur(e,t){return e.tagToQueryMap.get(t)}function hr(e){var t=e.indexOf("$");return(0,o.hu)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new de(e.substr(0,t))}}function lr(e,t,n){var r=e.syncPointTree_.get(t);return(0,o.hu)(r,"Missing sync point for query tag that we're tracking"),Hn(r,n,ln(e.pendingWriteTree_,t),null)}function cr(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new((0,o.hu)(Wn,"Reference.ts has not been loaded"),Wn)(e._repo,e._path):e}var dr=function(){function e(e){this.node_=e}return e.prototype.getImmediateChild=function(t){return new e(this.node_.getImmediateChild(t))},e.prototype.node=function(){return this.node_},e}(),pr=function(){function e(e,t){this.syncTree_=e,this.path_=t}return e.prototype.getImmediateChild=function(t){var n=we(this.path_,t);return new e(this.syncTree_,n)},e.prototype.node=function(){return tr(this.syncTree_,this.path_)},e}(),fr=function(e,t,n){return e&&"object"==typeof e?((0,o.hu)(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?vr(e[".sv"],t,n):"object"==typeof e[".sv"]?_r(e[".sv"],t):void(0,o.hu)(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},vr=function(e,t,n){switch(e){case"timestamp":return n.timestamp;default:(0,o.hu)(!1,"Unexpected server value: "+e)}},_r=function(e,t,n){e.hasOwnProperty("increment")||(0,o.hu)(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var r=e.increment;"number"!=typeof r&&(0,o.hu)(!1,"Unexpected increment value: "+r);var i=t.node();if((0,o.hu)(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;var s=i.getValue();return"number"!=typeof s?r:s+r},yr=function(e,t,n,r){return mr(t,new pr(n,e),r)},gr=function(e,t,n){return mr(e,new dr(t),n)};function mr(e,t,n){var r,i=e.getPriority().val(),o=fr(i,t.getImmediateChild(".priority"),n);if(e.isLeafNode()){var s=e,a=fr(s.getValue(),t,n);return a!==s.getValue()||o!==s.getPriority().val()?new Je(a,st(o)):e}var u=e;return r=u,o!==u.getPriority().val()&&(r=r.updatePriority(new Je(o))),u.forEachChild(Ze,(function(e,i){var o=mr(i,t.getImmediateChild(e),n);o!==i&&(r=r.updateImmediateChild(e,o))})),r}var wr=function(e,t,n){void 0===e&&(e=""),void 0===t&&(t=null),void 0===n&&(n={children:{},childCount:0}),this.name=e,this.parent=t,this.node=n};function br(e,t){for(var n=t instanceof de?t:new de(t),r=e,i=fe(n);null!==i;){var s=(0,o.DV)(r.node.children,i)||{children:{},childCount:0};r=new wr(i,r,s),i=fe(n=_e(n))}return r}function Cr(e){return e.node.value}function Er(e,t){e.node.value=t,Pr(e)}function Tr(e){return e.node.childCount>0}function Sr(e,t){L(e.node.children,(function(n,r){t(new wr(n,e,r))}))}function kr(e,t,n,r){n&&!r&&t(e),Sr(e,(function(e){kr(e,t,!0,r)})),n&&r&&t(e)}function Ir(e){return new de(null===e.parent?e.name:Ir(e.parent)+"/"+e.name)}function Pr(e){null!==e.parent&&function(e,t,n){var r=function(e){return void 0===Cr(e)&&!Tr(e)}(n),i=(0,o.r3)(e.node.children,t);r&&i?(delete e.node.children[t],e.node.childCount--,Pr(e)):r||i||(e.node.children[t]=n.node,e.node.childCount++,Pr(e))}(e.parent,e.name,e)}var Nr=/[\[\].#$\/\u0000-\u001F\u007F]/,xr=/[\[\].#$\u0000-\u001F\u007F]/,Rr=10485760,Dr=function(e){return"string"==typeof e&&0!==e.length&&!Nr.test(e)},Or=function(e){return"string"==typeof e&&0!==e.length&&!xr.test(e)},Ar=function(e){return null===e||"string"==typeof e||"number"==typeof e&&!P(e)||e&&"object"==typeof e&&(0,o.r3)(e,".sv")},Mr=function(e,t,n,r){r&&void 0===t||Lr((0,o.gK)(e,"value"),t,n)},Lr=function(e,t,n){var r=n instanceof de?new ke(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+Pe(r));if("function"==typeof t)throw new Error(e+"contains a function "+Pe(r)+" with contents = "+t.toString());if(P(t))throw new Error(e+"contains "+t.toString()+" "+Pe(r));if("string"==typeof t&&t.length>Rr/3&&(0,o.ug)(t)>Rr)throw new Error(e+"contains a string greater than 10485760 utf8 bytes "+Pe(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){var i=!1,s=!1;if(L(t,(function(t,n){if(".value"===t)i=!0;else if(".priority"!==t&&".sv"!==t&&(s=!0,!Dr(t)))throw new Error(e+" contains an invalid key ("+t+") "+Pe(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var a,u;!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=(0,o.ug)(t),Ie(e)}(r,t),Lr(e,n,r),u=(a=r).parts_.pop(),a.byteLength_-=(0,o.ug)(u),a.parts_.length>0&&(a.byteLength_-=1)})),i&&s)throw new Error(e+' contains ".value" child '+Pe(r)+" in addition to actual children.")}},Fr=function(e,t,n,r){if(!r||void 0!==t){var i=(0,o.gK)(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");var s=[];L(t,(function(e,t){var r=new de(e);if(Lr(i,t,we(n,r)),".priority"===ye(r)&&!Ar(t))throw new Error(i+"contains an invalid value for '"+r.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(r)})),function(e,t){var n,r;for(n=0;n<t.length;n++)for(var i=ge(r=t[n]),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!Dr(i[o]))throw new Error(e+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');t.sort(Ee);var s=null;for(n=0;n<t.length;n++){if(r=t[n],null!==s&&Se(s,r))throw new Error(e+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}}(i,s)}},Wr=function(e,t,n){if(!n||void 0!==t){if(P(t))throw new Error((0,o.gK)(e,"priority")+"is "+t.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Ar(t))throw new Error((0,o.gK)(e,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},qr=function(e,t,n){if(!n||void 0!==t)switch(t){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error((0,o.gK)(e,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},Hr=function(e,t,n,r){if(!(r&&void 0===n||Dr(n)))throw new Error((0,o.gK)(e,t)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},Ur=function(e,t,n,r){if(!(r&&void 0===n||Or(n)))throw new Error((0,o.gK)(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},jr=function(e,t){if(".info"===fe(t))throw new Error(e+" failed = Can't modify data under /.info/")},Br=function(e,t){var n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Dr(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Or(e)}(n))throw new Error((0,o.gK)(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},zr=function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error((0,o.gK)(e,t)+"must be a boolean.")},Vr=function(){this.eventLists_=[],this.recursionDepth_=0};function Gr(e,t){for(var n=null,r=0;r<t.length;r++){var i=t[r],o=i.getPath();null===n||Te(o,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:o}),n.events.push(i)}n&&e.eventLists_.push(n)}function Yr(e,t,n){Gr(e,n),Qr(e,(function(e){return Te(e,t)}))}function Kr(e,t,n){Gr(e,n),Qr(e,(function(e){return Se(e,t)||Se(t,e)}))}function Qr(e,t){e.recursionDepth_++;for(var n=!0,r=0;r<e.eventLists_.length;r++){var i=e.eventLists_[r];i&&(t(i.path)?($r(e.eventLists_[r]),e.eventLists_[r]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}function $r(e){for(var t=0;t<e.events.length;t++){var n=e.events[t];if(null!==n){e.events[t]=null;var r=n.getEventRunner();w&&E("event: "+n.toString()),H(r)}}}var Jr="repo_interrupt",Zr=function(){function e(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Vr,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=xt(),this.transactionQueueTree_=new wr,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}return e.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},e}();function Xr(e){var t=e.infoData_.getNode(new de(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function ei(e){return(t=(t={timestamp:Xr(e)})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t}function ti(e,t,n,r,i){e.dataUpdateCount++;var s=new de(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;var a=[];if(i)if(r){var u=(0,o.UI)(n,(function(e){return st(e)}));a=function(e,t,n,r){var i=ur(e,r);if(i){var o=hr(i),s=o.path,a=o.queryId,u=Ce(s,t),h=Jt.fromObject(n);return lr(e,s,new jt(Ft(a),u,h))}return[]}(e.serverSyncTree_,s,u,i)}else{var h=st(n);a=function(e,t,n,r){var i=ur(e,r);if(null!=i){var o=hr(i),s=o.path,a=o.queryId,u=Ce(s,t);return lr(e,s,new Ut(Ft(a),u,n))}return[]}(e.serverSyncTree_,s,h,i)}else if(r){var l=(0,o.UI)(n,(function(e){return st(e)}));a=function(e,t,n){var r=Jt.fromObject(n);return nr(e,new jt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,r))}(e.serverSyncTree_,s,l)}else{var c=st(n);a=Zn(e.serverSyncTree_,s,c)}var d=s;a.length>0&&(d=fi(e,s)),Kr(e.eventQueue_,d,a)}function ni(e,t){ri(e,"connected",t),!1===t&&function(e){li(e,"onDisconnectEvents");var t=ei(e),n=xt();Ot(e.onDisconnect_,pe(),(function(r,i){var o=yr(r,i,e.serverSyncTree_,t);Rt(n,r,o)}));var r=[];Ot(n,pe(),(function(t,n){r=r.concat(Zn(e.serverSyncTree_,t,n));var i=mi(e,t);fi(e,i)})),e.onDisconnect_=xt(),Kr(e.eventQueue_,pe(),r)}(e)}function ri(e,t,n){var r=new de("/.info/"+t),i=st(n);e.infoData_.updateSnapshot(r,i);var o=Zn(e.infoSyncTree_,r,i);Kr(e.eventQueue_,r,o)}function ii(e){return e.nextWriteId_++}function oi(e,t,n,r,i){li(e,"set",{path:t.toString(),value:n,priority:r});var o=ei(e),s=st(n,r),a=tr(e.serverSyncTree_,t),u=gr(s,a,o),h=ii(e),l=$n(e.serverSyncTree_,t,u,h,!0);Gr(e.eventQueue_,l),e.server_.put(t.toString(),s.val(!0),(function(n,r){var o="ok"===n;o||I("set at "+t+" failed: "+n);var s=Jn(e.serverSyncTree_,h,!o);Kr(e.eventQueue_,t,s),ci(0,i,n,r)}));var c=mi(e,t);fi(e,c),Kr(e.eventQueue_,c,[])}function si(e,t,n){e.server_.onDisconnectCancel(t.toString(),(function(r,i){"ok"===r&&Dt(e.onDisconnect_,t),ci(0,n,r,i)}))}function ai(e,t,n,r){var i=st(n);e.server_.onDisconnectPut(t.toString(),i.val(!0),(function(n,o){"ok"===n&&Rt(e.onDisconnect_,t,i),ci(0,r,n,o)}))}function ui(e,t,n){var r;r=".info"===fe(t._path)?Xn(e.infoSyncTree_,t,n):Xn(e.serverSyncTree_,t,n),Yr(e.eventQueue_,t._path,r)}function hi(e){e.persistentConnection_&&e.persistentConnection_.interrupt(Jr)}function li(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r="";e.persistentConnection_&&(r=e.persistentConnection_.id+":"),E.apply(void 0,(0,s.ev)([r],(0,s.CR)(t)))}function ci(e,t,n,r){t&&H((function(){if("ok"===n)t(null);else{var e=(n||"error").toUpperCase(),i=e;r&&(i+=": "+r);var o=new Error(i);o.code=e,t(o)}}))}function di(e,t,n){return tr(e.serverSyncTree_,t,n)||it.EMPTY_NODE}function pi(e,t){if(void 0===t&&(t=e.transactionQueueTree_),t||gi(e,t),Cr(t)){var n=_i(e,t);(0,o.hu)(n.length>0,"Sending zero length transaction queue"),n.every((function(e){return 0===e.status}))&&function(e,t,n){for(var r=n.map((function(e){return e.currentWriteId})),i=di(e,t,r),s=i,a=i.hash(),u=0;u<n.length;u++){var h=n[u];(0,o.hu)(0===h.status,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;var l=Ce(t,h.path);s=s.updateChild(l,h.currentOutputSnapshotRaw)}var c=s.val(!0),d=t;e.server_.put(d.toString(),c,(function(r){li(e,"transaction put response",{path:d.toString(),status:r});var i=[];if("ok"===r){for(var o=[],s=function(t){n[t].status=2,i=i.concat(Jn(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&o.push((function(){return n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved)})),n[t].unwatcher()},a=0;a<n.length;a++)s(a);for(gi(e,br(e.transactionQueueTree_,t)),pi(e,e.transactionQueueTree_),Kr(e.eventQueue_,t,i),a=0;a<o.length;a++)H(o[a])}else{if("datastale"===r)for(a=0;a<n.length;a++)3===n[a].status?n[a].status=4:n[a].status=0;else for(I("transaction at "+d.toString()+" failed: "+r),a=0;a<n.length;a++)n[a].status=4,n[a].abortReason=r;fi(e,t)}}),a)}(e,Ir(t),n)}else Tr(t)&&Sr(t,(function(t){pi(e,t)}))}function fi(e,t){var n=vi(e,t),r=Ir(n);return function(e,t,n){if(0!==t.length){for(var r=[],i=[],s=t.filter((function(e){return 0===e.status})).map((function(e){return e.currentWriteId})),a=function(a){var u,h,l=t[a],c=Ce(n,l.path),d=!1;if((0,o.hu)(null!==c,"rerunTransactionsUnderNode_: relativePath should not be null."),4===l.status)d=!0,u=l.abortReason,i=i.concat(Jn(e.serverSyncTree_,l.currentWriteId,!0));else if(0===l.status)if(l.retryCount>=25)d=!0,u="maxretry",i=i.concat(Jn(e.serverSyncTree_,l.currentWriteId,!0));else{var p=di(e,l.path,s);l.currentInputSnapshot=p;var f=t[a].update(p.val());if(void 0!==f){Lr("transaction failed: Data returned ",f,l.path);var v=st(f);"object"==typeof f&&null!=f&&(0,o.r3)(f,".priority")||(v=v.updatePriority(p.getPriority()));var _=l.currentWriteId,y=ei(e),g=gr(v,p,y);l.currentOutputSnapshotRaw=v,l.currentOutputSnapshotResolved=g,l.currentWriteId=ii(e),s.splice(s.indexOf(_),1),i=(i=i.concat($n(e.serverSyncTree_,l.path,g,l.currentWriteId,l.applyLocally))).concat(Jn(e.serverSyncTree_,_,!0))}else d=!0,u="nodata",i=i.concat(Jn(e.serverSyncTree_,l.currentWriteId,!0))}Kr(e.eventQueue_,n,i),i=[],d&&(t[a].status=2,h=t[a].unwatcher,setTimeout(h,Math.floor(0)),t[a].onComplete&&("nodata"===u?r.push((function(){return t[a].onComplete(null,!1,t[a].currentInputSnapshot)})):r.push((function(){return t[a].onComplete(new Error(u),!1,null)}))))},u=0;u<t.length;u++)a(u);for(gi(e,e.transactionQueueTree_),u=0;u<r.length;u++)H(r[u]);pi(e,e.transactionQueueTree_)}}(e,_i(e,n),r),r}function vi(e,t){var n,r=e.transactionQueueTree_;for(n=fe(t);null!==n&&void 0===Cr(r);)r=br(r,n),n=fe(t=_e(t));return r}function _i(e,t){var n=[];return yi(e,t,n),n.sort((function(e,t){return e.order-t.order})),n}function yi(e,t,n){var r=Cr(t);if(r)for(var i=0;i<r.length;i++)n.push(r[i]);Sr(t,(function(t){yi(e,t,n)}))}function gi(e,t){var n=Cr(t);if(n){for(var r=0,i=0;i<n.length;i++)2!==n[i].status&&(n[r]=n[i],r++);n.length=r,Er(t,n.length>0?n:void 0)}Sr(t,(function(t){gi(e,t)}))}function mi(e,t){var n=Ir(vi(e,t)),r=br(e.transactionQueueTree_,t);return function(e,t,n){for(var r=e.parent;null!==r;){if(t(r))return!0;r=r.parent}}(r,(function(t){wi(e,t)})),wi(e,r),kr(r,(function(t){wi(e,t)})),n}function wi(e,t){var n=Cr(t);if(n){for(var r=[],i=[],s=-1,a=0;a<n.length;a++)3===n[a].status||(1===n[a].status?((0,o.hu)(s===a-1,"All SENT items should be at beginning of queue."),s=a,n[a].status=3,n[a].abortReason="set"):((0,o.hu)(0===n[a].status,"Unexpected transaction status in abort"),n[a].unwatcher(),i=i.concat(Jn(e.serverSyncTree_,n[a].currentWriteId,!0)),n[a].onComplete&&r.push(n[a].onComplete.bind(null,new Error("set"),!1,null))));for(-1===s?Er(t,void 0):n.length=s+1,Kr(e.eventQueue_,Ir(t),i),a=0;a<r.length;a++)H(r[a])}}var bi=function(e,t){var n=Ci(e),r=n.namespace;"firebase.com"===n.domain&&k(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||k("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&I("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new K(n.host,n.secure,r,t,i,"",r!==n.subdomain),path:new de(n.pathString)}},Ci=function(e){var t="",n="",r="",i="",o="",a=!0,u="https",h=443;if("string"==typeof e){var l=e.indexOf("//");l>=0&&(u=e.substring(0,l-1),e=e.substring(l+2));var c=e.indexOf("/");-1===c&&(c=e.length);var d=e.indexOf("?");-1===d&&(d=e.length),t=e.substring(0,Math.min(c,d)),c<d&&(i=function(e){for(var t="",n=e.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(c,d)));var p=function(e){var t,n,r={};"?"===e.charAt(0)&&(e=e.substring(1));try{for(var i=(0,s.XA)(e.split("&")),o=i.next();!o.done;o=i.next()){var a=o.value;if(0!==a.length){var u=a.split("=");2===u.length?r[decodeURIComponent(u[0])]=decodeURIComponent(u[1]):I("Invalid query segment '"+a+"' in query '"+e+"'")}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}(e.substring(Math.min(e.length,d)));(l=t.indexOf(":"))>=0?(a="https"===u||"wss"===u,h=parseInt(t.substring(l+1),10)):l=t.length;var f=t.slice(0,l);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{var v=t.indexOf(".");r=t.substring(0,v).toLowerCase(),n=t.substring(v+1),o=r}"ns"in p&&(o=p.ns)}return{host:t,port:h,domain:n,subdomain:r,secure:a,scheme:u,pathString:i,namespace:o}},Ei=function(){function e(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}return e.prototype.getPath=function(){var e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path},e.prototype.getEventType=function(){return this.eventType},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+(0,o.Pz)(this.snapshot.exportVal())},e}(),Ti=function(){function e(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}return e.prototype.getPath=function(){return this.path},e.prototype.getEventType=function(){return"cancel"},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.path.toString()+":cancel"},e}(),Si=function(){function e(e,t){this.snapshotCallback=e,this.cancelCallback=t}return e.prototype.onValue=function(e,t){this.snapshotCallback.call(null,e,t)},e.prototype.onCancel=function(e){return(0,o.hu)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)},Object.defineProperty(e.prototype,"hasCancelCallback",{get:function(){return!!this.cancelCallback},enumerable:!1,configurable:!0}),e.prototype.matches=function(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context},e}(),ki=function(){function e(e,t){this._repo=e,this._path=t}return e.prototype.cancel=function(){var e=new o.BH;return si(this._repo,this._path,e.wrapCallback((function(){}))),e.promise},e.prototype.remove=function(){jr("OnDisconnect.remove",this._path);var e=new o.BH;return ai(this._repo,this._path,null,e.wrapCallback((function(){}))),e.promise},e.prototype.set=function(e){jr("OnDisconnect.set",this._path),Mr("OnDisconnect.set",e,this._path,!1);var t=new o.BH;return ai(this._repo,this._path,e,t.wrapCallback((function(){}))),t.promise},e.prototype.setWithPriority=function(e,t){jr("OnDisconnect.setWithPriority",this._path),Mr("OnDisconnect.setWithPriority",e,this._path,!1),Wr("OnDisconnect.setWithPriority",t,!1);var n=new o.BH;return function(e,t,n,r,i){var o=st(n,r);e.server_.onDisconnectPut(t.toString(),o.val(!0),(function(n,r){"ok"===n&&Rt(e.onDisconnect_,t,o),ci(0,i,n,r)}))}(this._repo,this._path,e,t,n.wrapCallback((function(){}))),n.promise},e.prototype.update=function(e){jr("OnDisconnect.update",this._path),Fr("OnDisconnect.update",e,this._path,!1);var t=new o.BH;return function(e,t,n,r){if((0,o.xb)(n))return E("onDisconnect().update() called with empty data.  Don't do anything."),void ci(0,r,"ok",void 0);e.server_.onDisconnectMerge(t.toString(),n,(function(i,o){"ok"===i&&L(n,(function(n,r){var i=st(r);Rt(e.onDisconnect_,we(t,n),i)})),ci(0,r,i,o)}))}(this._repo,this._path,e,t.wrapCallback((function(){}))),t.promise},e}(),Ii=function(){function e(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}return Object.defineProperty(e.prototype,"key",{get:function(){return be(this._path)?null:ye(this._path)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ref",{get:function(){return new Ri(this._repo,this._path)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_queryIdentifier",{get:function(){var e=It(this._queryParams),t=A(e);return"{}"===t?"default":t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_queryObject",{get:function(){return It(this._queryParams)},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){if(!((t=(0,o.m9)(t))instanceof e))return!1;var n=this._repo===t._repo,r=Te(this._path,t._path),i=this._queryIdentifier===t._queryIdentifier;return n&&r&&i},e.prototype.toJSON=function(){return this.toString()},e.prototype.toString=function(){return this._repo.toString()+function(e){for(var t="",n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)},e}();function Pi(e,t){if(!0===e._orderByCalled)throw new Error(t+": You can't combine multiple orderBy calls.")}function Ni(e){var t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===Fe){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(e.hasStart()){if(e.getIndexStartName()!==N)throw new Error(r);if("string"!=typeof t)throw new Error(i)}if(e.hasEnd()){if(e.getIndexEndName()!==x)throw new Error(r);if("string"!=typeof n)throw new Error(i)}}else if(e.getIndex()===Ze){if(null!=t&&!Ar(t)||null!=n&&!Ar(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if((0,o.hu)(e.getIndex()instanceof ht||e.getIndex()===lt,"unknown index type."),null!=t&&"object"==typeof t||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function xi(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var Ri=function(e){function t(t,n){return e.call(this,t,n,new Ct,!1)||this}return(0,s.ZT)(t,e),Object.defineProperty(t.prototype,"parent",{get:function(){var e=me(this._path);return null===e?null:new t(this._repo,e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e},enumerable:!1,configurable:!0}),t}(Ii),Di=function(){function e(e,t,n){this._node=e,this.ref=t,this._index=n}return Object.defineProperty(e.prototype,"priority",{get:function(){return this._node.getPriority().val()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.ref.key},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._node.numChildren()},enumerable:!1,configurable:!0}),e.prototype.child=function(t){var n=new de(t),r=Mi(this.ref,t);return new e(this._node.getChild(n),r,Ze)},e.prototype.exists=function(){return!this._node.isEmpty()},e.prototype.exportVal=function(){return this._node.val(!0)},e.prototype.forEach=function(t){var n=this;return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(function(r,i){return t(new e(i,Mi(n.ref,r),Ze))}))},e.prototype.hasChild=function(e){var t=new de(e);return!this._node.getChild(t).isEmpty()},e.prototype.hasChildren=function(){return!this._node.isLeafNode()&&!this._node.isEmpty()},e.prototype.toJSON=function(){return this.exportVal()},e.prototype.val=function(){return this._node.val()},e}();function Oi(e,t){return(e=(0,o.m9)(e))._checkNotDeleted("ref"),void 0!==t?Mi(e._root,t):e._root}function Ai(e,t){(e=(0,o.m9)(e))._checkNotDeleted("refFromURL");var n=bi(t,e._repo.repoInfo_.nodeAdmin);Br("refFromURL",n);var r=n.repoInfo;return e._repo.repoInfo_.isCustomHost()||r.host===e._repo.repoInfo_.host||k("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+e._repo.repoInfo_.host+")"),Oi(e,n.path.toString())}function Mi(e,t){var n;return null===fe((e=(0,o.m9)(e))._path)?("child","path",!1,(n=t)&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Ur("child","path",n,false)):Ur("child","path",t,!1),new Ri(e._repo,we(e._path,t))}function Li(e,t){e=(0,o.m9)(e),jr("push",e._path),Mr("push",t,e._path,!0);var n,r=Xr(e._repo),i=dt(r),s=Mi(e,i),a=Mi(e,i);return n=null!=t?Wi(a,t).then((function(){return a})):Promise.resolve(a),s.then=n.then.bind(n),s.catch=n.then.bind(n,void 0),s}function Fi(e){return jr("remove",e._path),Wi(e,null)}function Wi(e,t){e=(0,o.m9)(e),jr("set",e._path),Mr("set",t,e._path,!1);var n=new o.BH;return oi(e._repo,e._path,t,null,n.wrapCallback((function(){}))),n.promise}function qi(e,t){e=(0,o.m9)(e),jr("setPriority",e._path),Wr("setPriority",t,!1);var n=new o.BH;return oi(e._repo,we(e._path,".priority"),t,null,n.wrapCallback((function(){}))),n.promise}function Hi(e,t,n){if(jr("setWithPriority",e._path),Mr("setWithPriority",t,e._path,!1),Wr("setWithPriority",n,!1),".length"===e.key||".keys"===e.key)throw"setWithPriority failed: "+e.key+" is a read-only object.";var r=new o.BH;return oi(e._repo,e._path,t,n,r.wrapCallback((function(){}))),r.promise}function Ui(e,t){Fr("update",t,e._path,!1);var n=new o.BH;return function(e,t,n,r){li(e,"update",{path:t.toString(),value:n});var i=!0,s=ei(e),a={};if(L(n,(function(n,r){i=!1,a[n]=yr(we(t,n),st(r),e.serverSyncTree_,s)})),i)E("update() called with empty data.  Don't do anything."),ci(0,r,"ok",void 0);else{var u=ii(e),h=function(e,t,n,r){!function(e,t,n,r){(0,o.hu)(r>e.lastWriteId,"Stacking an older merge on top of newer ones"),e.allWrites.push({path:t,children:n,writeId:r,visible:!0}),e.visibleWrites=en(e.visibleWrites,t,n),e.lastWriteId=r}(e.pendingWriteTree_,t,n,r);var i=Jt.fromObject(n);return nr(e,new jt({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,i))}(e.serverSyncTree_,t,a,u);Gr(e.eventQueue_,h),e.server_.merge(t.toString(),n,(function(n,i){var o="ok"===n;o||I("update at "+t+" failed: "+n);var s=Jn(e.serverSyncTree_,u,!o),a=s.length>0?fi(e,t):t;Kr(e.eventQueue_,a,s),ci(0,r,n,i)})),L(n,(function(n){var r=mi(e,we(t,n));fi(e,r)})),Kr(e.eventQueue_,t,[])}}(e._repo,e._path,t,n.wrapCallback((function(){}))),n.promise}function ji(e){return function(e,t){var n=function(e,t){var n=t._path,r=null;e.syncPointTree_.foreachOnPath(n,(function(e,t){var i=Ce(e,n);r=r||Bn(t,i)}));var i=e.syncPointTree_.get(n);i?r=r||Bn(i,pe()):(i=new qn,e.syncPointTree_=e.syncPointTree_.set(n,i));var o=null!=r,s=o?new Bt(r,!0,!1):null;return Qt(Un(i,t,ln(e.pendingWriteTree_,t._path),o?s.getNode():it.EMPTY_NODE,o).viewCache_)}(e.serverSyncTree_,t);return null!=n?Promise.resolve(n):e.server_.get(t).then((function(n){var r=st(n).withIndex(t._queryParams.getIndex()),i=Zn(e.serverSyncTree_,t._path,r);return Yr(e.eventQueue_,t._path,i),Promise.resolve(r)}),(function(n){return li(e,"get for query "+(0,o.Pz)(t)+" failed: "+n),Promise.reject(new Error(n))}))}((e=(0,o.m9)(e))._repo,e).then((function(t){return new Di(t,new Ri(e._repo,e._path),e._queryParams.getIndex())}))}var Bi=function(){function e(e){this.callbackContext=e}return e.prototype.respondsTo=function(e){return"value"===e},e.prototype.createEvent=function(e,t){var n=t._queryParams.getIndex();return new Ei("value",this,new Di(e.snapshotNode,new Ri(t._repo,t._path),n))},e.prototype.getEventRunner=function(e){var t=this;return"cancel"===e.getEventType()?function(){return t.callbackContext.onCancel(e.error)}:function(){return t.callbackContext.onValue(e.snapshot,null)}},e.prototype.createCancelEvent=function(e,t){return this.callbackContext.hasCancelCallback?new Ti(this,e,t):null},e.prototype.matches=function(t){return t instanceof e&&(!t.callbackContext||!this.callbackContext||t.callbackContext.matches(this.callbackContext))},e.prototype.hasAnyCallback=function(){return null!==this.callbackContext},e}(),zi=function(){function e(e,t){this.eventType=e,this.callbackContext=t}return e.prototype.respondsTo=function(e){var t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t},e.prototype.createCancelEvent=function(e,t){return this.callbackContext.hasCancelCallback?new Ti(this,e,t):null},e.prototype.createEvent=function(e,t){(0,o.hu)(null!=e.childName,"Child events should have a childName.");var n=Mi(new Ri(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new Ei(e.type,this,new Di(e.snapshotNode,n,r),e.prevName)},e.prototype.getEventRunner=function(e){var t=this;return"cancel"===e.getEventType()?function(){return t.callbackContext.onCancel(e.error)}:function(){return t.callbackContext.onValue(e.snapshot,e.prevName)}},e.prototype.matches=function(t){return t instanceof e&&this.eventType===t.eventType&&(!this.callbackContext||!t.callbackContext||this.callbackContext.matches(t.callbackContext))},e.prototype.hasAnyCallback=function(){return!!this.callbackContext},e}();function Vi(e,t,n,r,i){var o;if("object"==typeof r&&(o=void 0,i=r),"function"==typeof r&&(o=r),i&&i.onlyOnce){var s=n,a=function(t,n){ui(e._repo,e,h),s(t,n)};a.userCallback=n.userCallback,a.context=n.context,n=a}var u=new Si(n,o||void 0),h="value"===t?new Bi(u):new zi(t,u);return function(e,t,n){var r;r=".info"===fe(t._path)?er(e.infoSyncTree_,t,n):er(e.serverSyncTree_,t,n),Yr(e.eventQueue_,t._path,r)}(e._repo,e,h),function(){return ui(e._repo,e,h)}}function Gi(e,t,n,r){return Vi(e,"value",t,n,r)}function Yi(e,t,n,r){return Vi(e,"child_added",t,n,r)}function Ki(e,t,n,r){return Vi(e,"child_changed",t,n,r)}function Qi(e,t,n,r){return Vi(e,"child_moved",t,n,r)}function $i(e,t,n,r){return Vi(e,"child_removed",t,n,r)}function Ji(e,t,n){var r=null,i=n?new Si(n):null;"value"===t?r=new Bi(i):t&&(r=new zi(t,i)),ui(e._repo,e,r)}var Zi=function(){},Xi=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return(0,s.ZT)(t,e),t.prototype._apply=function(e){Mr("endAt",this._value,e._path,!0);var t=Tt(e._queryParams,this._value,this._key);if(xi(t),Ni(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Ii(e._repo,e._path,t,e._orderByCalled)},t}(Zi);function eo(e,t){return Hr("endAt","key",t,!0),new Xi(e,t)}var to=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return(0,s.ZT)(t,e),t.prototype._apply=function(e){Mr("endBefore",this._value,e._path,!1);var t,n,r,i,o=(t=e._queryParams,n=this._value,r=this._key,t.index_===Fe?("string"==typeof n&&(n=ft(n)),i=Tt(t,n,r)):i=Tt(t,n,null==r?N:ft(r)),i.endBeforeSet_=!0,i);if(xi(o),Ni(o),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Ii(e._repo,e._path,o,e._orderByCalled)},t}(Zi);function no(e,t){return Hr("endBefore","key",t,!0),new to(e,t)}var ro=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return(0,s.ZT)(t,e),t.prototype._apply=function(e){Mr("startAt",this._value,e._path,!0);var t=Et(e._queryParams,this._value,this._key);if(xi(t),Ni(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Ii(e._repo,e._path,t,e._orderByCalled)},t}(Zi);function io(e,t){return void 0===e&&(e=null),Hr("startAt","key",t,!0),new ro(e,t)}var oo=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return(0,s.ZT)(t,e),t.prototype._apply=function(e){Mr("startAfter",this._value,e._path,!1);var t,n,r,i,o=(t=e._queryParams,n=this._value,r=this._key,t.index_===Fe?("string"==typeof n&&(n=pt(n)),i=Et(t,n,r)):i=Et(t,n,null==r?x:pt(r)),i.startAfterSet_=!0,i);if(xi(o),Ni(o),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Ii(e._repo,e._path,o,e._orderByCalled)},t}(Zi);function so(e,t){return Hr("startAfter","key",t,!0),new oo(e,t)}var ao=function(e){function t(t){var n=e.call(this)||this;return n._limit=t,n}return(0,s.ZT)(t,e),t.prototype._apply=function(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Ii(e._repo,e._path,(t=e._queryParams,n=this._limit,(r=t.copy()).limitSet_=!0,r.limit_=n,r.viewFrom_="l",r),e._orderByCalled);var t,n,r},t}(Zi);function uo(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new ao(e)}var ho=function(e){function t(t){var n=e.call(this)||this;return n._limit=t,n}return(0,s.ZT)(t,e),t.prototype._apply=function(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Ii(e._repo,e._path,(t=e._queryParams,n=this._limit,(r=t.copy()).limitSet_=!0,r.limit_=n,r.viewFrom_="r",r),e._orderByCalled);var t,n,r},t}(Zi);function lo(e){if("number"!=typeof e||Math.floor(e)!==e||e<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new ho(e)}var co=function(e){function t(t){var n=e.call(this)||this;return n._path=t,n}return(0,s.ZT)(t,e),t.prototype._apply=function(e){Pi(e,"orderByChild");var t=new de(this._path);if(be(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");var n=new ht(t),r=St(e._queryParams,n);return Ni(r),new Ii(e._repo,e._path,r,!0)},t}(Zi);function po(e){if("$key"===e)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===e)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===e)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Ur("orderByChild","path",e,!1),new co(e)}var fo=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,s.ZT)(t,e),t.prototype._apply=function(e){Pi(e,"orderByKey");var t=St(e._queryParams,Fe);return Ni(t),new Ii(e._repo,e._path,t,!0)},t}(Zi);function vo(){return new fo}var _o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,s.ZT)(t,e),t.prototype._apply=function(e){Pi(e,"orderByPriority");var t=St(e._queryParams,Ze);return Ni(t),new Ii(e._repo,e._path,t,!0)},t}(Zi);function yo(){return new _o}var go=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return(0,s.ZT)(t,e),t.prototype._apply=function(e){Pi(e,"orderByValue");var t=St(e._queryParams,lt);return Ni(t),new Ii(e._repo,e._path,t,!0)},t}(Zi);function mo(){return new go}var wo=function(e){function t(t,n){var r=e.call(this)||this;return r._value=t,r._key=n,r}return(0,s.ZT)(t,e),t.prototype._apply=function(e){if(Mr("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Xi(this._value,this._key)._apply(new ro(this._value,this._key)._apply(e))},t}(Zi);function bo(e,t){return Hr("equalTo","key",t,!0),new wo(e,t)}function Co(e){for(var t,n,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var a=(0,o.m9)(e);try{for(var u=(0,s.XA)(r),h=u.next();!h.done;h=u.next()){var l=h.value;a=l._apply(a)}}catch(e){t={error:e}}finally{try{h&&!h.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}return a}!function(e){(0,o.hu)(!Rn,"__referenceConstructor has already been defined"),Rn=e}(Ri),function(e){(0,o.hu)(!Wn,"__referenceConstructor has already been defined"),Wn=e}(Ri);var Eo={},To=!1;function So(e,t,n,r,i){var o=r||e.options.databaseURL;void 0===o&&(e.options.projectId||k("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),E("Using default host for project ",e.options.projectId),o=e.options.projectId+"-default-rtdb.firebaseio.com");var s,a=bi(o,i),u=a.repoInfo,h=void 0;"undefined"!=typeof process&&(h=process.env.FIREBASE_DATABASE_EMULATOR_HOST),h?(s=!0,o="http://"+h+"?ns="+u.namespace,u=(a=bi(o,i)).repoInfo):s=!a.repoInfo.secure;var l=i&&s?new z(z.OWNER):new B(e.name,e.options,t);Br("Invalid Firebase Database URL",a),be(a.path)||k("Database URL must point to the root of a Firebase Database (not including a child path).");var c=function(e,t,n,r){var i=Eo[t.name];i||(i={},Eo[t.name]=i);var o=i[e.toURLString()];return o&&k("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),o=new Zr(e,To,n,r),i[e.toURLString()]=o,o}(u,e,l,new j(e.name,n));return new ko(c,e)}var ko=function(){function e(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}return Object.defineProperty(e.prototype,"_repo",{get:function(){return this._instanceStarted||(function(e,t,n){if(e.stats_=X(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new Pt(e.repoInfo_,(function(t,n,r,i){ti(e,t,n,r,i)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((function(){return ni(e,!0)}),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{(0,o.Pz)(n)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new Oe(e.repoInfo_,t,(function(t,n,r,i){ti(e,t,n,r,i)}),(function(t){ni(e,t)}),(function(t){!function(e,t){L(t,(function(t,n){ri(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}var r,i;e.authTokenProvider_.addTokenChangeListener((function(t){e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((function(t){e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=(r=function(){return new Lt(e.stats_,e.server_)},i=e.repoInfo_.toString(),Z[i]||(Z[i]=r()),Z[i]),e.infoData_=new Nt,e.infoSyncTree_=new Qn({startListening:function(t,n,r,i){var o=[],s=e.infoData_.getNode(t._path);return s.isEmpty()||(o=Zn(e.infoSyncTree_,t._path,s),setTimeout((function(){i("ok")}),0)),o},stopListening:function(){}}),ri(e,"connected",!1),e.serverSyncTree_=new Qn({startListening:function(t,n,r,i){return e.server_.listen(t,r,n,(function(n,r){var o=i(n,r);Kr(e.eventQueue_,t._path,o)})),[]},stopListening:function(t,n){e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_root",{get:function(){return this._rootInternal||(this._rootInternal=new Ri(this._repo,pe())),this._rootInternal},enumerable:!1,configurable:!0}),e.prototype._delete=function(){var e,t,n;return this._checkNotDeleted("delete"),e=this._repo,t=this.app.name,(n=Eo[t])&&n[e.key]===e||k("Database "+t+"("+e.repoInfo_+") has already been deleted."),hi(e),delete n[e.key],this._repoInternal=null,this._rootInternal=null,Promise.resolve()},e.prototype._checkNotDeleted=function(e){null===this._rootInternal&&k("Cannot call "+e+" on a deleted database.")},e}();function Io(e){(e=(0,o.m9)(e))._checkNotDeleted("goOffline"),hi(e._repo)}function Po(e){var t;(e=(0,o.m9)(e))._checkNotDeleted("goOnline"),(t=e._repo).persistentConnection_&&t.persistentConnection_.resume(Jr)}var No={".sv":"timestamp"},xo=function(){function e(e,t){this.committed=e,this.snapshot=t}return e.prototype.toJSON=function(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}},e}();function Ro(e,t,n){var r;if(e=(0,o.m9)(e),jr("Reference.transaction",e._path),".length"===e.key||".keys"===e.key)throw"Reference.transaction failed: "+e.key+" is a read-only object.";var i=null===(r=null==n?void 0:n.applyLocally)||void 0===r||r,s=new o.BH,a=Gi(e,(function(){}));return function(t,n,r,i,a,u){li(t,"transaction on "+n);var h={path:n,update:r,onComplete:function(t,n,r){var i=null;t?s.reject(t):(i=new Di(r,new Ri(e._repo,e._path),Ze),s.resolve(new xo(n,i)))},status:null,order:y(),applyLocally:u,retryCount:0,unwatcher:a,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},l=di(t,n,void 0);h.currentInputSnapshot=l;var c=h.update(l.val());if(void 0===c)h.unwatcher(),h.currentOutputSnapshotRaw=null,h.currentOutputSnapshotResolved=null,h.onComplete&&h.onComplete(null,!1,h.currentInputSnapshot);else{Lr("transaction failed: Data returned ",c,h.path),h.status=0;var d=br(t.transactionQueueTree_,n),p=Cr(d)||[];p.push(h),Er(d,p);var f=void 0;"object"==typeof c&&null!==c&&(0,o.r3)(c,".priority")?(f=(0,o.DV)(c,".priority"),(0,o.hu)(Ar(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(tr(t.serverSyncTree_,n)||it.EMPTY_NODE).getPriority().val();var v=ei(t),_=st(c,f),g=gr(_,l,v);h.currentOutputSnapshotRaw=_,h.currentOutputSnapshotResolved=g,h.currentWriteId=ii(t);var m=$n(t.serverSyncTree_,n,g,h.currentWriteId,h.applyLocally);Kr(t.eventQueue_,n,m),pi(t,t.transactionQueueTree_)}}(e._repo,e._path,t,0,a,i),s.promise}var Do=function(){function e(e){this._delegate=e}return e.prototype.cancel=function(e){(0,o.Dv)("OnDisconnect.cancel",0,1,arguments.length),(0,o.Wj)("OnDisconnect.cancel","onComplete",e,!0);var t=this._delegate.cancel();return e&&t.then((function(){return e(null)}),(function(t){return e(t)})),t},e.prototype.remove=function(e){(0,o.Dv)("OnDisconnect.remove",0,1,arguments.length),(0,o.Wj)("OnDisconnect.remove","onComplete",e,!0);var t=this._delegate.remove();return e&&t.then((function(){return e(null)}),(function(t){return e(t)})),t},e.prototype.set=function(e,t){(0,o.Dv)("OnDisconnect.set",1,2,arguments.length),(0,o.Wj)("OnDisconnect.set","onComplete",t,!0);var n=this._delegate.set(e);return t&&n.then((function(){return t(null)}),(function(e){return t(e)})),n},e.prototype.setWithPriority=function(e,t,n){(0,o.Dv)("OnDisconnect.setWithPriority",2,3,arguments.length),(0,o.Wj)("OnDisconnect.setWithPriority","onComplete",n,!0);var r=this._delegate.setWithPriority(e,t);return n&&r.then((function(){return n(null)}),(function(e){return n(e)})),r},e.prototype.update=function(e,t){if((0,o.Dv)("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,I("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}(0,o.Wj)("OnDisconnect.update","onComplete",t,!0);var i=this._delegate.update(e);return t&&i.then((function(){return t(null)}),(function(e){return t(e)})),i},e}(),Oo=function(){function e(e,t){this.committed=e,this.snapshot=t}return e.prototype.toJSON=function(){return(0,o.Dv)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},e}(),Ao=function(){function e(e,t){this._database=e,this._delegate=t}return e.prototype.val=function(){return(0,o.Dv)("DataSnapshot.val",0,0,arguments.length),this._delegate.val()},e.prototype.exportVal=function(){return(0,o.Dv)("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()},e.prototype.toJSON=function(){return(0,o.Dv)("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()},e.prototype.exists=function(){return(0,o.Dv)("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()},e.prototype.child=function(t){return(0,o.Dv)("DataSnapshot.child",0,1,arguments.length),t=String(t),Ur("DataSnapshot.child","path",t,!1),new e(this._database,this._delegate.child(t))},e.prototype.hasChild=function(e){return(0,o.Dv)("DataSnapshot.hasChild",1,1,arguments.length),Ur("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)},e.prototype.getPriority=function(){return(0,o.Dv)("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority},e.prototype.forEach=function(t){var n=this;return(0,o.Dv)("DataSnapshot.forEach",1,1,arguments.length),(0,o.Wj)("DataSnapshot.forEach","action",t,!1),this._delegate.forEach((function(r){return t(new e(n._database,r))}))},e.prototype.hasChildren=function(){return(0,o.Dv)("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()},Object.defineProperty(e.prototype,"key",{get:function(){return this._delegate.key},enumerable:!1,configurable:!0}),e.prototype.numChildren=function(){return(0,o.Dv)("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size},e.prototype.getRef=function(){return(0,o.Dv)("DataSnapshot.ref",0,0,arguments.length),new Lo(this._database,this._delegate.ref)},Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),e}(),Mo=function(){function e(e,t){this.database=e,this._delegate=t}return e.prototype.on=function(t,n,r,i){var s,a=this;(0,o.Dv)("Query.on",2,4,arguments.length),(0,o.Wj)("Query.on","callback",n,!1);var u=e.getCancelAndContextArgs_("Query.on",r,i),h=function(e,t){n.call(u.context,new Ao(a.database,e),t)};h.userCallback=n,h.context=u.context;var l=null===(s=u.cancel)||void 0===s?void 0:s.bind(u.context);switch(t){case"value":return Gi(this._delegate,h,l),n;case"child_added":return Yi(this._delegate,h,l),n;case"child_removed":return $i(this._delegate,h,l),n;case"child_changed":return Ki(this._delegate,h,l),n;case"child_moved":return Qi(this._delegate,h,l),n;default:throw new Error((0,o.gK)("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},e.prototype.off=function(e,t,n){if((0,o.Dv)("Query.off",0,3,arguments.length),qr("Query.off",e,!0),(0,o.Wj)("Query.off","callback",t,!0),(0,o.lb)("Query.off","context",n,!0),t){var r=function(){};r.userCallback=t,r.context=n,Ji(this._delegate,e,r)}else Ji(this._delegate,e)},e.prototype.get=function(){var e=this;return ji(this._delegate).then((function(t){return new Ao(e.database,t)}))},e.prototype.once=function(t,n,r,i){var s=this;(0,o.Dv)("Query.once",1,4,arguments.length),(0,o.Wj)("Query.once","callback",n,!0);var a=e.getCancelAndContextArgs_("Query.once",r,i),u=new o.BH,h=function(e,t){var r=new Ao(s.database,e);n&&n.call(a.context,r,t),u.resolve(r)};h.userCallback=n,h.context=a.context;var l=function(e){a.cancel&&a.cancel.call(a.context,e),u.reject(e)};switch(t){case"value":Gi(this._delegate,h,l,{onlyOnce:!0});break;case"child_added":Yi(this._delegate,h,l,{onlyOnce:!0});break;case"child_removed":$i(this._delegate,h,l,{onlyOnce:!0});break;case"child_changed":Ki(this._delegate,h,l,{onlyOnce:!0});break;case"child_moved":Qi(this._delegate,h,l,{onlyOnce:!0});break;default:throw new Error((0,o.gK)("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return u.promise},e.prototype.limitToFirst=function(t){return(0,o.Dv)("Query.limitToFirst",1,1,arguments.length),new e(this.database,Co(this._delegate,uo(t)))},e.prototype.limitToLast=function(t){return(0,o.Dv)("Query.limitToLast",1,1,arguments.length),new e(this.database,Co(this._delegate,lo(t)))},e.prototype.orderByChild=function(t){return(0,o.Dv)("Query.orderByChild",1,1,arguments.length),new e(this.database,Co(this._delegate,po(t)))},e.prototype.orderByKey=function(){return(0,o.Dv)("Query.orderByKey",0,0,arguments.length),new e(this.database,Co(this._delegate,vo()))},e.prototype.orderByPriority=function(){return(0,o.Dv)("Query.orderByPriority",0,0,arguments.length),new e(this.database,Co(this._delegate,yo()))},e.prototype.orderByValue=function(){return(0,o.Dv)("Query.orderByValue",0,0,arguments.length),new e(this.database,Co(this._delegate,mo()))},e.prototype.startAt=function(t,n){return void 0===t&&(t=null),(0,o.Dv)("Query.startAt",0,2,arguments.length),new e(this.database,Co(this._delegate,io(t,n)))},e.prototype.startAfter=function(t,n){return void 0===t&&(t=null),(0,o.Dv)("Query.startAfter",0,2,arguments.length),new e(this.database,Co(this._delegate,so(t,n)))},e.prototype.endAt=function(t,n){return void 0===t&&(t=null),(0,o.Dv)("Query.endAt",0,2,arguments.length),new e(this.database,Co(this._delegate,eo(t,n)))},e.prototype.endBefore=function(t,n){return void 0===t&&(t=null),(0,o.Dv)("Query.endBefore",0,2,arguments.length),new e(this.database,Co(this._delegate,no(t,n)))},e.prototype.equalTo=function(t,n){return(0,o.Dv)("Query.equalTo",1,2,arguments.length),new e(this.database,Co(this._delegate,bo(t,n)))},e.prototype.toString=function(){return(0,o.Dv)("Query.toString",0,0,arguments.length),this._delegate.toString()},e.prototype.toJSON=function(){return(0,o.Dv)("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()},e.prototype.isEqual=function(t){if((0,o.Dv)("Query.isEqual",1,1,arguments.length),!(t instanceof e)){var n="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(n)}return this._delegate.isEqual(t._delegate)},e.getCancelAndContextArgs_=function(e,t,n){var r={cancel:void 0,context:void 0};if(t&&n)r.cancel=t,(0,o.Wj)(e,"cancel",r.cancel,!0),r.context=n,(0,o.lb)(e,"context",r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error((0,o.gK)(e,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=t}return r},Object.defineProperty(e.prototype,"ref",{get:function(){return new Lo(this.database,new Ri(this._delegate._repo,this._delegate._path))},enumerable:!1,configurable:!0}),e}(),Lo=function(e){function t(t,n){var r=e.call(this,t,new Ii(n._repo,n._path,new Ct,!1))||this;return r.database=t,r._delegate=n,r}return(0,s.ZT)(t,e),t.prototype.getKey=function(){return(0,o.Dv)("Reference.key",0,0,arguments.length),this._delegate.key},t.prototype.child=function(e){return(0,o.Dv)("Reference.child",1,1,arguments.length),"number"==typeof e&&(e=String(e)),new t(this.database,Mi(this._delegate,e))},t.prototype.getParent=function(){(0,o.Dv)("Reference.parent",0,0,arguments.length);var e=this._delegate.parent;return e?new t(this.database,e):null},t.prototype.getRoot=function(){return(0,o.Dv)("Reference.root",0,0,arguments.length),new t(this.database,this._delegate.root)},t.prototype.set=function(e,t){(0,o.Dv)("Reference.set",1,2,arguments.length),(0,o.Wj)("Reference.set","onComplete",t,!0);var n=Wi(this._delegate,e);return t&&n.then((function(){return t(null)}),(function(e){return t(e)})),n},t.prototype.update=function(e,t){if((0,o.Dv)("Reference.update",1,2,arguments.length),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,I("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}jr("Reference.update",this._delegate._path),(0,o.Wj)("Reference.update","onComplete",t,!0);var i=Ui(this._delegate,e);return t&&i.then((function(){return t(null)}),(function(e){return t(e)})),i},t.prototype.setWithPriority=function(e,t,n){(0,o.Dv)("Reference.setWithPriority",2,3,arguments.length),(0,o.Wj)("Reference.setWithPriority","onComplete",n,!0);var r=Hi(this._delegate,e,t);return n&&r.then((function(){return n(null)}),(function(e){return n(e)})),r},t.prototype.remove=function(e){(0,o.Dv)("Reference.remove",0,1,arguments.length),(0,o.Wj)("Reference.remove","onComplete",e,!0);var t=Fi(this._delegate);return e&&t.then((function(){return e(null)}),(function(t){return e(t)})),t},t.prototype.transaction=function(e,t,n){var r=this;(0,o.Dv)("Reference.transaction",1,3,arguments.length),(0,o.Wj)("Reference.transaction","transactionUpdate",e,!1),(0,o.Wj)("Reference.transaction","onComplete",t,!0),zr("Reference.transaction","applyLocally",n,!0);var i=Ro(this._delegate,e,{applyLocally:n}).then((function(e){return new Oo(e.committed,new Ao(r.database,e.snapshot))}));return t&&i.then((function(e){return t(null,e.committed,e.snapshot)}),(function(e){return t(e,!1,null)})),i},t.prototype.setPriority=function(e,t){(0,o.Dv)("Reference.setPriority",1,2,arguments.length),(0,o.Wj)("Reference.setPriority","onComplete",t,!0);var n=qi(this._delegate,e);return t&&n.then((function(){return t(null)}),(function(e){return t(e)})),n},t.prototype.push=function(e,n){var r=this;(0,o.Dv)("Reference.push",0,2,arguments.length),(0,o.Wj)("Reference.push","onComplete",n,!0);var i=Li(this._delegate,e),s=i.then((function(e){return new t(r.database,e)}));n&&s.then((function(){return n(null)}),(function(e){return n(e)}));var a=new t(this.database,i);return a.then=s.then.bind(s),a.catch=s.catch.bind(s,void 0),a},t.prototype.onDisconnect=function(){return jr("Reference.onDisconnect",this._delegate._path),new Do(new ki(this._delegate._repo,this._delegate._path))},Object.defineProperty(t.prototype,"key",{get:function(){return this.getKey()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this.getParent()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this.getRoot()},enumerable:!1,configurable:!0}),t}(Mo),Fo=function(){function e(e,t){var n=this;this._delegate=e,this.app=t,this.INTERNAL={delete:function(){return n._delegate._delete()}}}return e.prototype.useEmulator=function(e,t,n){void 0===n&&(n={}),function(e,t,n,r){void 0===r&&(r={}),(e=(0,o.m9)(e))._checkNotDeleted("useEmulator"),e._instanceStarted&&k("Cannot call useEmulator() after instance has already been initialized.");var i=e._repoInternal,s=void 0;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&k('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new z(z.OWNER);else if(r.mockUserToken){var a=(0,o.Sg)(r.mockUserToken,e.app.options.projectId);s=new z(a)}!function(e,t,n,r){e.repoInfo_=new K(t+":"+n,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams),r&&(e.authTokenProvider_=r)}(i,t,n,s)}(this._delegate,e,t,n)},e.prototype.ref=function(e){if((0,o.Dv)("database.ref",0,1,arguments.length),e instanceof Lo){var t=Ai(this._delegate,e.toString());return new Lo(this,t)}return t=Oi(this._delegate,e),new Lo(this,t)},e.prototype.refFromURL=function(e){var t="database.refFromURL";(0,o.Dv)(t,1,1,arguments.length);var n=Ai(this._delegate,e);return new Lo(this,n)},e.prototype.goOffline=function(){return(0,o.Dv)("database.goOffline",0,0,arguments.length),Io(this._delegate)},e.prototype.goOnline=function(){return(0,o.Dv)("database.goOnline",0,0,arguments.length),Po(this._delegate)},e.ServerValue={TIMESTAMP:No,increment:function(e){return function(e){return{".sv":{increment:e}}}(e)}},e}(),Wo=Object.freeze({__proto__:null,forceLongPolling:function(){se.forceDisallow(),re.forceAllow()},forceWebSockets:function(){re.forceDisallow()},isWebSocketsAvailable:function(){return se.isAvailable()},setSecurityDebugCallback:function(e,t){e._delegate._repo.persistentConnection_.securityDebugCallback_=t},stats:function(e,t){!function(e,t){if(void 0===t&&(t=!1),"undefined"!=typeof console){var n;t?(e.statsListener_||(e.statsListener_=new Mt(e.stats_)),n=e.statsListener_.get()):n=e.stats_.get();var r=Object.keys(n).reduce((function(e,t){return Math.max(t.length,e)}),0);L(n,(function(e,t){for(var n=e,i=e.length;i<r+2;i++)n+=" ";console.log(n+t)}))}}(e._delegate._repo,t)},statsIncrementCounter:function(e,t){!function(e,t){var n;e.stats_.incrementCounter(t),n=t,e.statsReporter_.statsToReport_[n]=!0}(e._delegate._repo,t)},dataUpdateCount:function(e){return e._delegate._repo.dataUpdateCount},interceptServerData:function(e,t){return function(e,t){e.interceptServerDataCallback_=t}(e._delegate._repo,t)},initStandalone:function(e){var t=e.app,n=e.url,r=e.version,o=e.customAuthImpl,s=e.namespace,a=e.nodeAdmin,u=void 0!==a&&a;h(r);var l=new i.zt("auth-internal",new i.H0("database-standalone"));return l.setComponent(new i.wA("auth-internal",(function(){return o}),"PRIVATE")),{instance:new Fo(So(t,l,void 0,n,u),t),namespace:s}}}),qo=Oe;Oe.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Oe.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};var Ho=ue,Uo=K,jo=Object.freeze({__proto__:null,DataConnection:qo,RealTimeConnection:Ho,hijackHash:function(e){var t=Oe.prototype.put;return Oe.prototype.put=function(n,r,i,o){void 0!==o&&(o=e()),t.call(this,n,r,i,o)},function(){Oe.prototype.put=t}},ConnectionTarget:Uo,queryIdentifier:function(e){return e._delegate._queryIdentifier},forceRestClient:function(e){!function(e){To=e}(e)}}),Bo=Fo.ServerValue;!function(t){h(t.SDK_VERSION);var n=t.INTERNAL.registerComponent(new i.wA("database",(function(e,t){var n=t.instanceIdentifier,r=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),o=e.getProvider("app-check-internal");return new Fo(So(r,i,o,n),r)}),"PUBLIC").setServiceProps({Reference:Lo,Query:Mo,Database:Fo,DataSnapshot:Ao,enableLogging:C,INTERNAL:Wo,ServerValue:Bo,TEST_ACCESS:jo}).setMultipleInstances(!0));t.registerVersion("@firebase/database","0.10.2"),(0,o.Yr)()&&(e.exports=n)}(r.Z)},594:(e,t,n)=>{function r(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}var i;n.d(t,{in:()=>o,Yd:()=>c,Ub:()=>d,Am:()=>p});var o,s=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(o||(o={}));var a={debug:o.DEBUG,verbose:o.VERBOSE,info:o.INFO,warn:o.WARN,error:o.ERROR,silent:o.SILENT},u=o.INFO,h=((i={})[o.DEBUG]="log",i[o.VERBOSE]="log",i[o.INFO]="info",i[o.WARN]="warn",i[o.ERROR]="error",i),l=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(!(t<e.logLevel)){var o=(new Date).toISOString(),s=h[t];if(!s)throw new Error("Attempted to log a message with an invalid logType (value: "+t+")");console[s].apply(console,r(["["+o+"]  "+e.name+":"],n))}},c=function(){function e(e){this.name=e,this._logLevel=u,this._logHandler=l,this._userLogHandler=null,s.push(this)}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in o))throw new TypeError('Invalid value "'+e+'" assigned to `logLevel`');this._logLevel=e},enumerable:!1,configurable:!0}),e.prototype.setLogLevel=function(e){this._logLevel="string"==typeof e?a[e]:e},Object.defineProperty(e.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e},enumerable:!1,configurable:!0}),e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.DEBUG],e)),this._logHandler.apply(this,r([this,o.DEBUG],e))},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.VERBOSE],e)),this._logHandler.apply(this,r([this,o.VERBOSE],e))},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.INFO],e)),this._logHandler.apply(this,r([this,o.INFO],e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.WARN],e)),this._logHandler.apply(this,r([this,o.WARN],e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,r([this,o.ERROR],e)),this._logHandler.apply(this,r([this,o.ERROR],e))},e}();function d(e){s.forEach((function(t){t.setLogLevel(e)}))}function p(e,t){for(var n=function(n){var r=null;t&&t.level&&(r=a[t.level]),n.userLogHandler=null===e?null:function(t,n){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];var a=i.map((function(e){if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}})).filter((function(e){return e})).join(" ");n>=(null!=r?r:t.logLevel)&&e({level:o[n].toLowerCase(),message:a,args:i,type:t.name})}},r=0,i=s;r<i.length;r++)n(i[r])}},589:(e,t,n)=>{n.d(t,{BH:()=>d,LL:()=>w,gQ:()=>O,hu:()=>i,g5:()=>o,US:()=>a,h$:()=>u,r3:()=>P,Sg:()=>p,ne:()=>A,p$:()=>l,ZB:()=>c,gK:()=>W,m9:()=>B,GJ:()=>I,jU:()=>_,xb:()=>x,uI:()=>f,UG:()=>v,Yr:()=>g,b$:()=>y,w9:()=>k,cI:()=>E,UI:()=>R,xO:()=>D,DV:()=>N,ug:()=>j,dS:()=>U,Pz:()=>T,Dv:()=>F,Wj:()=>q,lb:()=>H});var r=n(655),i=function(e,t){if(!e)throw o(t)},o=function(e){return new Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},s=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},a={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<e.length;i+=3){var o=e[i],s=i+1<e.length,a=s?e[i+1]:0,u=i+2<e.length,h=u?e[i+2]:0,l=o>>2,c=(3&o)<<4|a>>4,d=(15&a)<<2|h>>6,p=63&h;u||(p=64,s||(d=64)),r.push(n[l],n[c],n[d],n[p])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(s(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){for(var t=[],n=0,r=0;n<e.length;){var i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){var o=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){var s=((7&i)<<18|(63&(o=e[n++]))<<12|(63&(a=e[n++]))<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{o=e[n++];var a=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&a)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<e.length;){var o=n[e.charAt(i++)],s=i<e.length?n[e.charAt(i)]:0,a=++i<e.length?n[e.charAt(i)]:64,u=++i<e.length?n[e.charAt(i)]:64;if(++i,null==o||null==s||null==a||null==u)throw Error();var h=o<<2|s>>4;if(r.push(h),64!==a){var l=s<<4&240|a>>2;if(r.push(l),64!==u){var c=a<<6&192|u;r.push(c)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},u=function(e){var t=s(e);return a.encodeByteArray(t,!0)},h=function(e){try{return a.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function l(e){return c(void 0,e)}function c(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=c(e[n],t[n]));return e}var d=function(){function e(){var e=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(t,n){e.resolve=t,e.reject=n}))}return e.prototype.wrapCallback=function(e){var t=this;return function(n,r){n?t.reject(n):t.resolve(r),"function"==typeof e&&(t.promise.catch((function(){})),1===e.length?e(n):e(n,r))}},e}();function p(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",i=e.iat||0,o=e.sub||e.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");var s=(0,r.pi)({iss:"https://securetoken.google.com/"+n,aud:n,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},e);return[a.encodeString(JSON.stringify({alg:"none",type:"JWT"}),!1),a.encodeString(JSON.stringify(s),!1),""].join(".")}function f(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")}function v(){try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}function _(){return"object"==typeof self&&self.self===self}function y(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function g(){return!1}var m=function(e){function t(n,r,i){var o=e.call(this,r)||this;return o.code=n,o.customData=i,o.name="FirebaseError",Object.setPrototypeOf(o,t.prototype),Error.captureStackTrace&&Error.captureStackTrace(o,w.prototype.create),o}return(0,r.ZT)(t,e),t}(Error),w=function(){function e(e,t,n){this.service=e,this.serviceName=t,this.errors=n}return e.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=t[0]||{},i=this.service+"/"+e,o=this.errors[e],s=o?b(o,r):"Error",a=this.serviceName+": "+s+" ("+i+").",u=new m(i,a,r);return u},e}();function b(e,t){return e.replace(C,(function(e,n){var r=t[n];return null!=r?String(r):"<"+n+"?>"}))}var C=/\{\$([^}]+)}/g;function E(e){return JSON.parse(e)}function T(e){return JSON.stringify(e)}var S=function(e){var t={},n={},r={},i="";try{var o=e.split(".");t=E(h(o[0])||""),n=E(h(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}},k=function(e){var t=S(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},I=function(e){var t=S(e).claims;return"object"==typeof t&&!0===t.admin};function P(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function N(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function x(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function R(e,t,n){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function D(e){for(var t=[],n=function(e,n){Array.isArray(n)?n.forEach((function(n){t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))})):t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))},r=0,i=Object.entries(e);r<i.length;r++){var o=i[r];n(o[0],o[1])}return t.length?"&"+t.join("&"):""}var O=function(){function e(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}return e.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},e.prototype.compress_=function(e,t){t||(t=0);var n=this.W_;if("string"==typeof e)for(var r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(r=0;r<16;r++)n[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var o,s,a=this.chain_[0],u=this.chain_[1],h=this.chain_[2],l=this.chain_[3],c=this.chain_[4];for(r=0;r<80;r++)r<40?r<20?(o=l^u&(h^l),s=1518500249):(o=u^h^l,s=1859775393):r<60?(o=u&h|l&(u|h),s=2400959708):(o=u^h^l,s=3395469782),i=(a<<5|a>>>27)+o+c+s+n[r]&4294967295,c=l,l=h,h=4294967295&(u<<30|u>>>2),u=a,a=i;this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+u&4294967295,this.chain_[2]=this.chain_[2]+h&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295},e.prototype.update=function(e,t){if(null!=e){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<t;){if(0===o)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[o]=e.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<t;)if(i[o]=e[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=t}},e.prototype.digest=function(){var e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&t,t/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)e[r]=this.chain_[n]>>i&255,++r;return e},e}();function A(e,t){var n=new M(e,t);return n.subscribe.bind(n)}var M=function(){function e(e,t){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((function(){e(n)})).catch((function(e){n.error(e)}))}return e.prototype.next=function(e){this.forEachObserver((function(t){t.next(e)}))},e.prototype.error=function(e){this.forEachObserver((function(t){t.error(e)})),this.close(e)},e.prototype.complete=function(){this.forEachObserver((function(e){e.complete()})),this.close()},e.prototype.subscribe=function(e,t,n){var r,i=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(e,t){if("object"!=typeof e||null===e)return!1;for(var n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in e&&"function"==typeof e[i])return!0}return!1}(e)?e:{next:e,error:t,complete:n}).next&&(r.next=L),void 0===r.error&&(r.error=L),void 0===r.complete&&(r.complete=L);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(e){}})),this.observers.push(r),o},e.prototype.unsubscribeOne=function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},e.prototype.forEachObserver=function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)},e.prototype.sendOne=function(e,t){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))},e.prototype.close=function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((function(){t.observers=void 0,t.onNoObservers=void 0})))},e}();function L(){}var F=function(e,t,n,r){var i;if(r<t?i="at least "+t:r>n&&(i=0===n?"none":"no more than "+n),i)throw new Error(e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")};function W(e,t){return e+" failed: "+t+" argument "}function q(e,t,n,r){if((!r||n)&&"function"!=typeof n)throw new Error(W(e,t)+"must be a valid function.")}function H(e,t,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error(W(e,t)+"must be a valid context object.")}var U=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var o=e.charCodeAt(r);if(o>=55296&&o<=56319){var s=o-55296;r++,i(r<e.length,"Surrogate pair missing trail surrogate."),o=65536+(s<<10)+(e.charCodeAt(r)-56320)}o<128?t[n++]=o:o<2048?(t[n++]=o>>6|192,t[n++]=63&o|128):o<65536?(t[n++]=o>>12|224,t[n++]=o>>6&63|128,t[n++]=63&o|128):(t[n++]=o>>18|240,t[n++]=o>>12&63|128,t[n++]=o>>6&63|128,t[n++]=63&o|128)}return t},j=function(e){for(var t=0,n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t};function B(e){return e&&e._delegate?e._delegate:e}},655:(e,t,n)=>{n.d(t,{ZT:()=>i,pi:()=>o,mG:()=>s,Jh:()=>a,XA:()=>u,CR:()=>h,ev:()=>l});var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var o=function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function s(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))}function a(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function u(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function h(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function l(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e}Object.create,Object.create}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={id:r,loaded:!1,exports:{}};return e[r](o,o.exports,n),o.loaded=!0,o.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{class e{constructor(e,t){this.x=e,this.y=t}add(e){this.x+=e.x,this.y+=e.y}multiplyScalar(e){return this.x*=e,this.y*=e,this}get(){return{x:this.x,y:this.y}}clone(){return new e(this.x,this.y)}static add(t,n){return new e(t.x+n.x,t.y+n.y)}static distance(e,t){const n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}static isEqual(e,t){return e.x===t.x&&e.y===t.y}static multiplyScalar(e,t){let n=e.clone();return n.x*=t,n.y*=t,n}}const t=e,r={NONE:"NONE",UP:"UP",RIGHT:"RIGHT",DOWN:"DOWN",LEFT:"LEFT",LEFTDOWN:"LEFTDOWN",LEFTUP:"LEFTUP",RIGHTDOWN:"RIGHTDOWN",RIGHTUP:"RIGHTUP"};Object.freeze(r);const i=e=>{switch(e){case r.UP:return r.DOWN;case r.RIGHT:return r.LEFT;case r.DOWN:return r.UP;case r.LEFT:return r.RIGHT}},o=(e,t,n)=>{let i=r.NONE;return e.y<t.y&&t.y<n.y?i=r.UP:e.x>t.x&&t.x>n.x?i=r.RIGHT:e.x>t.x&&t.y<n.y||e.y>t.y&&t.x<n.x?i=r.RIGHTDOWN:e.x>t.x&&t.y>n.y||e.y<t.y&&t.x<n.x?i=r.RIGHTUP:e.x<t.x&&t.x<n.x?i=r.LEFT:e.x<t.x&&t.y>n.y||e.y<t.y&&t.x>n.x?i=r.LEFTUP:e.x<t.x&&t.y<n.y||e.y>t.y&&t.x>n.x?i=r.LEFTDOWN:e.y>t.y&&t.y>n.y&&(i=r.DOWN),i},s=e=>{switch(e){case r.UP:return new t(0,-1);case r.RIGHT:return new t(1,0);case r.DOWN:return new t(0,1);case r.LEFT:return new t(-1,0)}},a=r;function u(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,l(e,t,"get"))}function h(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,l(e,t,"set"),n),n}function l(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var c=new WeakMap,d=new WeakMap;function p(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,_(e,t,"get"))}function f(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}function v(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,_(e,t,"set"),n),n}function _(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var y=new WeakMap,g=new WeakMap,m=new WeakMap,w=new WeakMap,b=new WeakMap,C=new WeakMap,E=new WeakMap,T=new WeakSet,S=new WeakSet;function k(e,{spriteSheet:t,x:n,y:r,width:i,height:o}){p(this,g).drawImage(t,n,r,i,o,e.x*p(this,b),e.y*p(this,b),p(this,b),p(this,b))}function I(){p(this,E).addSprite("apple",0,0,40,40),p(this,E).addSprite("head-up",120,40,40,40),p(this,E).addSprite("head-right",120,0,40,40),p(this,E).addSprite("head-down",40,80,40,40),p(this,E).addSprite("head-left",80,80,40,40),p(this,E).addSprite("body-up",0,80,40,40),p(this,E).addSprite("body-right",0,40,40,40),p(this,E).addSprite("body-leftdown",40,0,40,40),p(this,E).addSprite("body-leftup",40,40,40,40),p(this,E).addSprite("body-down",0,80,40,40),p(this,E).addSprite("body-left",0,40,40,40),p(this,E).addSprite("body-rightdown",80,0,40,40),p(this,E).addSprite("body-rightup",80,40,40,40),p(this,E).addSprite("tail-down",120,80,40,40),p(this,E).addSprite("tail-left",0,120,40,40),p(this,E).addSprite("tail-up",80,120,40,40),p(this,E).addSprite("tail-right",40,120,40,40)}const P=class{constructor(){this._events=[]}addEvent(e){void 0===this._events[e]&&(this._events[e]=[])}clearEvent(e){this._events[e]=[]}reset(){this._events=[]}registerHandler(e,t){this.addEvent(e),this._events[e].push(t)}deregisterHandler(e,t){if(!Object.keys(this._events).includes(e))return;let n=this._events[e].indexOf(t);-1!==n&&this._events[e].splice(n,1)}dispatch(e,t){if(void 0!==this._events[e])for(let n=0;n<this._events[e].length;n++)this._events[e][n](t)}};function N(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,R(e,t,"get"))}function x(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,R(e,t,"set"),n),n}function R(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var D=new WeakSet;function O(){this.head=null,this.tail=null,this.length=0}var A=new WeakMap,M=new WeakMap;class L{constructor(e){A.set(this,{writable:!0,value:void 0}),M.set(this,{writable:!0,value:void 0}),x(this,A,null),x(this,M,e)}value(){return N(this,M)}next(){return N(this,A)}setNext(e){x(this,A,e)}setValue(e){x(this,M,e)}}function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function W(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,H(e,t,"get"))}function q(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,H(e,t,"set"),n),n}function H(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var U=new WeakMap,j=new WeakMap,B=new WeakMap,z=new WeakMap,V=new WeakMap,G=new WeakMap,Y=new WeakMap,K=new WeakMap,Q=new WeakMap;class ${constructor(e){this.position=e}}class J{constructor(){F(this,"initialNode",void 0),F(this,"currentNode",void 0),this.index=0,this.size=0,this.isAvailable=!0}start(e){this.index=0,this.isAvailable=!1,this.currentNode=e}step(e,t){this.size=(t-this.index)/t/2+.5;let n=e;for(let e=0;e<this.index;e++)n.next()&&(n=n.next());this.currentNode=n,this.index++,this.index>=t&&this.reset()}reset(){this.isAvailable=!0,this.size=0,this.index=0}getPosition(){return this.currentNode.value().position}}function Z(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,ee(e,t,"get"))}function X(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,ee(e,t,"set"),n),n}function ee(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var te=new WeakMap,ne=new WeakMap,re=new WeakMap;function ie(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,ae(e,t,"get"))}function oe(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}function se(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,ae(e,t,"set"),n),n}function ae(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var ue=new WeakMap,he=new WeakMap,le=new WeakMap,ce=new WeakMap,de=new WeakMap,pe=new WeakMap,fe=new WeakMap,ve=new WeakSet;function _e(){this.tick(),ie(this,de)&&setTimeout(oe(this,ve,_e).bind(this),0)}function ye(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,me(e,t,"get"))}function ge(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,me(e,t,"set"),n),n}function me(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var we=new WeakMap,be=new WeakMap,Ce=new WeakMap,Ee=new WeakMap;const Te=class{constructor(){we.set(this,{writable:!0,value:void 0}),be.set(this,{writable:!0,value:void 0}),Ce.set(this,{writable:!0,value:void 0}),Ee.set(this,{writable:!0,value:void 0}),ge(this,we,new P),ge(this,be,{UP:"UP",RIGHT:"RIGHT",DOWN:"DOWN",LEFT:"LEFT",E:"E",ANY:"ANY"}),ge(this,Ce,[]),ge(this,Ee,{KEY_UP:38,KEY_DOWN:40,KEY_LEFT:37,KEY_RIGHT:39});const e=e=>{ye(this,Ce)[e.keyCode]="keydown"==e.type,ye(this,we).dispatch(ye(this,be).ANY)};window.addEventListener("keydown",e),window.addEventListener("keyup",e)}update(){ye(this,Ce)[ye(this,Ee).KEY_LEFT]&&ye(this,we).dispatch(ye(this,be).LEFT),ye(this,Ce)[ye(this,Ee).KEY_UP]&&ye(this,we).dispatch(ye(this,be).UP),ye(this,Ce)[ye(this,Ee).KEY_RIGHT]&&ye(this,we).dispatch(ye(this,be).RIGHT),ye(this,Ce)[ye(this,Ee).KEY_DOWN]&&ye(this,we).dispatch(ye(this,be).DOWN)}onUp(e){ye(this,we).registerHandler(ye(this,be).UP,e)}removeOnUp(e){ye(this,we).deregisterHandler(ye(this,be).UP,e)}onRight(e){ye(this,we).registerHandler(ye(this,be).RIGHT,e)}removeOnRight(e){ye(this,we).deregisterHandler(ye(this,be).RIGHT,e)}onDown(e){ye(this,we).registerHandler(ye(this,be).DOWN,e)}removeOnDown(e){ye(this,we).deregisterHandler(ye(this,be).DOWN,e)}onLeft(e){ye(this,we).registerHandler(ye(this,be).LEFT,e)}removeOnLeft(e){ye(this,we).deregisterHandler(ye(this,be).LEFT,e)}onAnyKey(e){ye(this,we).registerHandler(ye(this,be).ANY,e)}removeOnAnyKey(e){ye(this,we).deregisterHandler(ye(this,be).ANY,e)}};function Se(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,ke(e,t,"get"))}function ke(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var Ie=new WeakMap;const Pe=class{constructor(){var e,t;Ie.set(this,{writable:!0,value:void 0}),t=[],function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e=this,ke(e,Ie,"set"),t)}load(e,t,n=.5,r=!1){Se(this,Ie)[e]=new Audio(t),Se(this,Ie)[e].volume=n,Se(this,Ie)[e].loop=r}play(e){Se(this,Ie)[e].currentTime=0,Se(this,Ie)[e].play()}stop(e){Se(this,Ie)[e].currentTime=0,Se(this,Ie)[e].pause()}};function Ne(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}function xe(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,De(e,t,"get"))}function Re(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,De(e,t,"set"),n),n}function De(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var Oe=new WeakMap,Ae=new WeakMap,Me=new WeakMap,Le=new WeakMap,Fe=new WeakMap,We=new WeakMap,qe=new WeakMap,He=new WeakMap,Ue=new WeakMap,je=new WeakMap,Be=new WeakMap,ze=new WeakMap,Ve=new WeakMap,Ge=new WeakSet,Ye=new WeakSet;function Ke(){if(xe(this,Ve).update(),xe(this,Ue)){const e=xe(this,Be),n=xe(this,Ae).getDirection();xe(this,Ae).move();let r=xe(this,Ae).getHeadPosition();xe(this,Ae).hasOverlapped()||!Ne(this,Ye,Qe).call(this,xe(this,Ae),xe(this,Le))?(Re(this,Ue,!1),this.end(e,n)):(t.isEqual(r,xe(this,Fe))?(xe(this,Ae).eat(),Re(this,Fe,xe(this,Le).getRandomCoordinate(xe(this,Ae).getPositions()))):xe(this,Ae).pop(),Re(this,Be,xe(this,Ae).getPositions()),Re(this,Oe,xe(this,Ae).getLength()-xe(this,Me)),xe(this,We).dispatch(xe(this,qe).UPDATE,{currentSnakeDirection:xe(this,Ae).getDirection(),currentSnakePositions:xe(this,Ae).getPositions(),snakeLength:xe(this,Ae).getLength(),bulges:xe(this,Ae).getBulges(),applePosition:xe(this,Fe),score:xe(this,Oe)}))}}function Qe(e,t){let n=e.getHeadPosition();return n.y>=0&&n.y<t.getRowCount()&&n.x>=0&&n.x<t.getColumnCount()}const $e={apiKey:"AIzaSyDx7boERoLfQppY8VUF8gVkrJno-i5Hz5A",authDomain:"jm-snake.firebaseapp.com",databaseURL:"https://jm-snake-default-rtdb.europe-west1.firebasedatabase.app",projectId:"jm-snake",storageBucket:"jm-snake.appspot.com",messagingSenderId:"408740707887",appId:"1:408740707887:web:dd1ee659cc02d32b6690da"};var Je=n(99);function Ze(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,et(e,t,"get"))}function Xe(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,et(e,t,"set"),n),n}function et(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}Je.Z.registerVersion("firebase","8.6.3","app"),n(446);var tt=new WeakMap,nt=new WeakMap,rt=new WeakMap;function it(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,st(e,t,"get"))}function ot(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,st(e,t,"set"),n),n}function st(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var at=new WeakMap,ut=new WeakMap;function ht(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,lt(e,t,"get"))}function lt(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var ct=new WeakMap,dt=new WeakSet;function pt(e,t){return e.value>t.value?-1:t.value>e.value||Date.parse(e.date)>Date.parse(t.date)?1:Date.parse(t.date)>Date.parse(e.date)?-1:0}function ft(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}function vt(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,yt(e,t,"get"))}function _t(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,yt(e,t,"set"),n),n}function yt(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var gt=new WeakMap,mt=new WeakMap,wt=new WeakMap,bt=new WeakMap,Ct=new WeakMap,Et=new WeakMap,Tt=new WeakMap,St=new WeakMap,kt=new WeakMap,It=new WeakMap,Pt=new WeakMap,Nt=new WeakSet,xt=new WeakSet,Rt=new WeakSet,Dt=new WeakSet,Ot=new WeakSet,At=new WeakSet,Mt=new WeakSet,Lt=new WeakSet,Ft=new WeakSet;function Wt(){ft(this,At,Bt).call(this,vt(this,Ct)),ft(this,Mt,zt).call(this,vt(this,Et)),ft(this,Mt,zt).call(this,vt(this,Tt)),ft(this,Mt,zt).call(this,vt(this,St));const e=vt(this,Ct).querySelector("#high-scores-button"),t=vt(this,Ct).querySelector("#start-button"),n=()=>{t.removeEventListener("click",n),ft(this,xt,qt).call(this)},r=()=>{e.removeEventListener("click",r),ft(this,Dt,Ut).call(this),vt(this,wt).dispatch(vt(this,bt).SHOWHIGHSCORES)};t.addEventListener("click",n),e.addEventListener("click",r),vt(this,wt).dispatch(vt(this,bt).MAINMENU)}function qt(){ft(this,Rt,Ht).call(this),vt(this,wt).dispatch(vt(this,bt).INIT),ft(this,Lt,Vt).call(this,"Press any key to begin");const e=()=>{vt(this,gt).removeOnAnyKey(e),ft(this,Ft,Gt).call(this),vt(this,wt).dispatch(vt(this,bt).STARTGAME)};vt(this,gt).onAnyKey(e)}function Ht(){ft(this,Mt,zt).call(this,vt(this,Ct)),ft(this,At,Bt).call(this,vt(this,Et)),ft(this,Mt,zt).call(this,vt(this,Tt)),ft(this,Mt,zt).call(this,vt(this,St))}function Ut(){ft(this,Mt,zt).call(this,vt(this,Ct)),ft(this,Mt,zt).call(this,vt(this,Et)),ft(this,At,Bt).call(this,vt(this,Tt)),ft(this,Mt,zt).call(this,vt(this,St)),this.renderHighScores(vt(this,mt).getTopTen());const e=vt(this,Tt).querySelector("#back-button"),t=()=>{e.removeEventListener("click",t),ft(this,Nt,Wt).call(this)};e.addEventListener("click",t)}function jt(e){ft(this,Mt,zt).call(this,vt(this,Ct)),ft(this,Mt,zt).call(this,vt(this,Et)),ft(this,Mt,zt).call(this,vt(this,Tt)),ft(this,At,Bt).call(this,vt(this,St));const t=vt(this,St).querySelector("#play-again-button"),n=vt(this,St).querySelector("#menu-button"),r=vt(this,St).querySelector("#submit-button"),i=vt(this,St).querySelector("#name"),o=t=>{t.preventDefault(),"string"==typeof i.value&&i.value.length>0?(r.removeEventListener("click",o),vt(this,mt).addHighScore(i.value,e),ft(this,Dt,Ut).call(this),vt(this,wt).dispatch(vt(this,bt).SHOWHIGHSCORES)):alert("Please enter a name")},s=()=>{t.removeEventListener("click",s),ft(this,xt,qt).call(this)},a=()=>{n.removeEventListener("click",a),ft(this,Nt,Wt).call(this)};t.addEventListener("click",s),n.addEventListener("click",a),r.addEventListener("click",o)}function Bt(e){e.classList.remove("hidden")}function zt(e){e.classList.add("hidden")}function Vt(e){ft(this,At,Bt).call(this,vt(this,kt)),vt(this,It).innerHTML=e}function Gt(){vt(this,It).innerHTML="",ft(this,Mt,zt).call(this,vt(this,kt))}const Yt=new class{constructor(e,t=30){S.add(this),T.add(this),y.set(this,{writable:!0,value:void 0}),g.set(this,{writable:!0,value:void 0}),m.set(this,{writable:!0,value:void 0}),w.set(this,{writable:!0,value:void 0}),b.set(this,{writable:!0,value:void 0}),C.set(this,{writable:!0,value:void 0}),E.set(this,{writable:!0,value:void 0}),v(this,y,e),v(this,g,e.getContext("2d")),v(this,w,e.height),v(this,m,e.width),v(this,b,t),v(this,C,2),v(this,E,new class{constructor(e){c.set(this,{writable:!0,value:void 0}),d.set(this,{writable:!0,value:void 0}),h(this,c,document.createElement("img")),u(this,c).src=e,h(this,d,{})}addSprite(e,t,n,r,i){u(this,d)[e]={spriteSheet:u(this,c),x:t,y:n,width:r,height:i}}getSprite(e){return u(this,d)[e]}}("./images/snake-spritesheet.png")),f(this,S,I).call(this)}clear(){p(this,g).clearRect(0,0,p(this,y).width,p(this,y).height)}drawGrid(e){p(this,g).beginPath(),e.getGridCoordinates().forEach((e=>{p(this,g).beginPath(),p(this,g).fillStyle=e.y%2==e.x%2?"#ffffff":"#ced7dd ",p(this,g).rect(e.x*p(this,b),e.y*p(this,b),p(this,b),p(this,b)),p(this,g).fill(),p(this,g).closePath()})),p(this,g).closePath()}drawSnake(e,t){let n,i,s;p(this,g).beginPath();for(var a=1;a<e.length-1;a++)n=o(e[a-1],e[a],e[a+1]),i=`body-${n.toString().toLowerCase()}`,s=p(this,E).getSprite(i),s&&f(this,T,k).call(this,e[a],s);const u=`tail-${((e,t)=>{let n=r.UP;return e.x===t.x&&e.y<t.y?n=r.UP:e.x>t.x&&e.y===t.y?n=r.RIGHT:e.x<t.x&&e.y===t.y?n=r.LEFT:e.x===t.x&&e.y>t.y&&(n=r.DOWN),n})(e[e.length-1],e[e.length-2]).toString().toLowerCase()}`,h=p(this,E).getSprite(u);f(this,T,k).call(this,e[e.length-1],h);const l=`head-${t.toString().toLowerCase()}`,c=p(this,E).getSprite(l);f(this,T,k).call(this,e[0],c)}takeScreenshot(){return p(this,y).toDataURL("png")}drawApple(e){let{spriteSheet:t,x:n,y:r,width:i,height:o}=p(this,E).getSprite("apple");p(this,g).rect(e.x*p(this,b)+p(this,C),e.y*p(this,b)+p(this,C),p(this,b)-p(this,C),p(this,b)-p(this,C)),p(this,g).drawImage(t,n,r,i,o,e.x*p(this,b),e.y*p(this,b),p(this,b),p(this,b))}drawSnakeMouth(e,n){let r=s(n);const i=p(this,b)/2,o=t.multiplyScalar(r,i/1.5);p(this,g).beginPath(),p(this,g).arc(e.x*p(this,b)+i+o.x,e.y*p(this,b)+i+o.y,p(this,b)/3.5,0,2*Math.PI,!1),p(this,g).fillStyle="black",p(this,g).fill(),p(this,g).closePath()}drawBulges(e){if(Array.isArray(e)){const t=p(this,b)/2;e.forEach((({position:e,size:n})=>{p(this,g).beginPath(),p(this,g).arc(e.x*p(this,b)+t,e.y*p(this,b)+t,p(this,b)/1.5*n,0,2*Math.PI,!1),p(this,g).fillStyle="#5b7bf9",p(this,g).fill(),p(this,g).closePath()}))}}}(document.getElementById("canvas")),Kt=document.getElementById("intro-screen"),Qt=document.getElementById("game-screen"),$t=document.getElementById("high-score-screen"),Jt=document.getElementById("review-screen"),Zt=new class{constructor(){Ye.add(this),Ge.add(this),Oe.set(this,{writable:!0,value:void 0}),Ae.set(this,{writable:!0,value:void 0}),Me.set(this,{writable:!0,value:void 0}),Le.set(this,{writable:!0,value:void 0}),Fe.set(this,{writable:!0,value:void 0}),We.set(this,{writable:!0,value:void 0}),qe.set(this,{writable:!0,value:void 0}),He.set(this,{writable:!0,value:void 0}),Ue.set(this,{writable:!0,value:void 0}),je.set(this,{writable:!0,value:void 0}),Be.set(this,{writable:!0,value:void 0}),ze.set(this,{writable:!0,value:void 0}),Ve.set(this,{writable:!0,value:void 0}),Re(this,Me,6),Re(this,Le,new class{constructor(e=0,t=0){te.set(this,{writable:!0,value:void 0}),ne.set(this,{writable:!0,value:void 0}),re.set(this,{writable:!0,value:void 0}),X(this,ne,e),X(this,re,t),X(this,te,new Array(Z(this,ne)*Z(this,re)))}getCenter(){return new t(Z(this,ne)/2-1,Z(this,re)/2-1)}getColumnCount(){return Z(this,ne)}getRowCount(){return Z(this,re)}getGrid(){return Z(this,te)}getGridCoordinate(e){return new t(e%Z(this,ne),Math.floor(e/Z(this,re)))}getIndex(e,t){return t*Z(this,ne)+e}getGridCoordinates(){return[...this.getGrid().keys()].map(((e,t)=>this.getGridCoordinate(t)))}getRandomIndex(e=[]){const t=[...this.getGrid().keys()].map(((e,t)=>t)).filter((t=>!e.includes(t)));return t[Math.floor(Math.random()*t.length)]}getRandomCoordinate(e=[]){const t=e.map((e=>this.getIndex(e.x,e.y))),n=this.getRandomIndex(t);return this.getGridCoordinate(n)}}(20,20)),Re(this,Ae,new class{constructor(e,t=5,n=a.UP){U.set(this,{writable:!0,value:void 0}),j.set(this,{writable:!0,value:void 0}),B.set(this,{writable:!0,value:void 0}),z.set(this,{writable:!0,value:void 0}),V.set(this,{writable:!0,value:void 0}),G.set(this,{writable:!0,value:void 0}),Y.set(this,{writable:!0,value:void 0}),K.set(this,{writable:!0,value:void 0}),Q.set(this,{writable:!0,value:void 0}),q(this,j,n),q(this,B,n),q(this,G,e),q(this,Y,n),q(this,K,t),q(this,z,new P),q(this,V,{EAT:"EAT",CHANGEDIRECTION:"CHANGEDIRECTION"}),this.init()}init(){const e=i(W(this,Y)),n=s(e);let r;q(this,U,new class{constructor(){D.add(this),function(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}(this,D,O).call(this)}push(e){const t=new L(e);return this.head?(this.tail.setNext(t),this.tail=t):(this.head=t,this.tail=this.head),this.length+=1,this}pop(){if(0===this.length)return;let e=this.head,t=e;for(;e.next();)t=e,e=e.next();return this.tail=t,this.tail.setNext(null),this.length-=1,e}unshift(e){const t=new L(e);return this.head?(t.setNext(this.head),this.head=t):(this.head=t,this.tail=this.head),this.length+=1,this}}),W(this,U).push(new $(W(this,G)));for(let e=1;e<W(this,K);e++)r=t.multiplyScalar(n,e),W(this,U).push(new $(t.add(W(this,G),r)));q(this,j,W(this,Y)),q(this,Q,[])}changeDirection(e){const t=i(W(this,j));(e=>Object.keys(r).includes(e))(e)&&e!==t&&q(this,B,e),W(this,j)!=e&&W(this,z).dispatch(W(this,V).CHANGEDIRECTION,e)}move(){let e=W(this,U).head;const n=s(W(this,B));let r=e.value().position,i=t.add(r,n);W(this,U).unshift({position:i}),q(this,j,W(this,B)),W(this,Q).filter((e=>!e.isAvailable)).forEach((e=>{e.step(W(this,U).head,W(this,U).length),e.step(W(this,U).head,W(this,U).length)}))}eat(){W(this,z).dispatch(W(this,V).EAT,W(this,U).length);const e=W(this,Q).filter((e=>e.isAvailable));if(e.length>0)e[0].start(W(this,U).head);else{const e=new J;e.start(W(this,U).head),W(this,Q).push(e)}}pop(){W(this,U).pop()}resetHandlers(){W(this,z).reset()}getBody(){return W(this,U)}getLength(){return W(this,U).length}getDirection(){return W(this,j)}getNextDirection(){return W(this,B)}getPositions(){const e=[];let t=W(this,U).head,n=0;for(;n<W(this,U).length;)e.push(t.value().position.get()),t=t.next(),n++;return e}getBodyPositions(){const e=this.getPositions();return e.shift(),e}getBulges(){return W(this,Q).filter((e=>!e.isAvailable)).map((e=>({position:e.getPosition(),size:e.size})))}getHeadPosition(){return W(this,U).head.value().position}setHeadPosition(e){W(this,U).head.setValue(new $(e))}hasOverlapped(){const e=this.getPositions();return e.shift(),e.filter((e=>t.isEqual(e,W(this,U).head.value().position))).length>0}onEat(e){W(this,z).registerHandler(W(this,V).EAT,e)}removeOnEat(e){W(this,z).deregisterHandler(W(this,V).EAT,e)}onChangeDirection(e){W(this,z).registerHandler(W(this,V).CHANGEDIRECTION,e)}removeOnChangeDirection(e){W(this,z).deregisterHandler(W(this,V).CHANGEDIRECTION,e)}}(xe(this,Le).getCenter(),xe(this,Me),a.UP)),Re(this,He,new class{constructor(){ve.add(this),ue.set(this,{writable:!0,value:void 0}),he.set(this,{writable:!0,value:void 0}),le.set(this,{writable:!0,value:void 0}),ce.set(this,{writable:!0,value:void 0}),de.set(this,{writable:!0,value:void 0}),pe.set(this,{writable:!0,value:void 0}),fe.set(this,{writable:!0,value:void 0}),se(this,pe,new P),se(this,fe,{TICK:"TICK",ELAPSED:"ELAPSED"})}start(e){se(this,le,0),se(this,he,performance.now()),se(this,ce,e),se(this,de,!0),window.requestAnimationFrame(oe(this,ve,_e).bind(this))}reset(){se(this,le,0),se(this,he,performance.now())}stop(){se(this,de,!1)}hasElapsed(){return ie(this,ue)}tick(){ie(this,de)&&(ie(this,pe).dispatch(ie(this,fe).TICK,ie(this,le)/ie(this,ce)),se(this,le,performance.now()-ie(this,he)),se(this,ue,ie(this,le)>ie(this,ce)),this.hasElapsed()&&(ie(this,pe).dispatch(ie(this,fe).ELAPSED),this.reset()))}clearHandlers(){ie(this,pe).reset()}onTick(e){ie(this,pe).registerHandler(ie(this,fe).TICK,e)}removeOnTick(e){ie(this,pe).deregisterHandler(ie(this,fe).TICK,e)}onElapsed(e){ie(this,pe).registerHandler(ie(this,fe).ELAPSED,e)}removeOnElapsed(e){ie(this,pe).deregisterHandler(ie(this,fe).ELAPSED,e)}}),Re(this,We,new P),Re(this,Ue,!1),Re(this,je,150),Re(this,Be,[]),Re(this,ze,new Pe),Re(this,qe,{INIT:"INIT",START:"START",END:"END",PAUSE:"PAUSE",RESET:"RESET",UPDATE:"UPDATE",TICK:"TICK"}),Object.freeze(xe(this,qe)),Re(this,Ve,new Te),xe(this,Ve).onUp((()=>xe(this,Ae).changeDirection(a.UP))),xe(this,Ve).onRight((()=>xe(this,Ae).changeDirection(a.RIGHT))),xe(this,Ve).onDown((()=>xe(this,Ae).changeDirection(a.DOWN))),xe(this,Ve).onLeft((()=>xe(this,Ae).changeDirection(a.LEFT))),xe(this,ze).load("eat","../audio/eat.wav",.8),xe(this,ze).load("up","../audio/wo.wav"),xe(this,ze).load("right","../audio/we.wav"),xe(this,ze).load("down","../audio/wa.wav"),xe(this,ze).load("left","../audio/wu.wav"),xe(this,ze).load("bg","../audio/Monkeys-Spinning-Monkeys.mp3",.3,!0),xe(this,ze).load("cheering","../audio/cheering.wav",.3,!1)}init(){Re(this,Ue,!1),xe(this,He).stop(),xe(this,He).clearHandlers(),xe(this,He).onElapsed(Ne(this,Ge,Ke).bind(this)),Re(this,Oe,0),Re(this,Fe,xe(this,Le).getRandomCoordinate(xe(this,Ae).getPositions())),xe(this,Ae).init(),xe(this,ze).play("bg"),xe(this,He).onTick((()=>{xe(this,Ve).update()}));const e=e=>{Re(this,Oe,e-xe(this,Me)),xe(this,ze).play("eat")},t=e=>{xe(this,ze).play(e.toString().toLowerCase())};xe(this,Ae).removeOnEat(e),xe(this,Ae).onEat(e),xe(this,Ae).removeOnChangeDirection(t),xe(this,Ae).onChangeDirection(t),xe(this,We).dispatch(xe(this,qe).UPDATE,{currentSnakeDirection:xe(this,Ae).getDirection(),currentSnakePositions:xe(this,Ae).getPositions(),snakeLength:xe(this,Ae).getLength(),bulges:xe(this,Ae).getBulges(),applePosition:xe(this,Fe),score:xe(this,Oe)})}start(){Re(this,Ue,!0),xe(this,He).start(xe(this,je))}end(e,t){xe(this,He).stop(),xe(this,He).removeOnElapsed(Ne(this,Ge,Ke)),xe(this,Ae).resetHandlers(),xe(this,ze).stop("bg"),xe(this,ze).play("cheering"),xe(this,We).dispatch(xe(this,qe).END,{currentSnakeDirection:t,currentSnakePositions:e,snakeLength:xe(this,Ae).getLength(),bulges:xe(this,Ae).getBulges(),applePosition:xe(this,Fe),score:xe(this,Oe),grid:xe(this,Le)})}onUpdate(e){xe(this,We).registerHandler(xe(this,qe).UPDATE,e)}removeOnUpdate(e){xe(this,We).deregisterHandler(xe(this,qe).UPDATE,e)}onInit(e){xe(this,We).registerHandler(xe(this,qe).INIT,e)}removeOnInit(e){xe(this,We).deregisterHandler(xe(this,qe).INIT,e)}onEnd(e){xe(this,We).registerHandler(xe(this,qe).END,e)}removeOnEnd(e){xe(this,We).deregisterHandler(xe(this,qe).END,e)}},Xt=new Pe;Xt.load("menu-bg","./audio/Komiku_-_12_-_Bicycle.mp3",.5,!0);const en=new class{constructor(e,t,n,r){Ft.add(this),Lt.add(this),Mt.add(this),At.add(this),Ot.add(this),Dt.add(this),Rt.add(this),xt.add(this),Nt.add(this),gt.set(this,{writable:!0,value:void 0}),mt.set(this,{writable:!0,value:void 0}),wt.set(this,{writable:!0,value:void 0}),bt.set(this,{writable:!0,value:void 0}),Ct.set(this,{writable:!0,value:void 0}),Et.set(this,{writable:!0,value:void 0}),Tt.set(this,{writable:!0,value:void 0}),St.set(this,{writable:!0,value:void 0}),kt.set(this,{writable:!0,value:void 0}),It.set(this,{writable:!0,value:void 0}),Pt.set(this,{writable:!0,value:void 0}),_t(this,gt,new Te),_t(this,wt,new P),_t(this,mt,new class{constructor(e){var t,n,r;dt.add(this),ct.set(this,{writable:!0,value:void 0}),t=this,n=ct,r="localhost"===window.location.hostname?new class{constructor(e){at.set(this,{writable:!0,value:void 0}),ut.set(this,{writable:!0,value:void 0}),ot(this,ut,e),ot(this,at,[]);let t=window.localStorage.getItem(e);if("string"==typeof t){let e=JSON.parse(t);Array.isArray(e)&&ot(this,at,[...e])}}get(){return it(this,at)}set(e){it(this,at).push(e),window.localStorage.setItem(it(this,ut),JSON.stringify(it(this,at)))}}(e):new class{constructor(e){tt.set(this,{writable:!0,value:void 0}),nt.set(this,{writable:!0,value:void 0}),rt.set(this,{writable:!0,value:void 0}),Xe(this,rt,e),Je.Z.initializeApp($e),Xe(this,tt,Je.Z.database),Ze(this,tt).call(this).ref(Ze(this,rt)).get().then((e=>{e.exists()?Xe(this,nt,JSON.parse(e.val())):(console.log("No data available"),Xe(this,nt,[]))})).catch((e=>{console.error(e)}))}get(){return Ze(this,nt)}set(e){Ze(this,nt).push(e),Ze(this,tt).call(this).ref(Ze(this,rt)).set(JSON.stringify(Ze(this,nt)))}}(e),function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(t,lt(t,n,"set"),r)}getHighScores(){ht(this,ct).get()}addHighScore(e,t){ht(this,ct).set({name:e,value:t,date:(new Date).toISOString()})}getTopTen(){return ht(this,ct).get().sort(function(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return n}(this,dt,pt)).filter(((e,t)=>t<10))}}("highscores")),_t(this,bt,{INIT:"INIT",MAINMENU:"MAINMENU",STARTGAME:"STARTGAME",SUBMITSCORE:"SUBMITSCORE",SHOWHIGHSCORES:"SHOWHIGHSCORES"}),Object.freeze(vt(this,bt)),_t(this,Ct,e),_t(this,Et,t),_t(this,Tt,n),_t(this,St,r),_t(this,Pt,document.body.querySelectorAll(".score")),_t(this,kt,document.getElementById("prompt")),_t(this,It,document.getElementById("prompt-text")),ft(this,Ft,Gt).call(this),ft(this,Nt,Wt).call(this)}updateScore(e){for(var t=0;t<vt(this,Pt).length;t++)vt(this,Pt)[t].innerHTML=e}goToReview(e,t){ft(this,Ot,jt).call(this,t),vt(this,St).querySelector("img").src=e,this.updateScore(t)}renderHighScores(e){const t=vt(this,Tt).querySelector("#high-scores"),n=vt(this,Tt).querySelector("#high-scores-message");ft(this,At,Bt).call(this,t),ft(this,Mt,zt).call(this,n),0===e.length&&ft(this,At,Bt).call(this,n);let r=['<li><h3>name</h3><h3>#<span class="apple-icon"></span></h3></li>'];for(let t=0;t<10;t++)t<e.length?r.push(`<li><div>${e[t].name}</div><div>${e[t].value}</div></li>`):r.push("<li><div></div><div></div></li>");t.innerHTML=r.join("")}onInitGame(e){vt(this,wt).registerHandler(vt(this,bt).INIT,e)}removeonInitGame(e){vt(this,wt).deregisterHandler(vt(this,bt).INIT,e)}onStartGame(e){vt(this,wt).registerHandler(vt(this,bt).STARTGAME,e)}removeOnStartGame(e){vt(this,wt).deregisterHandler(vt(this,bt).STARTGAME,e)}onSubmitHighScores(e){vt(this,wt).registerHandler(vt(this,bt).SUBMITSCORE,e)}removeOnSubmitHighScores(e){vt(this,wt).deregisterHandler(vt(this,bt).SUBMITSCORE,e)}onShowHighScores(e){vt(this,wt).registerHandler(vt(this,bt).SHOWHIGHSCORES,e)}removeOnShowHighScores(e){vt(this,wt).deregisterHandler(vt(this,bt).SHOWHIGHSCORES,e)}onMainMenu(e){vt(this,wt).registerHandler(vt(this,bt).MAINMENU,e)}removeOnMainMenu(e){vt(this,wt).deregisterHandler(vt(this,bt).MAINMENU,e)}}(Kt,Qt,$t,Jt);en.onMainMenu((()=>{Xt.play("menu-bg")})),en.onInitGame((()=>{Xt.stop("menu-bg"),Zt.init()})),en.onStartGame((()=>{Zt.start()}));const tn=({currentSnakePositions:e,currentSnakeDirection:n,snakeLength:r,bulges:i,applePosition:o,score:s})=>{const a=t.distance(e[0],o);Yt.clear(),Yt.drawBulges(i),Yt.drawSnake(e,n,r),a<2&&Yt.drawSnakeMouth(e[0],n),Yt.drawApple(o),en.updateScore(s)};Zt.onInit(tn),Zt.onUpdate(tn),Zt.onEnd((({currentSnakePositions:e,currentSnakeDirection:t,snakeLength:n,applePosition:r,score:i,grid:o})=>{Yt.clear(),Yt.drawGrid(o),Yt.drawSnake(e,t,n),Yt.drawApple(r);const s=Yt.takeScreenshot();en.goToReview(s,i)}))})()})();
(()=>{"use strict";class t{constructor(t,e){this.x=t,this.y=e}add(t){this.x+=t.x,this.y+=t.y}multiplyScalar(t){return this.x*=t,this.y*=t,this}get(){return{x:this.x,y:this.y}}clone(){return new t(this.x,this.y)}static add(e,i){return new t(e.x+i.x,e.y+i.y)}static distance(t,e){const i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}static isEqual(t,e){return t.x===e.x&&t.y===e.y}static multiplyScalar(t,e){let i=t.clone();return i.x*=e,i.y*=e,i}}const e=t,i={NONE:"NONE",UP:"UP",RIGHT:"RIGHT",DOWN:"DOWN",LEFT:"LEFT",LEFTDOWN:"LEFTDOWN",LEFTUP:"LEFTUP",RIGHTDOWN:"RIGHTDOWN",RIGHTUP:"RIGHTUP"};Object.freeze(i);const s=t=>{switch(t){case i.UP:return i.DOWN;case i.RIGHT:return i.LEFT;case i.DOWN:return i.UP;case i.LEFT:return i.RIGHT}},n=(t,e,s)=>{let n=i.NONE;return t.y<e.y&&e.y<s.y?n=i.UP:t.x>e.x&&e.x>s.x?n=i.RIGHT:t.x>e.x&&e.y<s.y||t.y>e.y&&e.x<s.x?n=i.RIGHTDOWN:t.x>e.x&&e.y>s.y||t.y<e.y&&e.x<s.x?n=i.RIGHTUP:t.x<e.x&&e.x<s.x?n=i.LEFT:t.x<e.x&&e.y>s.y||t.y<e.y&&e.x>s.x?n=i.LEFTUP:t.x<e.x&&e.y<s.y||t.y>e.y&&e.x>s.x?n=i.LEFTDOWN:t.y>e.y&&e.y>s.y&&(n=i.DOWN),n},a=t=>{switch(t){case i.UP:return new e(0,-1);case i.RIGHT:return new e(1,0);case i.DOWN:return new e(0,1);case i.LEFT:return new e(-1,0)}},r=i;function h(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,l(t,e,"get"))}function o(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,l(t,e,"set"),i),i}function l(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var d=new WeakMap,c=new WeakMap;function u(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,v(t,e,"get"))}function p(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}function w(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,v(t,e,"set"),i),i}function v(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var g=new WeakMap,f=new WeakMap,y=new WeakMap,E=new WeakMap,S=new WeakMap,m=new WeakMap,T=new WeakMap,k=new WeakSet,b=new WeakSet;function H(t,{spriteSheet:e,x:i,y:s,width:n,height:a}){u(this,f).drawImage(e,i,s,n,a,t.x*u(this,S),t.y*u(this,S),u(this,S),u(this,S))}function W(){u(this,T).addSprite("apple",0,0,40,40),u(this,T).addSprite("head-up",120,40,40,40),u(this,T).addSprite("head-right",120,0,40,40),u(this,T).addSprite("head-down",40,80,40,40),u(this,T).addSprite("head-left",80,80,40,40),u(this,T).addSprite("body-up",0,80,40,40),u(this,T).addSprite("body-right",0,40,40,40),u(this,T).addSprite("body-leftdown",40,0,40,40),u(this,T).addSprite("body-leftup",40,40,40,40),u(this,T).addSprite("body-down",0,80,40,40),u(this,T).addSprite("body-left",0,40,40,40),u(this,T).addSprite("body-rightdown",80,0,40,40),u(this,T).addSprite("body-rightup",80,40,40,40),u(this,T).addSprite("tail-down",120,80,40,40),u(this,T).addSprite("tail-left",0,120,40,40),u(this,T).addSprite("tail-up",80,120,40,40),u(this,T).addSprite("tail-right",40,120,40,40)}const M=class{constructor(){this._events=[]}addEvent(t){void 0===this._events[t]&&(this._events[t]=[])}clearEvent(t){this._events[t]=[]}reset(){this._events=[]}registerHandler(t,e){this.addEvent(t),this._events[t].push(e)}deregisterHandler(t,e){if(!Object.keys(this._events).includes(t))return;let i=this._events[t].indexOf(e);-1!==i&&this._events[t].splice(i,1)}dispatch(t,e){if(void 0!==this._events[t])for(let i=0;i<this._events[t].length;i++)this._events[t][i](e)}};function I(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,N(t,e,"get"))}function x(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,N(t,e,"set"),i),i}function N(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var O=new WeakSet;function P(){this.head=null,this.tail=null,this.length=0}var D=new WeakMap,A=new WeakMap;class L{constructor(t){D.set(this,{writable:!0,value:void 0}),A.set(this,{writable:!0,value:void 0}),x(this,D,null),x(this,A,t)}value(){return I(this,A)}next(){return I(this,D)}setNext(t){x(this,D,t)}setValue(t){x(this,A,t)}}function C(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function R(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,U(t,e,"get"))}function G(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,U(t,e,"set"),i),i}function U(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var B=new WeakMap,F=new WeakMap,q=new WeakMap,_=new WeakMap,K=new WeakMap,z=new WeakMap,j=new WeakMap,Y=new WeakMap,$=new WeakMap;class J{constructor(t){this.position=t}}class V{constructor(){C(this,"initialNode",void 0),C(this,"currentNode",void 0),this.index=0,this.size=0,this.isAvailable=!0}start(t){this.index=0,this.isAvailable=!1,this.currentNode=t}step(t,e){this.size=(e-this.index)/e/2+.5;let i=t;for(let t=0;t<this.index;t++)i.next()&&(i=i.next());this.currentNode=i,this.index++,this.index>=e&&this.reset()}reset(){this.isAvailable=!0,this.size=0,this.index=0}getPosition(){return this.currentNode.value().position}}function Q(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,Z(t,e,"get"))}function X(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Z(t,e,"set"),i),i}function Z(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var tt=new WeakMap,et=new WeakMap,it=new WeakMap;function st(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,rt(t,e,"get"))}function nt(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}function at(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,rt(t,e,"set"),i),i}function rt(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var ht=new WeakMap,ot=new WeakMap,lt=new WeakMap,dt=new WeakMap,ct=new WeakMap,ut=new WeakMap,pt=new WeakMap,wt=new WeakSet;function vt(){this.tick(),st(this,ct)&&setTimeout(nt(this,wt,vt).bind(this),0)}function gt(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,yt(t,e,"get"))}function ft(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,yt(t,e,"set"),i),i}function yt(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Et=new WeakMap,St=new WeakMap;const mt=class{constructor(){Et.set(this,{writable:!0,value:void 0}),St.set(this,{writable:!0,value:void 0}),ft(this,Et,new M),ft(this,St,{UP:"UP",RIGHT:"RIGHT",DOWN:"DOWN",LEFT:"LEFT",E:"E",ANY:"ANY"}),document.body.addEventListener("keydown",(t=>{37==t.keyCode&&gt(this,Et).dispatch(gt(this,St).LEFT),38==t.keyCode&&gt(this,Et).dispatch(gt(this,St).UP),39==t.keyCode&&gt(this,Et).dispatch(gt(this,St).RIGHT),40==t.keyCode&&gt(this,Et).dispatch(gt(this,St).DOWN),69==t.keyCode&&gt(this,Et).dispatch(gt(this,St).E),gt(this,Et).dispatch(gt(this,St).ANY)}))}onUp(t){gt(this,Et).registerHandler(gt(this,St).UP,t)}removeOnUp(t){gt(this,Et).deregisterHandler(gt(this,St).UP,t)}onRight(t){gt(this,Et).registerHandler(gt(this,St).RIGHT,t)}removeOnRight(t){gt(this,Et).deregisterHandler(gt(this,St).RIGHT,t)}onDown(t){gt(this,Et).registerHandler(gt(this,St).DOWN,t)}removeOnDown(t){gt(this,Et).deregisterHandler(gt(this,St).DOWN,t)}onLeft(t){gt(this,Et).registerHandler(gt(this,St).LEFT,t)}removeOnLeft(t){gt(this,Et).deregisterHandler(gt(this,St).LEFT,t)}onE(t){gt(this,Et).registerHandler(gt(this,St).E,t)}removeOnE(t){gt(this,Et).deregisterHandler(gt(this,St).E,t)}onAnyKey(t){gt(this,Et).registerHandler(gt(this,St).ANY,t)}removeOnAnyKey(t){gt(this,Et).deregisterHandler(gt(this,St).ANY,t)}};function Tt(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,kt(t,e,"get"))}function kt(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var bt=new WeakMap;const Ht=class{constructor(){var t,e;bt.set(this,{writable:!0,value:void 0}),e=[],function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t=this,kt(t,bt,"set"),e)}load(t,e,i=.5,s=!1){Tt(this,bt)[t]=new Audio(e),Tt(this,bt)[t].volume=i,Tt(this,bt)[t].loop=s}play(t){Tt(this,bt)[t].currentTime=0,Tt(this,bt)[t].play()}stop(t){Tt(this,bt)[t].currentTime=0,Tt(this,bt)[t].pause()}};function Wt(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}function Mt(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,xt(t,e,"get"))}function It(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,xt(t,e,"set"),i),i}function xt(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Nt=new WeakMap,Ot=new WeakMap,Pt=new WeakMap,Dt=new WeakMap,At=new WeakMap,Lt=new WeakMap,Ct=new WeakMap,Rt=new WeakMap,Gt=new WeakMap,Ut=new WeakMap,Bt=new WeakMap,Ft=new WeakMap,qt=new WeakSet,_t=new WeakSet;function Kt(){if(Mt(this,Gt)){const t=Mt(this,Bt),i=Mt(this,Ot).getDirection();Mt(this,Ot).move();let s=Mt(this,Ot).getHeadPosition();Mt(this,Ot).hasOverlapped()||!Wt(this,_t,zt).call(this,Mt(this,Ot),Mt(this,Dt))?(It(this,Gt,!1),this.end(t,i)):(e.isEqual(s,Mt(this,At))?(Mt(this,Ot).eat(),It(this,At,Mt(this,Dt).getRandomCoordinate(Mt(this,Ot).getPositions()))):Mt(this,Ot).pop(),It(this,Bt,Mt(this,Ot).getPositions()),It(this,Nt,Mt(this,Ot).getLength()-Mt(this,Pt)),Mt(this,Lt).dispatch(Mt(this,Ct).UPDATE,{currentSnakeDirection:Mt(this,Ot).getDirection(),currentSnakePositions:Mt(this,Ot).getPositions(),snakeLength:Mt(this,Ot).getLength(),bulges:Mt(this,Ot).getBulges(),applePosition:Mt(this,At),score:Mt(this,Nt)}))}}function zt(t,e){let i=t.getHeadPosition();return i.y>=0&&i.y<e.getRowCount()&&i.x>=0&&i.x<e.getColumnCount()}function jt(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}function Yt(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,Jt(t,e,"get"))}function $t(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Jt(t,e,"set"),i),i}function Jt(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Vt=new WeakMap,Qt=new WeakMap,Xt=new WeakSet,Zt=new WeakSet;function te(){window.localStorage.setItem(Yt(this,Vt),JSON.stringify(Yt(this,Qt)))}function ee(t,e){return t.value>e.value?-1:e.value>t.value||Date.parse(t.date)>Date.parse(e.date)?1:Date.parse(e.date)>Date.parse(t.date)?-1:0}function ie(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}function se(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,ae(t,e,"get"))}function ne(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,ae(t,e,"set"),i),i}function ae(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var re=new WeakMap,he=new WeakMap,oe=new WeakMap,le=new WeakMap,de=new WeakMap,ce=new WeakMap,ue=new WeakMap,pe=new WeakMap,we=new WeakMap,ve=new WeakMap,ge=new WeakMap,fe=new WeakSet,ye=new WeakSet,Ee=new WeakSet,Se=new WeakSet,me=new WeakSet,Te=new WeakSet,ke=new WeakSet,be=new WeakSet,He=new WeakSet;function We(){ie(this,Te,Oe).call(this,se(this,de)),ie(this,ke,Pe).call(this,se(this,ce)),ie(this,ke,Pe).call(this,se(this,ue)),ie(this,ke,Pe).call(this,se(this,pe));const t=se(this,de).querySelector("#high-scores-button"),e=se(this,de).querySelector("#start-button"),i=()=>{e.removeEventListener("click",i),ie(this,ye,Me).call(this)},s=()=>{t.removeEventListener("click",s),ie(this,Se,xe).call(this),se(this,oe).dispatch(se(this,le).SHOWHIGHSCORES)};e.addEventListener("click",i),t.addEventListener("click",s),se(this,oe).dispatch(se(this,le).MAINMENU)}function Me(){ie(this,Ee,Ie).call(this),se(this,oe).dispatch(se(this,le).INIT),ie(this,be,De).call(this,"Press any key to begin");const t=()=>{se(this,re).removeOnAnyKey(t),ie(this,He,Ae).call(this),se(this,oe).dispatch(se(this,le).STARTGAME)};se(this,re).onAnyKey(t)}function Ie(){ie(this,ke,Pe).call(this,se(this,de)),ie(this,Te,Oe).call(this,se(this,ce)),ie(this,ke,Pe).call(this,se(this,ue)),ie(this,ke,Pe).call(this,se(this,pe))}function xe(){ie(this,ke,Pe).call(this,se(this,de)),ie(this,ke,Pe).call(this,se(this,ce)),ie(this,Te,Oe).call(this,se(this,ue)),ie(this,ke,Pe).call(this,se(this,pe)),this.renderHighScores(se(this,he).getTopTen());const t=se(this,ue).querySelector("#back-button"),e=()=>{t.removeEventListener("click",e),ie(this,fe,We).call(this)};t.addEventListener("click",e)}function Ne(t){ie(this,ke,Pe).call(this,se(this,de)),ie(this,ke,Pe).call(this,se(this,ce)),ie(this,ke,Pe).call(this,se(this,ue)),ie(this,Te,Oe).call(this,se(this,pe));const e=se(this,pe).querySelector("#play-again-button"),i=se(this,pe).querySelector("#menu-button"),s=se(this,pe).querySelector("#submit-button"),n=se(this,pe).querySelector("#name"),a=e=>{e.preventDefault(),"string"==typeof n.value&&n.value.length>0?(s.removeEventListener("click",a),se(this,he).addHighScore(n.value,t),ie(this,Se,xe).call(this),se(this,oe).dispatch(se(this,le).SHOWHIGHSCORES)):alert("Please enter a name")},r=()=>{e.removeEventListener("click",r),ie(this,ye,Me).call(this)},h=()=>{i.removeEventListener("click",h),ie(this,fe,We).call(this)};e.addEventListener("click",r),i.addEventListener("click",h),s.addEventListener("click",a)}function Oe(t){t.classList.remove("hidden")}function Pe(t){t.classList.add("hidden")}function De(t){ie(this,Te,Oe).call(this,se(this,we)),se(this,ve).innerHTML=t}function Ae(){se(this,ve).innerHTML="",ie(this,ke,Pe).call(this,se(this,we))}const Le=new class{constructor(t,e=30){b.add(this),k.add(this),g.set(this,{writable:!0,value:void 0}),f.set(this,{writable:!0,value:void 0}),y.set(this,{writable:!0,value:void 0}),E.set(this,{writable:!0,value:void 0}),S.set(this,{writable:!0,value:void 0}),m.set(this,{writable:!0,value:void 0}),T.set(this,{writable:!0,value:void 0}),w(this,g,t),w(this,f,t.getContext("2d")),w(this,E,t.height),w(this,y,t.width),w(this,S,e),w(this,m,2),w(this,T,new class{constructor(t){d.set(this,{writable:!0,value:void 0}),c.set(this,{writable:!0,value:void 0}),o(this,d,document.createElement("img")),h(this,d).src=t,o(this,c,{})}addSprite(t,e,i,s,n){h(this,c)[t]={spriteSheet:h(this,d),x:e,y:i,width:s,height:n}}getSprite(t){return h(this,c)[t]}}("./images/snake-spritesheet.png")),p(this,b,W).call(this)}clear(){u(this,f).clearRect(0,0,u(this,g).width,u(this,g).height)}drawGrid(t){u(this,f).beginPath(),t.getGridCoordinates().forEach((t=>{u(this,f).beginPath(),u(this,f).fillStyle=t.y%2==t.x%2?"#ffffff":"#ced7dd ",u(this,f).rect(t.x*u(this,S),t.y*u(this,S),u(this,S),u(this,S)),u(this,f).fill(),u(this,f).closePath()})),u(this,f).closePath()}drawSnake(t,e){let s,a,r;u(this,f).beginPath();for(var h=1;h<t.length-1;h++)s=n(t[h-1],t[h],t[h+1]),a=`body-${s.toString().toLowerCase()}`,r=u(this,T).getSprite(a),r&&p(this,k,H).call(this,t[h],r);const o=`tail-${((t,e)=>{let s=i.UP;return t.x===e.x&&t.y<e.y?s=i.UP:t.x>e.x&&t.y===e.y?s=i.RIGHT:t.x<e.x&&t.y===e.y?s=i.LEFT:t.x===e.x&&t.y>e.y&&(s=i.DOWN),s})(t[t.length-1],t[t.length-2]).toString().toLowerCase()}`,l=u(this,T).getSprite(o);p(this,k,H).call(this,t[t.length-1],l);const d=`head-${e.toString().toLowerCase()}`,c=u(this,T).getSprite(d);p(this,k,H).call(this,t[0],c)}takeScreenshot(){return u(this,g).toDataURL("png")}drawApple(t){let{spriteSheet:e,x:i,y:s,width:n,height:a}=u(this,T).getSprite("apple");u(this,f).rect(t.x*u(this,S)+u(this,m),t.y*u(this,S)+u(this,m),u(this,S)-u(this,m),u(this,S)-u(this,m)),u(this,f).drawImage(e,i,s,n,a,t.x*u(this,S),t.y*u(this,S),u(this,S),u(this,S))}drawSnakeMouth(t,i){let s=a(i);const n=u(this,S)/2,r=e.multiplyScalar(s,n/1.5);u(this,f).beginPath(),u(this,f).arc(t.x*u(this,S)+n+r.x,t.y*u(this,S)+n+r.y,u(this,S)/3.5,0,2*Math.PI,!1),u(this,f).fillStyle="black",u(this,f).fill(),u(this,f).closePath()}drawBulges(t){if(Array.isArray(t)){const e=u(this,S)/2;t.forEach((({position:t,size:i})=>{u(this,f).beginPath(),u(this,f).arc(t.x*u(this,S)+e,t.y*u(this,S)+e,u(this,S)/1.5*i,0,2*Math.PI,!1),u(this,f).fillStyle="#5b7bf9",u(this,f).fill(),u(this,f).closePath()}))}}}(document.getElementById("canvas")),Ce=document.getElementById("intro-screen"),Re=document.getElementById("game-screen"),Ge=document.getElementById("high-score-screen"),Ue=document.getElementById("review-screen"),Be=new class{constructor(){_t.add(this),qt.add(this),Nt.set(this,{writable:!0,value:void 0}),Ot.set(this,{writable:!0,value:void 0}),Pt.set(this,{writable:!0,value:void 0}),Dt.set(this,{writable:!0,value:void 0}),At.set(this,{writable:!0,value:void 0}),Lt.set(this,{writable:!0,value:void 0}),Ct.set(this,{writable:!0,value:void 0}),Rt.set(this,{writable:!0,value:void 0}),Gt.set(this,{writable:!0,value:void 0}),Ut.set(this,{writable:!0,value:void 0}),Bt.set(this,{writable:!0,value:void 0}),Ft.set(this,{writable:!0,value:void 0}),It(this,Pt,6),It(this,Dt,new class{constructor(t=0,e=0){tt.set(this,{writable:!0,value:void 0}),et.set(this,{writable:!0,value:void 0}),it.set(this,{writable:!0,value:void 0}),X(this,et,t),X(this,it,e),X(this,tt,new Array(Q(this,et)*Q(this,it)))}getCenter(){return new e(Q(this,et)/2-1,Q(this,it)/2-1)}getColumnCount(){return Q(this,et)}getRowCount(){return Q(this,it)}getGrid(){return Q(this,tt)}getGridCoordinate(t){return new e(t%Q(this,et),Math.floor(t/Q(this,it)))}getIndex(t,e){return e*Q(this,et)+t}getGridCoordinates(){return[...this.getGrid().keys()].map(((t,e)=>this.getGridCoordinate(e)))}getRandomIndex(t=[]){const e=[...this.getGrid().keys()].map(((t,e)=>e)).filter((e=>!t.includes(e)));return e[Math.floor(Math.random()*e.length)]}getRandomCoordinate(t=[]){const e=t.map((t=>this.getIndex(t.x,t.y))),i=this.getRandomIndex(e);return this.getGridCoordinate(i)}}(20,20)),It(this,Ot,new class{constructor(t,e=5,i=r.UP){B.set(this,{writable:!0,value:void 0}),F.set(this,{writable:!0,value:void 0}),q.set(this,{writable:!0,value:void 0}),_.set(this,{writable:!0,value:void 0}),K.set(this,{writable:!0,value:void 0}),z.set(this,{writable:!0,value:void 0}),j.set(this,{writable:!0,value:void 0}),Y.set(this,{writable:!0,value:void 0}),$.set(this,{writable:!0,value:void 0}),G(this,F,i),G(this,q,i),G(this,z,t),G(this,j,i),G(this,Y,e),G(this,_,new M),G(this,K,{EAT:"EAT",CHANGEDIRECTION:"CHANGEDIRECTION"}),this.init()}init(){const t=s(R(this,j)),i=a(t);let n;G(this,B,new class{constructor(){O.add(this),function(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}(this,O,P).call(this)}push(t){const e=new L(t);return this.head?(this.tail.setNext(e),this.tail=e):(this.head=e,this.tail=this.head),this.length+=1,this}pop(){if(0===this.length)return;let t=this.head,e=t;for(;t.next();)e=t,t=t.next();return this.tail=e,this.tail.setNext(null),this.length-=1,t}unshift(t){const e=new L(t);return this.head?(e.setNext(this.head),this.head=e):(this.head=e,this.tail=this.head),this.length+=1,this}}),R(this,B).push(new J(R(this,z)));for(let t=1;t<R(this,Y);t++)n=e.multiplyScalar(i,t),R(this,B).push(new J(e.add(R(this,z),n)));G(this,F,R(this,j)),G(this,$,[])}changeDirection(t){const e=s(R(this,F));(t=>Object.keys(i).includes(t))(t)&&t!==e&&G(this,q,t),R(this,F)!=t&&R(this,_).dispatch(R(this,K).CHANGEDIRECTION,t)}move(){let t=R(this,B).head;const i=a(R(this,q));let s=t.value().position,n=e.add(s,i);R(this,B).unshift({position:n}),G(this,F,R(this,q)),R(this,$).filter((t=>!t.isAvailable)).forEach((t=>{t.step(R(this,B).head,R(this,B).length),t.step(R(this,B).head,R(this,B).length)}))}eat(){R(this,_).dispatch(R(this,K).EAT,R(this,B).length);const t=R(this,$).filter((t=>t.isAvailable));if(t.length>0)t[0].start(R(this,B).head);else{const t=new V;t.start(R(this,B).head),R(this,$).push(t)}}pop(){R(this,B).pop()}resetHandlers(){R(this,_).reset()}getBody(){return R(this,B)}getLength(){return R(this,B).length}getDirection(){return R(this,F)}getNextDirection(){return R(this,q)}getPositions(){const t=[];let e=R(this,B).head,i=0;for(;i<R(this,B).length;)t.push(e.value().position.get()),e=e.next(),i++;return t}getBodyPositions(){const t=this.getPositions();return t.shift(),t}getBulges(){return R(this,$).filter((t=>!t.isAvailable)).map((t=>({position:t.getPosition(),size:t.size})))}getHeadPosition(){return R(this,B).head.value().position}setHeadPosition(t){R(this,B).head.setValue(new J(t))}hasOverlapped(){const t=this.getPositions();return t.shift(),t.filter((t=>e.isEqual(t,R(this,B).head.value().position))).length>0}onEat(t){R(this,_).registerHandler(R(this,K).EAT,t)}removeOnEat(t){R(this,_).deregisterHandler(R(this,K).EAT,t)}onChangeDirection(t){R(this,_).registerHandler(R(this,K).CHANGEDIRECTION,t)}removeOnChangeDirection(t){R(this,_).deregisterHandler(R(this,K).CHANGEDIRECTION,t)}}(Mt(this,Dt).getCenter(),Mt(this,Pt),r.UP)),It(this,Rt,new class{constructor(){wt.add(this),ht.set(this,{writable:!0,value:void 0}),ot.set(this,{writable:!0,value:void 0}),lt.set(this,{writable:!0,value:void 0}),dt.set(this,{writable:!0,value:void 0}),ct.set(this,{writable:!0,value:void 0}),ut.set(this,{writable:!0,value:void 0}),pt.set(this,{writable:!0,value:void 0}),at(this,ut,new M),at(this,pt,{TICK:"TICK",ELAPSED:"ELAPSED"})}start(t){at(this,lt,0),at(this,ot,performance.now()),at(this,dt,t),at(this,ct,!0),window.requestAnimationFrame(nt(this,wt,vt).bind(this))}reset(){at(this,lt,0),at(this,ot,performance.now())}stop(){at(this,ct,!1)}hasElapsed(){return st(this,ht)}tick(){st(this,ct)&&(st(this,ut).dispatch(st(this,pt).TICK,st(this,lt)/st(this,dt)),at(this,lt,performance.now()-st(this,ot)),at(this,ht,st(this,lt)>st(this,dt)),this.hasElapsed()&&(st(this,ut).dispatch(st(this,pt).ELAPSED),this.reset()))}clearHandlers(){st(this,ut).reset()}onTick(t){st(this,ut).registerHandler(st(this,pt).TICK,t)}removeOnTick(t){st(this,ut).deregisterHandler(st(this,pt).TICK,t)}onElapsed(t){st(this,ut).registerHandler(st(this,pt).ELAPSED,t)}removeOnElapsed(t){st(this,ut).deregisterHandler(st(this,pt).ELAPSED,t)}}),It(this,Lt,new M),It(this,Gt,!1),It(this,Ut,150),It(this,Bt,[]),It(this,Ft,new Ht),It(this,Ct,{INIT:"INIT",START:"START",END:"END",PAUSE:"PAUSE",RESET:"RESET",UPDATE:"UPDATE",TICK:"TICK"}),Object.freeze(Mt(this,Ct));const t=new mt;t.onUp((()=>Mt(this,Ot).changeDirection(r.UP))),t.onRight((()=>Mt(this,Ot).changeDirection(r.RIGHT))),t.onDown((()=>Mt(this,Ot).changeDirection(r.DOWN))),t.onLeft((()=>Mt(this,Ot).changeDirection(r.LEFT))),Mt(this,Ft).load("eat","../audio/eat.wav",.8),Mt(this,Ft).load("up","../audio/wo.wav"),Mt(this,Ft).load("right","../audio/we.wav"),Mt(this,Ft).load("down","../audio/wa.wav"),Mt(this,Ft).load("left","../audio/wu.wav"),Mt(this,Ft).load("bg","../audio/Monkeys-Spinning-Monkeys.mp3",.3,!0),Mt(this,Ft).load("cheering","../audio/cheering.wav",.3,!1)}init(){It(this,Gt,!1),Mt(this,Rt).stop(),Mt(this,Rt).clearHandlers(),Mt(this,Rt).onElapsed(Wt(this,qt,Kt).bind(this)),It(this,Nt,0),It(this,At,Mt(this,Dt).getRandomCoordinate(Mt(this,Ot).getPositions())),Mt(this,Ot).init(),Mt(this,Ft).play("bg");const t=t=>{It(this,Nt,t-Mt(this,Pt)),Mt(this,Ft).play("eat")},e=t=>{Mt(this,Ft).play(t.toString().toLowerCase())};Mt(this,Ot).removeOnEat(t),Mt(this,Ot).onEat(t),Mt(this,Ot).removeOnChangeDirection(e),Mt(this,Ot).onChangeDirection(e),Mt(this,Lt).dispatch(Mt(this,Ct).UPDATE,{currentSnakeDirection:Mt(this,Ot).getDirection(),currentSnakePositions:Mt(this,Ot).getPositions(),snakeLength:Mt(this,Ot).getLength(),bulges:Mt(this,Ot).getBulges(),applePosition:Mt(this,At),score:Mt(this,Nt)})}start(){It(this,Gt,!0),Mt(this,Rt).start(Mt(this,Ut))}end(t,e){Mt(this,Rt).stop(),Mt(this,Rt).removeOnElapsed(Wt(this,qt,Kt)),Mt(this,Ot).resetHandlers(),Mt(this,Ft).stop("bg"),Mt(this,Ft).play("cheering"),Mt(this,Lt).dispatch(Mt(this,Ct).END,{currentSnakeDirection:e,currentSnakePositions:t,snakeLength:Mt(this,Ot).getLength(),bulges:Mt(this,Ot).getBulges(),applePosition:Mt(this,At),score:Mt(this,Nt),grid:Mt(this,Dt)})}onUpdate(t){Mt(this,Lt).registerHandler(Mt(this,Ct).UPDATE,t)}removeOnUpdate(t){Mt(this,Lt).deregisterHandler(Mt(this,Ct).UPDATE,t)}onInit(t){Mt(this,Lt).registerHandler(Mt(this,Ct).INIT,t)}removeOnInit(t){Mt(this,Lt).deregisterHandler(Mt(this,Ct).INIT,t)}onEnd(t){Mt(this,Lt).registerHandler(Mt(this,Ct).END,t)}removeOnEnd(t){Mt(this,Lt).deregisterHandler(Mt(this,Ct).END,t)}},Fe=new Ht;Fe.load("menu-bg","./audio/Komiku_-_12_-_Bicycle.mp3",.5,!0);const qe=new class{constructor(t,e,i,s){He.add(this),be.add(this),ke.add(this),Te.add(this),me.add(this),Se.add(this),Ee.add(this),ye.add(this),fe.add(this),re.set(this,{writable:!0,value:void 0}),he.set(this,{writable:!0,value:void 0}),oe.set(this,{writable:!0,value:void 0}),le.set(this,{writable:!0,value:void 0}),de.set(this,{writable:!0,value:void 0}),ce.set(this,{writable:!0,value:void 0}),ue.set(this,{writable:!0,value:void 0}),pe.set(this,{writable:!0,value:void 0}),we.set(this,{writable:!0,value:void 0}),ve.set(this,{writable:!0,value:void 0}),ge.set(this,{writable:!0,value:void 0}),ne(this,re,new mt),ne(this,oe,new M),ne(this,he,new class{constructor(t){Zt.add(this),Xt.add(this),Vt.set(this,{writable:!0,value:void 0}),Qt.set(this,{writable:!0,value:void 0}),$t(this,Vt,t),$t(this,Qt,[]);let e=window.localStorage.getItem(t);if("string"==typeof e){let t=JSON.parse(e);Array.isArray(t)&&$t(this,Qt,[...t])}}getHighScores(){return Yt(this,Qt)}addHighScore(t,e){Yt(this,Qt).push({name:t,value:e,date:(new Date).toISOString()}),jt(this,Xt,te).call(this)}getTopTen(){return Yt(this,Qt).sort(jt(this,Zt,ee)).filter(((t,e)=>e<10))}}("jm-snake")),ne(this,le,{INIT:"INIT",MAINMENU:"MAINMENU",STARTGAME:"STARTGAME",SUBMITSCORE:"SUBMITSCORE",SHOWHIGHSCORES:"SHOWHIGHSCORES"}),Object.freeze(se(this,le)),ne(this,de,t),ne(this,ce,e),ne(this,ue,i),ne(this,pe,s),ne(this,ge,document.body.querySelectorAll(".score")),ne(this,we,document.getElementById("prompt")),ne(this,ve,document.getElementById("prompt-text")),ie(this,He,Ae).call(this),ie(this,fe,We).call(this)}updateScore(t){for(var e=0;e<se(this,ge).length;e++)se(this,ge)[e].innerHTML=t}goToReview(t,e){ie(this,me,Ne).call(this,e),se(this,pe).querySelector("img").src=t,this.updateScore(e)}renderHighScores(t){const e=se(this,ue).querySelector("#high-scores"),i=se(this,ue).querySelector("#high-scores-message");ie(this,Te,Oe).call(this,e),ie(this,ke,Pe).call(this,i),0===t.length&&ie(this,Te,Oe).call(this,i);let s=['<li><h3>name</h3><h3>#<span class="apple-icon"></span></h3></li>'];for(let e=0;e<10;e++)e<t.length?s.push(`<li><div>${t[e].name}</div><div>${t[e].value}</div></li>`):s.push("<li><div></div><div></div></li>");e.innerHTML=s.join("")}onInitGame(t){se(this,oe).registerHandler(se(this,le).INIT,t)}removeonInitGame(t){se(this,oe).deregisterHandler(se(this,le).INIT,t)}onStartGame(t){se(this,oe).registerHandler(se(this,le).STARTGAME,t)}removeOnStartGame(t){se(this,oe).deregisterHandler(se(this,le).STARTGAME,t)}onSubmitHighScores(t){se(this,oe).registerHandler(se(this,le).SUBMITSCORE,t)}removeOnSubmitHighScores(t){se(this,oe).deregisterHandler(se(this,le).SUBMITSCORE,t)}onShowHighScores(t){se(this,oe).registerHandler(se(this,le).SHOWHIGHSCORES,t)}removeOnShowHighScores(t){se(this,oe).deregisterHandler(se(this,le).SHOWHIGHSCORES,t)}onMainMenu(t){se(this,oe).registerHandler(se(this,le).MAINMENU,t)}removeOnMainMenu(t){se(this,oe).deregisterHandler(se(this,le).MAINMENU,t)}}(Ce,Re,Ge,Ue);qe.onMainMenu((()=>{Fe.play("menu-bg")})),qe.onInitGame((()=>{Fe.stop("menu-bg"),Be.init()})),qe.onStartGame((()=>{Be.start()}));const _e=({currentSnakePositions:t,currentSnakeDirection:i,snakeLength:s,bulges:n,applePosition:a,score:r})=>{const h=e.distance(t[0],a);Le.clear(),Le.drawBulges(n),Le.drawSnake(t,i,s),h<2&&Le.drawSnakeMouth(t[0],i),Le.drawApple(a),qe.updateScore(r)};Be.onInit(_e),Be.onUpdate(_e),Be.onEnd((({currentSnakePositions:t,currentSnakeDirection:e,snakeLength:i,applePosition:s,score:n,grid:a})=>{Le.clear(),Le.drawGrid(a),Le.drawSnake(t,e,i),Le.drawApple(s);const r=Le.takeScreenshot();qe.goToReview(r,n)}))})();
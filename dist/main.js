(()=>{"use strict";class t{constructor(t,e){this.x=t,this.y=e}add(t){this.x+=t.x,this.y+=t.y}multiplyScalar(t){return this.x*=t,this.y*=t,this}get(){return{x:this.x,y:this.y}}clone(){return new t(this.x,this.y)}static add(e,i){return new t(e.x+i.x,e.y+i.y)}static distance(t,e){const i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}static isEqual(t,e){return t.x===e.x&&t.y===e.y}static multiplyScalar(t,e){let i=t.clone();return i.x*=e,i.y*=e,i}}const e=t,i={NONE:"NONE",UP:"UP",RIGHT:"RIGHT",DOWN:"DOWN",LEFT:"LEFT",LEFTDOWN:"LEFTDOWN",LEFTUP:"LEFTUP",RIGHTDOWN:"RIGHTDOWN",RIGHTUP:"RIGHTUP"};Object.freeze(i);const s=t=>{switch(t){case i.UP:return i.DOWN;case i.RIGHT:return i.LEFT;case i.DOWN:return i.UP;case i.LEFT:return i.RIGHT}},n=(t,e,s)=>{let n=i.NONE;return t.y<e.y&&e.y<s.y?n=i.UP:t.x>e.x&&e.x>s.x?n=i.RIGHT:t.x>e.x&&e.y<s.y||t.y>e.y&&e.x<s.x?n=i.RIGHTDOWN:t.x>e.x&&e.y>s.y||t.y<e.y&&e.x<s.x?n=i.RIGHTUP:t.x<e.x&&e.x<s.x?n=i.LEFT:t.x<e.x&&e.y>s.y||t.y<e.y&&e.x>s.x?n=i.LEFTUP:t.x<e.x&&e.y<s.y||t.y>e.y&&e.x>s.x?n=i.LEFTDOWN:t.y>e.y&&e.y>s.y&&(n=i.DOWN),n},a=t=>{switch(t){case i.UP:return new e(0,-1);case i.RIGHT:return new e(1,0);case i.DOWN:return new e(0,1);case i.LEFT:return new e(-1,0)}},h=i;function r(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,l(t,e,"get"))}function o(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,l(t,e,"set"),i),i}function l(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var d=new WeakMap,c=new WeakMap;function u(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,v(t,e,"get"))}function p(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}function w(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,v(t,e,"set"),i),i}function v(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var g=new WeakMap,f=new WeakMap,y=new WeakMap,E=new WeakMap,S=new WeakMap,T=new WeakMap,m=new WeakMap,k=new WeakSet,b=new WeakSet;function W(t,{spriteSheet:e,x:i,y:s,width:n,height:a}){u(this,f).drawImage(e,i,s,n,a,t.x*u(this,S),t.y*u(this,S),u(this,S),u(this,S))}function H(){u(this,m).addSprite("apple",0,0,40,40),u(this,m).addSprite("head-up",120,40,40,40),u(this,m).addSprite("head-right",120,0,40,40),u(this,m).addSprite("head-down",40,80,40,40),u(this,m).addSprite("head-left",80,80,40,40),u(this,m).addSprite("body-up",0,80,40,40),u(this,m).addSprite("body-right",0,40,40,40),u(this,m).addSprite("body-leftdown",40,0,40,40),u(this,m).addSprite("body-leftup",40,40,40,40),u(this,m).addSprite("body-down",0,80,40,40),u(this,m).addSprite("body-left",0,40,40,40),u(this,m).addSprite("body-rightdown",80,0,40,40),u(this,m).addSprite("body-rightup",80,40,40,40),u(this,m).addSprite("tail-down",120,80,40,40),u(this,m).addSprite("tail-left",0,120,40,40),u(this,m).addSprite("tail-up",80,120,40,40),u(this,m).addSprite("tail-right",40,120,40,40)}const M=class{constructor(){this._events=[]}addEvent(t){void 0===this._events[t]&&(this._events[t]=[])}clearEvent(t){this._events[t]=[]}reset(){this._events=[]}registerHandler(t,e){this.addEvent(t),this._events[t].push(e)}deregisterHandler(t,e){if(!Object.keys(this._events).includes(t))return;let i=this._events[t].indexOf(e);-1!==i&&this._events[t].splice(i,1)}dispatch(t,e){if(void 0!==this._events[t])for(let i=0;i<this._events[t].length;i++)this._events[t][i](e)}};function I(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,N(t,e,"get"))}function x(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,N(t,e,"set"),i),i}function N(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var O=new WeakSet;function P(){this.head=null,this.tail=null,this.length=0}var D=new WeakMap,A=new WeakMap;class L{constructor(t){D.set(this,{writable:!0,value:void 0}),A.set(this,{writable:!0,value:void 0}),x(this,D,null),x(this,A,t)}value(){return I(this,A)}next(){return I(this,D)}setNext(t){x(this,D,t)}setValue(t){x(this,A,t)}}function R(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function C(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,U(t,e,"get"))}function G(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,U(t,e,"set"),i),i}function U(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var _=new WeakMap,F=new WeakMap,B=new WeakMap,K=new WeakMap,q=new WeakMap,Y=new WeakMap,z=new WeakMap,j=new WeakMap,$=new WeakMap;class J{constructor(t){this.position=t}}class V{constructor(){R(this,"initialNode",void 0),R(this,"currentNode",void 0),this.index=0,this.size=0,this.isAvailable=!0}start(t){this.index=0,this.isAvailable=!1,this.currentNode=t}step(t,e){this.size=(e-this.index)/e/2+.5;let i=t;for(let t=0;t<this.index;t++)i.next()&&(i=i.next());this.currentNode=i,this.index++,this.index>=e&&this.reset()}reset(){this.isAvailable=!0,this.size=0,this.index=0}getPosition(){return this.currentNode.value().position}}function Q(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,Z(t,e,"get"))}function X(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Z(t,e,"set"),i),i}function Z(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var tt=new WeakMap,et=new WeakMap,it=new WeakMap;function st(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,ht(t,e,"get"))}function nt(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}function at(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,ht(t,e,"set"),i),i}function ht(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var rt=new WeakMap,ot=new WeakMap,lt=new WeakMap,dt=new WeakMap,ct=new WeakMap,ut=new WeakMap,pt=new WeakMap,wt=new WeakSet;function vt(){this.tick(),st(this,ct)&&setTimeout(nt(this,wt,vt).bind(this),0)}function gt(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,yt(t,e,"get"))}function ft(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,yt(t,e,"set"),i),i}function yt(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Et=new WeakMap,St=new WeakMap,Tt=new WeakMap,mt=new WeakMap;const kt=class{constructor(){Et.set(this,{writable:!0,value:void 0}),St.set(this,{writable:!0,value:void 0}),Tt.set(this,{writable:!0,value:void 0}),mt.set(this,{writable:!0,value:void 0}),ft(this,Et,new M),ft(this,St,{UP:"UP",RIGHT:"RIGHT",DOWN:"DOWN",LEFT:"LEFT",E:"E",ANY:"ANY"}),ft(this,Tt,[]),ft(this,mt,{KEY_UP:38,KEY_DOWN:40,KEY_LEFT:37,KEY_RIGHT:39});const t=t=>{gt(this,Tt)[t.keyCode]="keydown"==t.type,gt(this,Et).dispatch(gt(this,St).ANY)};window.addEventListener("keydown",t),window.addEventListener("keyup",t)}update(){gt(this,Tt)[gt(this,mt).KEY_LEFT]&&gt(this,Et).dispatch(gt(this,St).LEFT),gt(this,Tt)[gt(this,mt).KEY_UP]&&gt(this,Et).dispatch(gt(this,St).UP),gt(this,Tt)[gt(this,mt).KEY_RIGHT]&&gt(this,Et).dispatch(gt(this,St).RIGHT),gt(this,Tt)[gt(this,mt).KEY_DOWN]&&gt(this,Et).dispatch(gt(this,St).DOWN)}onUp(t){gt(this,Et).registerHandler(gt(this,St).UP,t)}removeOnUp(t){gt(this,Et).deregisterHandler(gt(this,St).UP,t)}onRight(t){gt(this,Et).registerHandler(gt(this,St).RIGHT,t)}removeOnRight(t){gt(this,Et).deregisterHandler(gt(this,St).RIGHT,t)}onDown(t){gt(this,Et).registerHandler(gt(this,St).DOWN,t)}removeOnDown(t){gt(this,Et).deregisterHandler(gt(this,St).DOWN,t)}onLeft(t){gt(this,Et).registerHandler(gt(this,St).LEFT,t)}removeOnLeft(t){gt(this,Et).deregisterHandler(gt(this,St).LEFT,t)}onAnyKey(t){gt(this,Et).registerHandler(gt(this,St).ANY,t)}removeOnAnyKey(t){gt(this,Et).deregisterHandler(gt(this,St).ANY,t)}};function bt(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,Wt(t,e,"get"))}function Wt(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Ht=new WeakMap;const Mt=class{constructor(){var t,e;Ht.set(this,{writable:!0,value:void 0}),e=[],function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t=this,Wt(t,Ht,"set"),e)}load(t,e,i=.5,s=!1){bt(this,Ht)[t]=new Audio(e),bt(this,Ht)[t].volume=i,bt(this,Ht)[t].loop=s}play(t){bt(this,Ht)[t].currentTime=0,bt(this,Ht)[t].play()}stop(t){bt(this,Ht)[t].currentTime=0,bt(this,Ht)[t].pause()}};function It(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}function xt(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,Ot(t,e,"get"))}function Nt(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Ot(t,e,"set"),i),i}function Ot(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Pt=new WeakMap,Dt=new WeakMap,At=new WeakMap,Lt=new WeakMap,Rt=new WeakMap,Ct=new WeakMap,Gt=new WeakMap,Ut=new WeakMap,_t=new WeakMap,Ft=new WeakMap,Bt=new WeakMap,Kt=new WeakMap,qt=new WeakMap,Yt=new WeakSet,zt=new WeakSet;function jt(){if(xt(this,qt).update(),xt(this,_t)){const t=xt(this,Bt),i=xt(this,Dt).getDirection();xt(this,Dt).move();let s=xt(this,Dt).getHeadPosition();xt(this,Dt).hasOverlapped()||!It(this,zt,$t).call(this,xt(this,Dt),xt(this,Lt))?(Nt(this,_t,!1),this.end(t,i)):(e.isEqual(s,xt(this,Rt))?(xt(this,Dt).eat(),Nt(this,Rt,xt(this,Lt).getRandomCoordinate(xt(this,Dt).getPositions()))):xt(this,Dt).pop(),Nt(this,Bt,xt(this,Dt).getPositions()),Nt(this,Pt,xt(this,Dt).getLength()-xt(this,At)),xt(this,Ct).dispatch(xt(this,Gt).UPDATE,{currentSnakeDirection:xt(this,Dt).getDirection(),currentSnakePositions:xt(this,Dt).getPositions(),snakeLength:xt(this,Dt).getLength(),bulges:xt(this,Dt).getBulges(),applePosition:xt(this,Rt),score:xt(this,Pt)}))}}function $t(t,e){let i=t.getHeadPosition();return i.y>=0&&i.y<e.getRowCount()&&i.x>=0&&i.x<e.getColumnCount()}function Jt(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}function Vt(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,Xt(t,e,"get"))}function Qt(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Xt(t,e,"set"),i),i}function Xt(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Zt=new WeakMap,te=new WeakMap,ee=new WeakSet,ie=new WeakSet;function se(){window.localStorage.setItem(Vt(this,Zt),JSON.stringify(Vt(this,te)))}function ne(t,e){return t.value>e.value?-1:e.value>t.value||Date.parse(t.date)>Date.parse(e.date)?1:Date.parse(e.date)>Date.parse(t.date)?-1:0}function ae(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}function he(t,e){return function(t,e){return e.get?e.get.call(t):e.value}(t,oe(t,e,"get"))}function re(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,oe(t,e,"set"),i),i}function oe(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var le=new WeakMap,de=new WeakMap,ce=new WeakMap,ue=new WeakMap,pe=new WeakMap,we=new WeakMap,ve=new WeakMap,ge=new WeakMap,fe=new WeakMap,ye=new WeakMap,Ee=new WeakMap,Se=new WeakSet,Te=new WeakSet,me=new WeakSet,ke=new WeakSet,be=new WeakSet,We=new WeakSet,He=new WeakSet,Me=new WeakSet,Ie=new WeakSet;function xe(){ae(this,We,Ae).call(this,he(this,pe)),ae(this,He,Le).call(this,he(this,we)),ae(this,He,Le).call(this,he(this,ve)),ae(this,He,Le).call(this,he(this,ge));const t=he(this,pe).querySelector("#high-scores-button"),e=he(this,pe).querySelector("#start-button"),i=()=>{e.removeEventListener("click",i),ae(this,Te,Ne).call(this)},s=()=>{t.removeEventListener("click",s),ae(this,ke,Pe).call(this),he(this,ce).dispatch(he(this,ue).SHOWHIGHSCORES)};e.addEventListener("click",i),t.addEventListener("click",s),he(this,ce).dispatch(he(this,ue).MAINMENU)}function Ne(){ae(this,me,Oe).call(this),he(this,ce).dispatch(he(this,ue).INIT),ae(this,Me,Re).call(this,"Press any key to begin");const t=()=>{he(this,le).removeOnAnyKey(t),ae(this,Ie,Ce).call(this),he(this,ce).dispatch(he(this,ue).STARTGAME)};he(this,le).onAnyKey(t)}function Oe(){ae(this,He,Le).call(this,he(this,pe)),ae(this,We,Ae).call(this,he(this,we)),ae(this,He,Le).call(this,he(this,ve)),ae(this,He,Le).call(this,he(this,ge))}function Pe(){ae(this,He,Le).call(this,he(this,pe)),ae(this,He,Le).call(this,he(this,we)),ae(this,We,Ae).call(this,he(this,ve)),ae(this,He,Le).call(this,he(this,ge)),this.renderHighScores(he(this,de).getTopTen());const t=he(this,ve).querySelector("#back-button"),e=()=>{t.removeEventListener("click",e),ae(this,Se,xe).call(this)};t.addEventListener("click",e)}function De(t){ae(this,He,Le).call(this,he(this,pe)),ae(this,He,Le).call(this,he(this,we)),ae(this,He,Le).call(this,he(this,ve)),ae(this,We,Ae).call(this,he(this,ge));const e=he(this,ge).querySelector("#play-again-button"),i=he(this,ge).querySelector("#menu-button"),s=he(this,ge).querySelector("#submit-button"),n=he(this,ge).querySelector("#name"),a=e=>{e.preventDefault(),"string"==typeof n.value&&n.value.length>0?(s.removeEventListener("click",a),he(this,de).addHighScore(n.value,t),ae(this,ke,Pe).call(this),he(this,ce).dispatch(he(this,ue).SHOWHIGHSCORES)):alert("Please enter a name")},h=()=>{e.removeEventListener("click",h),ae(this,Te,Ne).call(this)},r=()=>{i.removeEventListener("click",r),ae(this,Se,xe).call(this)};e.addEventListener("click",h),i.addEventListener("click",r),s.addEventListener("click",a)}function Ae(t){t.classList.remove("hidden")}function Le(t){t.classList.add("hidden")}function Re(t){ae(this,We,Ae).call(this,he(this,fe)),he(this,ye).innerHTML=t}function Ce(){he(this,ye).innerHTML="",ae(this,He,Le).call(this,he(this,fe))}const Ge=new class{constructor(t,e=30){b.add(this),k.add(this),g.set(this,{writable:!0,value:void 0}),f.set(this,{writable:!0,value:void 0}),y.set(this,{writable:!0,value:void 0}),E.set(this,{writable:!0,value:void 0}),S.set(this,{writable:!0,value:void 0}),T.set(this,{writable:!0,value:void 0}),m.set(this,{writable:!0,value:void 0}),w(this,g,t),w(this,f,t.getContext("2d")),w(this,E,t.height),w(this,y,t.width),w(this,S,e),w(this,T,2),w(this,m,new class{constructor(t){d.set(this,{writable:!0,value:void 0}),c.set(this,{writable:!0,value:void 0}),o(this,d,document.createElement("img")),r(this,d).src=t,o(this,c,{})}addSprite(t,e,i,s,n){r(this,c)[t]={spriteSheet:r(this,d),x:e,y:i,width:s,height:n}}getSprite(t){return r(this,c)[t]}}("./images/snake-spritesheet.png")),p(this,b,H).call(this)}clear(){u(this,f).clearRect(0,0,u(this,g).width,u(this,g).height)}drawGrid(t){u(this,f).beginPath(),t.getGridCoordinates().forEach((t=>{u(this,f).beginPath(),u(this,f).fillStyle=t.y%2==t.x%2?"#ffffff":"#ced7dd ",u(this,f).rect(t.x*u(this,S),t.y*u(this,S),u(this,S),u(this,S)),u(this,f).fill(),u(this,f).closePath()})),u(this,f).closePath()}drawSnake(t,e){let s,a,h;u(this,f).beginPath();for(var r=1;r<t.length-1;r++)s=n(t[r-1],t[r],t[r+1]),a=`body-${s.toString().toLowerCase()}`,h=u(this,m).getSprite(a),h&&p(this,k,W).call(this,t[r],h);const o=`tail-${((t,e)=>{let s=i.UP;return t.x===e.x&&t.y<e.y?s=i.UP:t.x>e.x&&t.y===e.y?s=i.RIGHT:t.x<e.x&&t.y===e.y?s=i.LEFT:t.x===e.x&&t.y>e.y&&(s=i.DOWN),s})(t[t.length-1],t[t.length-2]).toString().toLowerCase()}`,l=u(this,m).getSprite(o);p(this,k,W).call(this,t[t.length-1],l);const d=`head-${e.toString().toLowerCase()}`,c=u(this,m).getSprite(d);p(this,k,W).call(this,t[0],c)}takeScreenshot(){return u(this,g).toDataURL("png")}drawApple(t){let{spriteSheet:e,x:i,y:s,width:n,height:a}=u(this,m).getSprite("apple");u(this,f).rect(t.x*u(this,S)+u(this,T),t.y*u(this,S)+u(this,T),u(this,S)-u(this,T),u(this,S)-u(this,T)),u(this,f).drawImage(e,i,s,n,a,t.x*u(this,S),t.y*u(this,S),u(this,S),u(this,S))}drawSnakeMouth(t,i){let s=a(i);const n=u(this,S)/2,h=e.multiplyScalar(s,n/1.5);u(this,f).beginPath(),u(this,f).arc(t.x*u(this,S)+n+h.x,t.y*u(this,S)+n+h.y,u(this,S)/3.5,0,2*Math.PI,!1),u(this,f).fillStyle="black",u(this,f).fill(),u(this,f).closePath()}drawBulges(t){if(Array.isArray(t)){const e=u(this,S)/2;t.forEach((({position:t,size:i})=>{u(this,f).beginPath(),u(this,f).arc(t.x*u(this,S)+e,t.y*u(this,S)+e,u(this,S)/1.5*i,0,2*Math.PI,!1),u(this,f).fillStyle="#5b7bf9",u(this,f).fill(),u(this,f).closePath()}))}}}(document.getElementById("canvas")),Ue=document.getElementById("intro-screen"),_e=document.getElementById("game-screen"),Fe=document.getElementById("high-score-screen"),Be=document.getElementById("review-screen"),Ke=new class{constructor(){zt.add(this),Yt.add(this),Pt.set(this,{writable:!0,value:void 0}),Dt.set(this,{writable:!0,value:void 0}),At.set(this,{writable:!0,value:void 0}),Lt.set(this,{writable:!0,value:void 0}),Rt.set(this,{writable:!0,value:void 0}),Ct.set(this,{writable:!0,value:void 0}),Gt.set(this,{writable:!0,value:void 0}),Ut.set(this,{writable:!0,value:void 0}),_t.set(this,{writable:!0,value:void 0}),Ft.set(this,{writable:!0,value:void 0}),Bt.set(this,{writable:!0,value:void 0}),Kt.set(this,{writable:!0,value:void 0}),qt.set(this,{writable:!0,value:void 0}),Nt(this,At,6),Nt(this,Lt,new class{constructor(t=0,e=0){tt.set(this,{writable:!0,value:void 0}),et.set(this,{writable:!0,value:void 0}),it.set(this,{writable:!0,value:void 0}),X(this,et,t),X(this,it,e),X(this,tt,new Array(Q(this,et)*Q(this,it)))}getCenter(){return new e(Q(this,et)/2-1,Q(this,it)/2-1)}getColumnCount(){return Q(this,et)}getRowCount(){return Q(this,it)}getGrid(){return Q(this,tt)}getGridCoordinate(t){return new e(t%Q(this,et),Math.floor(t/Q(this,it)))}getIndex(t,e){return e*Q(this,et)+t}getGridCoordinates(){return[...this.getGrid().keys()].map(((t,e)=>this.getGridCoordinate(e)))}getRandomIndex(t=[]){const e=[...this.getGrid().keys()].map(((t,e)=>e)).filter((e=>!t.includes(e)));return e[Math.floor(Math.random()*e.length)]}getRandomCoordinate(t=[]){const e=t.map((t=>this.getIndex(t.x,t.y))),i=this.getRandomIndex(e);return this.getGridCoordinate(i)}}(20,20)),Nt(this,Dt,new class{constructor(t,e=5,i=h.UP){_.set(this,{writable:!0,value:void 0}),F.set(this,{writable:!0,value:void 0}),B.set(this,{writable:!0,value:void 0}),K.set(this,{writable:!0,value:void 0}),q.set(this,{writable:!0,value:void 0}),Y.set(this,{writable:!0,value:void 0}),z.set(this,{writable:!0,value:void 0}),j.set(this,{writable:!0,value:void 0}),$.set(this,{writable:!0,value:void 0}),G(this,F,i),G(this,B,i),G(this,Y,t),G(this,z,i),G(this,j,e),G(this,K,new M),G(this,q,{EAT:"EAT",CHANGEDIRECTION:"CHANGEDIRECTION"}),this.init()}init(){const t=s(C(this,z)),i=a(t);let n;G(this,_,new class{constructor(){O.add(this),function(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}(this,O,P).call(this)}push(t){const e=new L(t);return this.head?(this.tail.setNext(e),this.tail=e):(this.head=e,this.tail=this.head),this.length+=1,this}pop(){if(0===this.length)return;let t=this.head,e=t;for(;t.next();)e=t,t=t.next();return this.tail=e,this.tail.setNext(null),this.length-=1,t}unshift(t){const e=new L(t);return this.head?(e.setNext(this.head),this.head=e):(this.head=e,this.tail=this.head),this.length+=1,this}}),C(this,_).push(new J(C(this,Y)));for(let t=1;t<C(this,j);t++)n=e.multiplyScalar(i,t),C(this,_).push(new J(e.add(C(this,Y),n)));G(this,F,C(this,z)),G(this,$,[])}changeDirection(t){const e=s(C(this,F));(t=>Object.keys(i).includes(t))(t)&&t!==e&&G(this,B,t),C(this,F)!=t&&C(this,K).dispatch(C(this,q).CHANGEDIRECTION,t)}move(){let t=C(this,_).head;const i=a(C(this,B));let s=t.value().position,n=e.add(s,i);C(this,_).unshift({position:n}),G(this,F,C(this,B)),C(this,$).filter((t=>!t.isAvailable)).forEach((t=>{t.step(C(this,_).head,C(this,_).length),t.step(C(this,_).head,C(this,_).length)}))}eat(){C(this,K).dispatch(C(this,q).EAT,C(this,_).length);const t=C(this,$).filter((t=>t.isAvailable));if(t.length>0)t[0].start(C(this,_).head);else{const t=new V;t.start(C(this,_).head),C(this,$).push(t)}}pop(){C(this,_).pop()}resetHandlers(){C(this,K).reset()}getBody(){return C(this,_)}getLength(){return C(this,_).length}getDirection(){return C(this,F)}getNextDirection(){return C(this,B)}getPositions(){const t=[];let e=C(this,_).head,i=0;for(;i<C(this,_).length;)t.push(e.value().position.get()),e=e.next(),i++;return t}getBodyPositions(){const t=this.getPositions();return t.shift(),t}getBulges(){return C(this,$).filter((t=>!t.isAvailable)).map((t=>({position:t.getPosition(),size:t.size})))}getHeadPosition(){return C(this,_).head.value().position}setHeadPosition(t){C(this,_).head.setValue(new J(t))}hasOverlapped(){const t=this.getPositions();return t.shift(),t.filter((t=>e.isEqual(t,C(this,_).head.value().position))).length>0}onEat(t){C(this,K).registerHandler(C(this,q).EAT,t)}removeOnEat(t){C(this,K).deregisterHandler(C(this,q).EAT,t)}onChangeDirection(t){C(this,K).registerHandler(C(this,q).CHANGEDIRECTION,t)}removeOnChangeDirection(t){C(this,K).deregisterHandler(C(this,q).CHANGEDIRECTION,t)}}(xt(this,Lt).getCenter(),xt(this,At),h.UP)),Nt(this,Ut,new class{constructor(){wt.add(this),rt.set(this,{writable:!0,value:void 0}),ot.set(this,{writable:!0,value:void 0}),lt.set(this,{writable:!0,value:void 0}),dt.set(this,{writable:!0,value:void 0}),ct.set(this,{writable:!0,value:void 0}),ut.set(this,{writable:!0,value:void 0}),pt.set(this,{writable:!0,value:void 0}),at(this,ut,new M),at(this,pt,{TICK:"TICK",ELAPSED:"ELAPSED"})}start(t){at(this,lt,0),at(this,ot,performance.now()),at(this,dt,t),at(this,ct,!0),window.requestAnimationFrame(nt(this,wt,vt).bind(this))}reset(){at(this,lt,0),at(this,ot,performance.now())}stop(){at(this,ct,!1)}hasElapsed(){return st(this,rt)}tick(){st(this,ct)&&(st(this,ut).dispatch(st(this,pt).TICK,st(this,lt)/st(this,dt)),at(this,lt,performance.now()-st(this,ot)),at(this,rt,st(this,lt)>st(this,dt)),this.hasElapsed()&&(st(this,ut).dispatch(st(this,pt).ELAPSED),this.reset()))}clearHandlers(){st(this,ut).reset()}onTick(t){st(this,ut).registerHandler(st(this,pt).TICK,t)}removeOnTick(t){st(this,ut).deregisterHandler(st(this,pt).TICK,t)}onElapsed(t){st(this,ut).registerHandler(st(this,pt).ELAPSED,t)}removeOnElapsed(t){st(this,ut).deregisterHandler(st(this,pt).ELAPSED,t)}}),Nt(this,Ct,new M),Nt(this,_t,!1),Nt(this,Ft,150),Nt(this,Bt,[]),Nt(this,Kt,new Mt),Nt(this,Gt,{INIT:"INIT",START:"START",END:"END",PAUSE:"PAUSE",RESET:"RESET",UPDATE:"UPDATE",TICK:"TICK"}),Object.freeze(xt(this,Gt)),Nt(this,qt,new kt),xt(this,qt).onUp((()=>xt(this,Dt).changeDirection(h.UP))),xt(this,qt).onRight((()=>xt(this,Dt).changeDirection(h.RIGHT))),xt(this,qt).onDown((()=>xt(this,Dt).changeDirection(h.DOWN))),xt(this,qt).onLeft((()=>xt(this,Dt).changeDirection(h.LEFT))),xt(this,Kt).load("eat","../audio/eat.wav",.8),xt(this,Kt).load("up","../audio/wo.wav"),xt(this,Kt).load("right","../audio/we.wav"),xt(this,Kt).load("down","../audio/wa.wav"),xt(this,Kt).load("left","../audio/wu.wav"),xt(this,Kt).load("bg","../audio/Monkeys-Spinning-Monkeys.mp3",.3,!0),xt(this,Kt).load("cheering","../audio/cheering.wav",.3,!1)}init(){Nt(this,_t,!1),xt(this,Ut).stop(),xt(this,Ut).clearHandlers(),xt(this,Ut).onElapsed(It(this,Yt,jt).bind(this)),Nt(this,Pt,0),Nt(this,Rt,xt(this,Lt).getRandomCoordinate(xt(this,Dt).getPositions())),xt(this,Dt).init(),xt(this,Kt).play("bg"),xt(this,Ut).onTick((()=>{xt(this,qt).update()}));const t=t=>{Nt(this,Pt,t-xt(this,At)),xt(this,Kt).play("eat")},e=t=>{xt(this,Kt).play(t.toString().toLowerCase())};xt(this,Dt).removeOnEat(t),xt(this,Dt).onEat(t),xt(this,Dt).removeOnChangeDirection(e),xt(this,Dt).onChangeDirection(e),xt(this,Ct).dispatch(xt(this,Gt).UPDATE,{currentSnakeDirection:xt(this,Dt).getDirection(),currentSnakePositions:xt(this,Dt).getPositions(),snakeLength:xt(this,Dt).getLength(),bulges:xt(this,Dt).getBulges(),applePosition:xt(this,Rt),score:xt(this,Pt)})}start(){Nt(this,_t,!0),xt(this,Ut).start(xt(this,Ft))}end(t,e){xt(this,Ut).stop(),xt(this,Ut).removeOnElapsed(It(this,Yt,jt)),xt(this,Dt).resetHandlers(),xt(this,Kt).stop("bg"),xt(this,Kt).play("cheering"),xt(this,Ct).dispatch(xt(this,Gt).END,{currentSnakeDirection:e,currentSnakePositions:t,snakeLength:xt(this,Dt).getLength(),bulges:xt(this,Dt).getBulges(),applePosition:xt(this,Rt),score:xt(this,Pt),grid:xt(this,Lt)})}onUpdate(t){xt(this,Ct).registerHandler(xt(this,Gt).UPDATE,t)}removeOnUpdate(t){xt(this,Ct).deregisterHandler(xt(this,Gt).UPDATE,t)}onInit(t){xt(this,Ct).registerHandler(xt(this,Gt).INIT,t)}removeOnInit(t){xt(this,Ct).deregisterHandler(xt(this,Gt).INIT,t)}onEnd(t){xt(this,Ct).registerHandler(xt(this,Gt).END,t)}removeOnEnd(t){xt(this,Ct).deregisterHandler(xt(this,Gt).END,t)}},qe=new Mt;qe.load("menu-bg","./audio/Komiku_-_12_-_Bicycle.mp3",.5,!0);const Ye=new class{constructor(t,e,i,s){Ie.add(this),Me.add(this),He.add(this),We.add(this),be.add(this),ke.add(this),me.add(this),Te.add(this),Se.add(this),le.set(this,{writable:!0,value:void 0}),de.set(this,{writable:!0,value:void 0}),ce.set(this,{writable:!0,value:void 0}),ue.set(this,{writable:!0,value:void 0}),pe.set(this,{writable:!0,value:void 0}),we.set(this,{writable:!0,value:void 0}),ve.set(this,{writable:!0,value:void 0}),ge.set(this,{writable:!0,value:void 0}),fe.set(this,{writable:!0,value:void 0}),ye.set(this,{writable:!0,value:void 0}),Ee.set(this,{writable:!0,value:void 0}),re(this,le,new kt),re(this,ce,new M),re(this,de,new class{constructor(t){ie.add(this),ee.add(this),Zt.set(this,{writable:!0,value:void 0}),te.set(this,{writable:!0,value:void 0}),Qt(this,Zt,t),Qt(this,te,[]);let e=window.localStorage.getItem(t);if("string"==typeof e){let t=JSON.parse(e);Array.isArray(t)&&Qt(this,te,[...t])}}getHighScores(){return Vt(this,te)}addHighScore(t,e){Vt(this,te).push({name:t,value:e,date:(new Date).toISOString()}),Jt(this,ee,se).call(this)}getTopTen(){return Vt(this,te).sort(Jt(this,ie,ne)).filter(((t,e)=>e<10))}}("jm-snake")),re(this,ue,{INIT:"INIT",MAINMENU:"MAINMENU",STARTGAME:"STARTGAME",SUBMITSCORE:"SUBMITSCORE",SHOWHIGHSCORES:"SHOWHIGHSCORES"}),Object.freeze(he(this,ue)),re(this,pe,t),re(this,we,e),re(this,ve,i),re(this,ge,s),re(this,Ee,document.body.querySelectorAll(".score")),re(this,fe,document.getElementById("prompt")),re(this,ye,document.getElementById("prompt-text")),ae(this,Ie,Ce).call(this),ae(this,Se,xe).call(this)}updateScore(t){for(var e=0;e<he(this,Ee).length;e++)he(this,Ee)[e].innerHTML=t}goToReview(t,e){ae(this,be,De).call(this,e),he(this,ge).querySelector("img").src=t,this.updateScore(e)}renderHighScores(t){const e=he(this,ve).querySelector("#high-scores"),i=he(this,ve).querySelector("#high-scores-message");ae(this,We,Ae).call(this,e),ae(this,He,Le).call(this,i),0===t.length&&ae(this,We,Ae).call(this,i);let s=['<li><h3>name</h3><h3>#<span class="apple-icon"></span></h3></li>'];for(let e=0;e<10;e++)e<t.length?s.push(`<li><div>${t[e].name}</div><div>${t[e].value}</div></li>`):s.push("<li><div></div><div></div></li>");e.innerHTML=s.join("")}onInitGame(t){he(this,ce).registerHandler(he(this,ue).INIT,t)}removeonInitGame(t){he(this,ce).deregisterHandler(he(this,ue).INIT,t)}onStartGame(t){he(this,ce).registerHandler(he(this,ue).STARTGAME,t)}removeOnStartGame(t){he(this,ce).deregisterHandler(he(this,ue).STARTGAME,t)}onSubmitHighScores(t){he(this,ce).registerHandler(he(this,ue).SUBMITSCORE,t)}removeOnSubmitHighScores(t){he(this,ce).deregisterHandler(he(this,ue).SUBMITSCORE,t)}onShowHighScores(t){he(this,ce).registerHandler(he(this,ue).SHOWHIGHSCORES,t)}removeOnShowHighScores(t){he(this,ce).deregisterHandler(he(this,ue).SHOWHIGHSCORES,t)}onMainMenu(t){he(this,ce).registerHandler(he(this,ue).MAINMENU,t)}removeOnMainMenu(t){he(this,ce).deregisterHandler(he(this,ue).MAINMENU,t)}}(Ue,_e,Fe,Be);Ye.onMainMenu((()=>{qe.play("menu-bg")})),Ye.onInitGame((()=>{qe.stop("menu-bg"),Ke.init()})),Ye.onStartGame((()=>{Ke.start()}));const ze=({currentSnakePositions:t,currentSnakeDirection:i,snakeLength:s,bulges:n,applePosition:a,score:h})=>{const r=e.distance(t[0],a);Ge.clear(),Ge.drawBulges(n),Ge.drawSnake(t,i,s),r<2&&Ge.drawSnakeMouth(t[0],i),Ge.drawApple(a),Ye.updateScore(h)};Ke.onInit(ze),Ke.onUpdate(ze),Ke.onEnd((({currentSnakePositions:t,currentSnakeDirection:e,snakeLength:i,applePosition:s,score:n,grid:a})=>{Ge.clear(),Ge.drawGrid(a),Ge.drawSnake(t,e,i),Ge.drawApple(s);const h=Ge.takeScreenshot();Ye.goToReview(h,n)}))})();